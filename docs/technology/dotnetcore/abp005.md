---
title: 'ABP核心项目-电商项目落地实战(三)-仓储、服务层优化'
date: 2023-07-18
tags:
- 'dotnet core'
- 'C#'
- 'ABP'
- '电商项目落地实战(三)-仓储、服务层优化'
categories:
- 'C#'
---

## 目录
[[toc]]

## 核心项目-电商项目落地实战(三)-仓储、服务层优化
### 电商服务层优化
>* 1  LKN.EBusiness.Application
>* 2  LKN.EBusiness.Application.Contracts
### 服务层优化，针对产品服务，依赖abp框架的接口服务、实现服务来完善
:::tip &nbsp;
 根据abp框架实现 常用的添加、修改、删除、查询
>* 1 、在**Application.Contracts**层中添加 **IProudectAppService** 服务接口，继承**ICrudAppService<ProductDto,Guid,PagedAndSortedResultRequestDto,CreateProductDto,UpdateProductDto>** ，这时需要创建好返回实体的Dto（**PrductDto**）、引用abp框架中的“**PagedAndSortedResultRequestDto**”或者自己创建自定义查询的Dto对象、创建添加“**CreateProductDto**”、 创建更新“**UpdateProductDto**”等实体对象。
>* 2 、在**Application** 层中添加 **ProudectAppService** 实现服务接口，实现该接口我们使用abp框架提供的实现在来完成，如：**CrudAppService<Product, ProductDto, Guid, PagedAndSortedResultRequestDto, CreateProductDto, UpdateProductDto>, IProductAppService** 泛型中的 **Product** 聚合根据实体、**ProductDto**返回实体 、 **Guid** 表主键id类型 、**PagedAndSortedResultRequestDto** 查询条件Dto 、 **CreateProductDto**创建产品实例Dto、 **UpdateProductDto** 更新产品实例Dto等。
>* 3 、Dto表的关联映射配置，在**Application**层，**EBusinessApplicationAutoMapperProfile**文件中
:::

``` c#
 public EBusinessApplicationAutoMapperProfile()
    {
        /* You can configure your AutoMapper mapping configuration here.
         * Alternatively, you can split your mapping configurations
         * into multiple profile classes for a better organization. */
        CreateMap<Product, ProductDto>();
        CreateMap<PagedAndSortedResultRequestDto, Product>();
        CreateMap<CreateProductDto, Product>();
        CreateMap<UpdateProductDto, Product>();
        CreateMap<ProductAttrQueryDto, Product>();
        CreateMap<ProductImageDto, ProductImage>();
        CreateMap<ProductImage, ProductImageDto>();
    }
```
### 实现部分代码
---
>* 1、服务层
``` C#
 public class ProductAppService : CrudAppService<Product, ProductDto, Guid, PagedAndSortedResultRequestDto, CreateProductDto, UpdateProductDto>, IProductAppService
    {
        public IProductAbpRepository _productAbpRepository;

        public ProductAppService(IProductAbpRepository repository) : base(repository)
        {
            _productAbpRepository = repository;
        }

        public IEnumerable<ProductDto> GetProductAndImage()
        {
            // 1、查询所有和图片
            IEnumerable<Product> products = _productAbpRepository.GetProductAndImages();

            // 2、然后映射
            return ObjectMapper.Map<IEnumerable<Product>, List<ProductDto>>(products);
        }

        public IEnumerable<ProductDto> GetProductByAttr(ProductAttrQueryDto createProductDto)
        {
            // 1、查询所有和图片
            IEnumerable<Product> products = _productAbpRepository.GetProductByName(createProductDto.productName);

            // 2、然后映射
            return ObjectMapper.Map<IEnumerable<Product>, List<ProductDto>>(products);
        }

        public ProductTotaLDto GetProductTotals()
        {
            throw new NotImplementedException();
        }
    }
```
>* 2 服务接口层
``` C# 
    /// <summary>
    /// 商品服务
    /// </summary>
    public interface IProductAppService:ICrudAppService<ProductDto,Guid,PagedAndSortedResultRequestDto,CreateProductDto,UpdateProductDto>
    {
        public IEnumerable<ProductDto> GetProductAndImage();

        public IEnumerable<ProductDto> GetProductByAttr(ProductAttrQueryDto createProductDto);

        public ProductTotaLDto GetProductTotals();
    }
```




