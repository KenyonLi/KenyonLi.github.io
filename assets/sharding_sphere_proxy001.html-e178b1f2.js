import{_ as i,r as c,o as u,c as r,a as n,b as a,w as e,d as s,e as l}from"./app-c1c3c937.js";const k="/images/sharding/sharding_sphere_proxy001image.png",d="/images/sharding/sharding_sphere_proxy002image.png",m="/images/sharding/sharding_sphere_proxy003image.png",v="/images/sharding/sharding_sphere_proxy004image.png",b="/images/sharding/sharding_sphere_proxy005image.png",y="/images/sharding/sharding_sphere_proxy006image.png",h="/images/sharding/sharding_sphere_proxy007image.png",g="/images/sharding/sharding_sphere_proxy008image.png",_="/images/sharding/sharding_sphere_proxy010image.png",S="/images/sharding/sharding_sphere_proxy011image.png",f="/images/sharding/sharding_sphere_proxy012image.png",x="/images/sharding/sharding_sphere_proxy009image.png",N={},T=n("h2",{id:"目录",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#目录","aria-hidden":"true"},"#"),s(" 目录")],-1),L={class:"table-of-contents"},w=l('<h2 id="shardingsphere-proxy" tabindex="-1"><a class="header-anchor" href="#shardingsphere-proxy" aria-hidden="true">#</a> ShardingSphere-Proxy</h2><h2 id="什么是shardingsphere-proxy" tabindex="-1"><a class="header-anchor" href="#什么是shardingsphere-proxy" aria-hidden="true">#</a> 什么是ShardingSphere-Proxy</h2><blockquote><p>ShardingSphere-Proxy是跨语言的数据库代理服务端，主要目的：对数据库实现分库分表和读写分离</p></blockquote><h2 id="什么地方使用shardingsphere-proxy" tabindex="-1"><a class="header-anchor" href="#什么地方使用shardingsphere-proxy" aria-hidden="true">#</a> 什么地方使用ShardingSphere-Proxy</h2><blockquote><p>主要应用在：</p></blockquote><p>​ 单体电商项目</p><p>​ 微服务电商项目</p><p>首先，我们先简单理解分库和分表</p><h2 id="什么是分库" tabindex="-1"><a class="header-anchor" href="#什么是分库" aria-hidden="true">#</a> 什么是分库</h2><blockquote><p>分库：表存储到不同数据库</p></blockquote><p><img src="'+k+'" alt="Alt text"></p><p>什么是分表 分表：一张分成多张表</p><p><img src="'+d+'" alt="Alt text"></p><h3 id="单体项目中为什么要使用shardingsphere-proxy" tabindex="-1"><a class="header-anchor" href="#单体项目中为什么要使用shardingsphere-proxy" aria-hidden="true">#</a> 单体项目中为什么要使用ShardingSphere-Proxy</h3><blockquote><p>单体系统，主要用来处理客户端的请求，客户端添加的数据，这些数据会存到数据库表中，一个表存储的容量是有限的，如果超过了一定的数量，表的处理性能就会下降，是因为表是通过InnoDB引擎来处理数据的，InnoDB通过B+树结构进行存储，如果超过了一定的阀值，就会使表的性能下降，如何提升性能？<br> 方案：就是分表技术。 从并发量角度思考，如果客户端查询数据并发量比较大，超过了数据库的并发处理能力，就会导致数据库性能下降（因为数据库本身使用的系统资源还是有限的，例如内存资源、cpu资源，磁盘资料等等，都是有限，所以导致数据库并发处理能力有限）。如何提升表的性能？<br> 方案：就是分库分表技术。<br> 如何落实分库分表呢？<br> 方案有两种，进程内 和 进程外两种</p></blockquote><h3 id="进程内方案" tabindex="-1"><a class="header-anchor" href="#进程内方案" aria-hidden="true">#</a> 进程内方案</h3><p><img src="'+m+'" alt="Alt text"></p><p>缺陷<br> 1、资源竞争问题<br> 2、异常影响问题<br> 所以：需要使用进程外方案</p><h3 id="进程外方案" tabindex="-1"><a class="header-anchor" href="#进程外方案" aria-hidden="true">#</a> 进程外方案</h3><p><img src="'+v+'" alt="Alt text"></p><p>缺陷<br> 1、维护量上升的问题<br> 2、稳定性问题<br> 但是，为了做架构设计，所以，建议大家使用进程外来落地</p><h3 id="数据库中间件技术类型" tabindex="-1"><a class="header-anchor" href="#数据库中间件技术类型" aria-hidden="true">#</a> 数据库中间件技术类型</h3><p>技术类型有2类<br> 工具：<br> 1、Mycat<br> 2、ShardingSphere-Proxy</p><p>如何选择数据库中间件技术类型<br> 根据每个技术功能特点来进行<br> 1、Mycat 是java 开发的，落地麻烦<br> 2、ShardingSphere-Proxy 是java 开发的，落地快<br> 所以：最终选择ShardingSphere-Proxy</p><h2 id="项目中如何落地shardingsphere-proxy" tabindex="-1"><a class="header-anchor" href="#项目中如何落地shardingsphere-proxy" aria-hidden="true">#</a> 项目中如何落地ShardingSphere-Proxy</h2>',25),I=n("br",null,null,-1),P=n("br",null,null,-1),M=n("br",null,null,-1),A={href:"https://www.oracle.com/cn/java/technologies/javase/javase-jdk8-downloads.html",target:"_blank",rel:"noopener noreferrer"},D=n("p",null,[s("前提："),n("br"),s(" 1、电商项目"),n("br"),s(" 2、MySQL 8.0"),n("br"),s(" 3、ShardingSphere-Proxy 步骤："),n("br"),n("img",{src:b,alt:"Alt text"})],-1),U=n("br",null,null,-1),q={href:"https://downloads.mysql.com/archives/installer/",target:"_blank",rel:"noopener noreferrer"},E=n("p",null,"3、ShardingSphere-Proxy准备",-1),z=n("br",null,null,-1),O={href:"https://www.oracle.com/java/technologies/javase/jdk11-archive-downloads.html",target:"_blank",rel:"noopener noreferrer"},B=n("br",null,null,-1),C=n("br",null,null,-1),R={href:"https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.30/mysql-connector-java-8.0.30.jar",target:"_blank",rel:"noopener noreferrer"},j=n("br",null,null,-1),G=n("br",null,null,-1),H={href:"https://archive.apache.org/dist/shardingsphere/5.4.0/apache-shardingsphere-5.4.0-shardingsphere-proxy-bin.tar.gz",target:"_blank",rel:"noopener noreferrer"},$=l(`<p>​ 官网地址：https://shardingsphere.apache.org/</p><p>​ 下载地址：https://archive.apache.org/dist/shardingsphere/5.4.0/</p><p>​ 文档地址：https://shardingsphere.apache.org/document/current/cn/overview/</p><p>​ 开发者文档地址：https://shardingsphere.apache.org/document/current/cn/dev-manual/</p><blockquote><blockquote><p>3.4、使用<code>tar</code>命令解压</p></blockquote></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>​ <span class="token function">tar</span> zxvf   apache-shardingsphere-5.4.0-shardingsphere-proxy-bin.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+y+'" alt="Alt text"></p><blockquote><blockquote><p>3.5、将mysql-connector-java-8.0.30.jar拷贝到改目录下</p></blockquote></blockquote><p><img src="'+h+'" alt="Alt text"> ​</p><h2 id="商品表分表场景落地" tabindex="-1"><a class="header-anchor" href="#商品表分表场景落地" aria-hidden="true">#</a> 商品表分表场景落地</h2><p>条件：<br> 1、 ebusiness库<br> 2、 product表<br> 目标：将proudct 表分成product_0 和 product_1<br> 步骤</p><blockquote><p>1、先在MySql中使用客户创建ebusiness数据库</p></blockquote><blockquote><p>2、然后进入apache-shardingsphere-5.4.0-shardingsphere-proxy-bin配置文件config-sharding.yaml中</p></blockquote><p><img src="'+g+`" alt="Alt text"></p><blockquote><blockquote><p>2.1 然后在config-sharding.yaml中添加分表配置</p></blockquote></blockquote><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># 3、创建客户端连接库</span>
<span class="token key atrule">databaseName</span><span class="token punctuation">:</span> ebusiness
<span class="token comment">#</span>
<span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
  <span class="token key atrule">productdatasources_0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3307/ebusiness<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token comment"># 2、分片规则</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token tag">!SHARDING</span>
  <span class="token key atrule">tables</span><span class="token punctuation">:</span>
    <span class="token key atrule">product</span><span class="token punctuation">:</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> productdatasources_0.product_$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>
      <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> ProductId
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> product_MOD
      <span class="token comment">#开启 雪花算法生成id ,适用分步式部署</span>
      <span class="token key atrule">keyGenerateStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">column</span><span class="token punctuation">:</span> Id
        <span class="token key atrule">keyGeneratorName</span><span class="token punctuation">:</span> snowflake
  <span class="token key atrule">shardingAlgorithms</span><span class="token punctuation">:</span>
    <span class="token key atrule">product_MOD</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> INLINE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> product_$<span class="token punctuation">{</span>ProductId % 2<span class="token punctuation">}</span>
        
  <span class="token key atrule">keyGenerators</span><span class="token punctuation">:</span>
    <span class="token key atrule">snowflake</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3、然后进入apache-shardingsphere-5.4.0-shardingsphere-proxy-bin配置文件server.yaml中</p><p><img src="`+_+`" alt="Alt text"></p><p>然后添加用户名和密码</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>authority:
 users:
   - user: root@%
     password: skceDB123
   - user: sharding
     password: skceDB123
 privilege:
   <span class="token comment"># 每个用户都拥有所有权限，无需专门授权；</span>
   type: ALL_PERMITTED   
<span class="token comment">#</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><blockquote><p>3.1 server.yaml属性配置(默认可以不配置)</p></blockquote></blockquote><p>​ 配置项说明</p><table><thead><tr><th style="text-align:center;">名称</th><th style="text-align:center;">数据类型</th><th style="text-align:center;">说明</th><th style="text-align:center;">默认值</th></tr></thead><tbody><tr><td style="text-align:center;">sql-show (?)</td><td style="text-align:center;">boolean</td><td style="text-align:center;">是否在日志中打印 SQL。 打印 SQL 可以帮助开发者快速定位系统问题。日志内容包含：逻辑 SQL，真实 SQL 和 SQL 解析结果。 如果开启配置，日志将使用 Topic ShardingSphere-SQL，日志级别是 INFO。</td><td style="text-align:center;">false</td></tr><tr><td style="text-align:center;">sql-simple (?)</td><td style="text-align:center;">boolean</td><td style="text-align:center;">是否在日志中打印简单风格的 SQL。</td><td style="text-align:center;">false</td></tr><tr><td style="text-align:center;">executor-size (?)</td><td style="text-align:center;">int</td><td style="text-align:center;">用于设置任务处理线程池的大小。每个 ShardingSphereDataSource 使用一个独立的线程池，同一个 JVM 的不同数据源不共享线程池。</td><td style="text-align:center;">infinite</td></tr><tr><td style="text-align:center;">max-connections-size-per-query (?)</td><td style="text-align:center;">int</td><td style="text-align:center;">一次查询请求在每个数据库实例中所能使用的最大连接数。</td><td style="text-align:center;">1</td></tr><tr><td style="text-align:center;">check-table-metadata-enabled (?)</td><td style="text-align:center;">boolean</td><td style="text-align:center;">是否在程序启动和更新时检查分片元数据的结构一致性。</td><td style="text-align:center;">false</td></tr><tr><td style="text-align:center;">query-with-cipher-column (?)</td><td style="text-align:center;">boolean</td><td style="text-align:center;">是否使用加密列进行查询。在有原文列的情况下，可以使用原文列进行查询。</td><td style="text-align:center;">true</td></tr><tr><td style="text-align:center;">proxy-frontend-flush-threshold (?)</td><td style="text-align:center;">int</td><td style="text-align:center;">在 ShardingSphere-Proxy 中设置传输数据条数的 IO 刷新阈值。</td><td style="text-align:center;">128</td></tr><tr><td style="text-align:center;">proxy-transaction-type (?)</td><td style="text-align:center;">String</td><td style="text-align:center;">ShardingSphere-Proxy 中使用的默认事务类型。包括：LOCAL、XA 和 BASE。</td><td style="text-align:center;">LOCAL</td></tr><tr><td style="text-align:center;">proxy-opentracing-enabled (?)</td><td style="text-align:center;">boolean</td><td style="text-align:center;">是否允许在 ShardingSphere-Proxy 中使用 OpenTracing。</td><td style="text-align:center;">false</td></tr><tr><td style="text-align:center;">proxy-hint-enabled (?)</td><td style="text-align:center;">boolean</td><td style="text-align:center;">是否允许在 ShardingSphere-Proxy 中使用 Hint。使用 Hint 会将 Proxy 的线程处理模型由 IO 多路复用变更为每个请求一个独立的线程，会降低 Proxy 的吞吐量。</td><td style="text-align:center;">false</td></tr><tr><td style="text-align:center;">xa-transaction-manager-type (?)</td><td style="text-align:center;">String</td><td style="text-align:center;">XA 事务管理器类型。列如：Atomikos，Narayana，Bitronix。</td><td style="text-align:center;">Atomikos</td></tr></tbody></table><p>4、然后启动apache-shardingsphere-5.4.0-shardingsphere-proxy-bin</p><p><img src="`+S+'" alt="Alt text"></p><p>5、然后在sharding-proxy-63-3307中使用脚本添加数据, ebusiness数据库中使用脚本创建product表</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>product<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>\n	<span class="token identifier"><span class="token punctuation">`</span>Id<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>SeckillType<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>SeckillName<span class="token punctuation">`</span></span> <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>SeckillUrl<span class="token punctuation">`</span></span> <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>SeckillPrice<span class="token punctuation">`</span></span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>SeckillStock<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>SeckillPercent<span class="token punctuation">`</span></span> <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>TimeId<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>ProductId<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>SeckillLimit<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>SeckillDescription<span class="token punctuation">`</span></span> <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>SeckillIstop<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n	<span class="token identifier"><span class="token punctuation">`</span>SeckillStatus<span class="token punctuation">`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>Id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>\n	<span class="token keyword">INDEX</span> <span class="token identifier"><span class="token punctuation">`</span>ProductId<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>ProductId<span class="token punctuation">`</span></span><span class="token punctuation">)</span>\n<span class="token punctuation">)</span>\n<span class="token keyword">COLLATE</span><span class="token operator">=</span><span class="token string">&#39;utf8_general_ci&#39;</span>\n<span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>\n<span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span>\n<span class="token punctuation">;</span> \n \n<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>product<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>Id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillType<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillName<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillUrl<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillPrice<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillStock<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillPercent<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>TimeId<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>ProductId<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillLimit<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillDescription<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillIstop<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillStatus<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span>\n<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;22&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://cdn.cnbj1.fds.api.mi-img.com/mi-mall/c1d6232caff62f3b59d11ee09abdb9d5.jpg&#39;</span><span class="token punctuation">,</span> <span class="token number">12.00</span><span class="token punctuation">,</span> <span class="token number">22222</span><span class="token punctuation">,</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;iphone6是最好的&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">## id 为char 类型，方便于 sharding 雪花算法自动生成id,分步式部署，保证id唯一性。  </span>\n<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>product<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>\n  <span class="token identifier"><span class="token punctuation">`</span>Id<span class="token punctuation">`</span></span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>SeckillType<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>SeckillName<span class="token punctuation">`</span></span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>SeckillUrl<span class="token punctuation">`</span></span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>SeckillPrice<span class="token punctuation">`</span></span> <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>SeckillStock<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>SeckillPercent<span class="token punctuation">`</span></span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>TimeId<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>ProductId<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>SeckillLimit<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>SeckillDescription<span class="token punctuation">`</span></span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>SeckillIstop<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>SeckillStatus<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token identifier"><span class="token punctuation">`</span>CreateTime<span class="token punctuation">`</span></span> <span class="token keyword">datetime</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>\n  <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>ProductId_product<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>ProductId<span class="token punctuation">`</span></span><span class="token punctuation">)</span>\n<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>\n<span class="token comment">## 添加</span>\n<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>product<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>SeckillType<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillName<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillUrl<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillPrice<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillStock<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillPercent<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>TimeId<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>ProductId<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillLimit<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillDescription<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillIstop<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>SeckillStatus<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span>\n<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;22&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;https://cdn.cnbj1.fds.api.mi-img.com/mi-mall/c1d6232caff62f3b59d11ee09abdb9d5.jpg&#39;</span><span class="token punctuation">,</span> <span class="token number">12.00</span><span class="token punctuation">,</span> <span class="token number">22222</span><span class="token punctuation">,</span> <span class="token string">&#39;1&#39;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&#39;iphone6是最好的&#39;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>6、查看实际库中就生成了表</p><p><img src="'+f+'" alt="Alt text"></p><h2 id="整体架构" tabindex="-1"><a class="header-anchor" href="#整体架构" aria-hidden="true">#</a> 整体架构</h2><p><img src="'+x+`" alt="Alt text"></p><p>总共6个阶段：</p><p>1、数据库选择：选择具体数据库以及对应的版本</p><p>2、sql解析：把中间件连接解析成为真实数据库连接</p><p>3、sql路由：选择去哪一个真实数据库对应的表去执行(路由) 核心</p><p>4、sql重写：优化</p><p>5、sql执行：真实数据库获取结果</p><p>6、结果合并：从多个表或者多个库获取结果</p><h3 id="分表原理" tabindex="-1"><a class="header-anchor" href="#分表原理" aria-hidden="true">#</a> 分表原理</h3><h4 id="库分板" tabindex="-1"><a class="header-anchor" href="#库分板" aria-hidden="true">#</a> 库分板</h4><p>技术：使用ModShardingAlgorithm分片算法<br> ShardingSQLRouter路由 过程：取出Id % 2 然后进行取模得到 0 1<br> 分析：如果为0那么，数据就存储到第一张库，如果为1，数据就存储到第二张库</p><h4 id="表分析" tabindex="-1"><a class="header-anchor" href="#表分析" aria-hidden="true">#</a> 表分析</h4><p>技术：使用ModShardingAlgorithm分片算法<br> ShardingSQLRouter路由<br> 过程：取出ProductId % 2 然后进行取模得到0 1<br> 分析：如果为0那么，数据就存储到第1张库第1张表，如果为1，数据就存储到第1张库第2张表</p><h2 id="商品取模分表-情况2" tabindex="-1"><a class="header-anchor" href="#商品取模分表-情况2" aria-hidden="true">#</a> 商品取模分表-情况2</h2><p>商品表product，如果在3307添加商品数据，数据会添加到product_0和product_1中，这个时候，一个一个添加肯定是没有问题的，但是如果批量添加数据到product_0和product_1，如果product_0成功了，product_1失败了，会导致数据不一致。如何解决数据一致性问题<br> 方案：使用分布式事务<br> 条件：<br> 1、ebusiness库<br> 2、product 表<br> 目标： 将product表分成product_0和product_1<br> 步骤： 1、进入apache-shardingsphere-5.4.0-shardingsphere-proxy-bin配置文件server.yaml中</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>authority:
  users:
    - user: root@%
      password: skceDB123
    - user: sharding
      password: skceDB123
  privilege:
    type: ALL_PERMITTED

transaction:
  defaultType: XA
  providerType: Atomikos

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="商品取模分表-情况3" tabindex="-1"><a class="header-anchor" href="#商品取模分表-情况3" aria-hidden="true">#</a> 商品取模分表-情况3</h2><p>商品表product，如果在3307添加商品数据，数据会添加到product_0和product_1中，这个时候，如果查询商品数据并发量比较大，超过了单个数据处理最高处理能力，就会出现数据库压力过大，导致数据库性能下降或者宕机的问题。如何解决数据库性能或者宕机问题？</p><p>方案：使用读写分离</p><p>如何使用读写分离<br> 条件：</p><p>1、数据库集群，一主两从</p><p>目标：将product表分成product_0和product_1</p><p>步骤</p>`,53),Q=l(`<p>2、进入apache-shardingsphere-5.4.0-shardingsphere-proxy-bin配置文件config-sharding.yaml中</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 3、创建客户端连接库</span>
databaseName: ebusiness
<span class="token comment">#</span>
dataSources:
  write_ds:
    url: jdbc:mysql://192.168.1.46:3307/ebusiness?serverTimezone<span class="token operator">=</span>UTC<span class="token operator">&amp;</span><span class="token assign-left variable">useSSL</span><span class="token operator">=</span>false
    username: root
    password: skceDB123
    connectionTimeoutMilliseconds: <span class="token number">30000</span>
    idleTimeoutMilliseconds: <span class="token number">60000</span>
    maxLifetimeMilliseconds: <span class="token number">1800000</span>
    maxPoolSize: <span class="token number">50</span>
    minPoolSize: <span class="token number">1</span>
  read_ds_0:
    url: jdbc:mysql://192.168.1.46:3308/ebusiness?serverTimezone<span class="token operator">=</span>UTC<span class="token operator">&amp;</span><span class="token assign-left variable">useSSL</span><span class="token operator">=</span>false
    username: root
    password: skceDB123
    connectionTimeoutMilliseconds: <span class="token number">30000</span>
    idleTimeoutMilliseconds: <span class="token number">60000</span>
    maxLifetimeMilliseconds: <span class="token number">1800000</span>
    maxPoolSize: <span class="token number">50</span>
    minPoolSize: <span class="token number">1</span>
  read_ds_1:
    url: jdbc:mysql://192.168.1.46:3309/ebusiness?serverTimezone<span class="token operator">=</span>UTC<span class="token operator">&amp;</span><span class="token assign-left variable">useSSL</span><span class="token operator">=</span>false
    username: root
    password: skceDB123
    connectionTimeoutMilliseconds: <span class="token number">30000</span>
    idleTimeoutMilliseconds: <span class="token number">60000</span>
    maxLifetimeMilliseconds: <span class="token number">1800000</span>
    maxPoolSize: <span class="token number">50</span>
    minPoolSize: <span class="token number">1</span>
<span class="token comment"># 2、分片规则</span>
rules:
- <span class="token operator">!</span>READWRITE_SPLITTING
  dataSources:
    readwrite_ds:
      writeDataSourceName: write_ds
      readDataSourceNames:
        - read_ds_0
        - read_ds_1
      loadBalancerName: random  <span class="token comment"># 负载均衡算法名称</span>
      transactionalReadQueryStrategy: PRIMARY
  <span class="token comment"># 负载均衡算法配置</span>
  loadBalancers:
    random:  <span class="token comment"># 负载均衡算法名称</span>
      type: <span class="token environment constant">RANDOM</span>
      props:
- <span class="token operator">!</span>SHARDING
  tables:
    product:
      actualDataNodes: write_ds.product_<span class="token variable">\${0..1}</span>
      tableStrategy:
        standard:
          shardingColumn: ProductId
          shardingAlgorithmName: product_MOD
      <span class="token comment">#开启 雪花算法生成id ,适用分步式部署</span>
      keyGenerateStrategy:
        column: Id
        keyGeneratorName: snowflake
  shardingAlgorithms:
    product_MOD:
      type: INLINE
      props:
        algorithm-expression: product_<span class="token variable">\${ProductId <span class="token operator">%</span> 2}</span>
        
  keyGenerators:
    snowflake:
      type: SNOWFLAKE
      props:
        worker-id: <span class="token number">123</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>分库分表</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># 3、创建客户端连接库</span>
<span class="token key atrule">databaseName</span><span class="token punctuation">:</span> ebusiness
<span class="token comment">#</span>
<span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
  <span class="token key atrule">write_ds</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3307/ebusiness<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3308/ebusiness<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3309/ebusiness<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">write_ds_0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3307/ebusiness_0<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_0_0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3308/ebusiness_0<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_0_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3309/ebusiness_0<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">write_ds_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3307/ebusiness_1<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_1_0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3308/ebusiness_1<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_1_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3309/ebusiness_1<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token comment"># 2、分片规则</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token tag">!READWRITE_SPLITTING</span>
  <span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
    <span class="token key atrule">readwrite_ds</span><span class="token punctuation">:</span>
      <span class="token key atrule">writeDataSourceName</span><span class="token punctuation">:</span> write_ds
      <span class="token key atrule">readDataSourceNames</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> read_ds_0
        <span class="token punctuation">-</span> read_ds_1
      <span class="token key atrule">loadBalancerName</span><span class="token punctuation">:</span> loadBalancer_round_robin  <span class="token comment"># 负载均衡算法名称</span>

    <span class="token key atrule">readwrite_ds1</span><span class="token punctuation">:</span>
      <span class="token key atrule">writeDataSourceName</span><span class="token punctuation">:</span> write_ds_0
      <span class="token key atrule">readDataSourceNames</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> read_ds_0_0
        <span class="token punctuation">-</span> read_ds_0_1
      <span class="token key atrule">loadBalancerName</span><span class="token punctuation">:</span> loadBalancer_round_robin  <span class="token comment"># 负载均衡算法名称</span>
    <span class="token key atrule">readwrite_ds2</span><span class="token punctuation">:</span>
      <span class="token key atrule">writeDataSourceName</span><span class="token punctuation">:</span> write_ds_1
      <span class="token key atrule">readDataSourceNames</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> read_ds_1_0
        <span class="token punctuation">-</span> read_ds_1_1
      <span class="token key atrule">loadBalancerName</span><span class="token punctuation">:</span> loadBalancer_round_robin  <span class="token comment"># 负载均衡算法名称</span>
     <span class="token comment"># transactionalReadQueryStrategy: PRIMARY</span>
  <span class="token comment"># 负载均衡算法配置</span>
  <span class="token key atrule">loadBalancers</span><span class="token punctuation">:</span>
    <span class="token key atrule">loadBalancer_round_robin</span><span class="token punctuation">:</span>  <span class="token comment"># 负载均衡算法名称</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> ROUND_ROBIN <span class="token comment">#RANDOM</span>
      <span class="token comment">#props:</span>
<span class="token punctuation">-</span> <span class="token tag">!SHARDING</span>
  <span class="token key atrule">tables</span><span class="token punctuation">:</span>
    <span class="token key atrule">product</span><span class="token punctuation">:</span>
      <span class="token comment">#actualDataNodes: write_ds.product_\${0..1}  #  分表</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> write_ds_$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.product_$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span> <span class="token comment">#分库</span>
      <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> ProductId
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> product_MOD
      <span class="token key atrule">databaseStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> ProductId
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> write_ds__MOD  
      <span class="token comment">#开启 雪花算法生成id ,适用分步式部署</span>
      <span class="token key atrule">keyGenerateStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">column</span><span class="token punctuation">:</span> Id
        <span class="token key atrule">keyGeneratorName</span><span class="token punctuation">:</span> snowflake
  <span class="token key atrule">shardingAlgorithms</span><span class="token punctuation">:</span>
    <span class="token key atrule">product_MOD</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> INLINE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> product_$<span class="token punctuation">{</span>ProductId % 2<span class="token punctuation">}</span>
    <span class="token key atrule">write_ds__MOD</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> INLINE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> write_ds_$<span class="token punctuation">{</span>ProductId % 2<span class="token punctuation">}</span>    
  <span class="token key atrule">keyGenerators</span><span class="token punctuation">:</span>
    <span class="token key atrule">snowflake</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">worker-id</span><span class="token punctuation">:</span> <span class="token number">123</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="商品图片表场景落地" tabindex="-1"><a class="header-anchor" href="#商品图片表场景落地" aria-hidden="true">#</a> 商品图片表场景落地</h3><p>商品表product使用Id作为自增主键，如果在3307添加商品数据，数据会添加到product_0和product_1中，这个时候，我们想对商品图片表进行分表，应该如何实现？</p><p>条件：</p><p>1、ebusinesss库</p><p>2、productimage表</p><p>目标：将productimage表分成productimage_0和productimage_1</p><p>步骤</p><p>1、先在MySQL中使用客户端创建ebusinesss数据库</p><p>2、然后在ebusinesss数据库中使用脚本创建创建productimage表</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">\`</span>productimage<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span>
	<span class="token identifier"><span class="token punctuation">\`</span>Id<span class="token punctuation">\`</span></span> <span class="token keyword">char</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>SeckillType<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>SeckillName<span class="token punctuation">\`</span></span> <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>SeckillUrl<span class="token punctuation">\`</span></span> <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>SeckillPrice<span class="token punctuation">\`</span></span> <span class="token keyword">DECIMAL</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>SeckillStock<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>SeckillPercent<span class="token punctuation">\`</span></span> <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>TimeId<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>ProductId<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>SeckillLimit<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>SeckillDescription<span class="token punctuation">\`</span></span> <span class="token keyword">CHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>SeckillIstop<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token identifier"><span class="token punctuation">\`</span>SeckillStatus<span class="token punctuation">\`</span></span> <span class="token keyword">INT</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
	<span class="token keyword">INDEX</span> <span class="token identifier"><span class="token punctuation">\`</span>ProductId<span class="token punctuation">\`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">\`</span>ProductId<span class="token punctuation">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">COLLATE</span><span class="token operator">=</span><span class="token string">&#39;utf8_general_ci&#39;</span>
<span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span>
<span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="shardingsphere-数据分片规则" tabindex="-1"><a class="header-anchor" href="#shardingsphere-数据分片规则" aria-hidden="true">#</a> shardingSphere 数据分片规则</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># 3、创建客户端连接库</span>
<span class="token key atrule">databaseName</span><span class="token punctuation">:</span> ebusiness
<span class="token comment">#</span>
<span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
  <span class="token key atrule">write_ds</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3307/ebusiness<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3308/ebusiness<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3309/ebusiness<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">write_ds_0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3307/ebusiness_0<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_0_0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3308/ebusiness_0<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_0_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3309/ebusiness_0<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">write_ds_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3307/ebusiness_1<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_1_0</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3308/ebusiness_1<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">read_ds_1_1</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.46<span class="token punctuation">:</span>3309/ebusiness_1<span class="token punctuation">?</span>serverTimezone=UTC<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> skceDB123
    <span class="token key atrule">connectionTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">idleTimeoutMilliseconds</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">maxLifetimeMilliseconds</span><span class="token punctuation">:</span> <span class="token number">1800000</span>
    <span class="token key atrule">maxPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token key atrule">minPoolSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token comment"># 2、分片规则</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token tag">!READWRITE_SPLITTING</span>
  <span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
    <span class="token key atrule">readwrite_ds</span><span class="token punctuation">:</span>
      <span class="token key atrule">writeDataSourceName</span><span class="token punctuation">:</span> write_ds
      <span class="token key atrule">readDataSourceNames</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> read_ds_0
        <span class="token punctuation">-</span> read_ds_1
      <span class="token key atrule">loadBalancerName</span><span class="token punctuation">:</span> loadBalancer_round_robin  <span class="token comment"># 负载均衡算法名称</span>

    <span class="token key atrule">readwrite_ds1</span><span class="token punctuation">:</span>
      <span class="token key atrule">writeDataSourceName</span><span class="token punctuation">:</span> write_ds_0
      <span class="token key atrule">readDataSourceNames</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> read_ds_0_0
        <span class="token punctuation">-</span> read_ds_0_1
      <span class="token key atrule">loadBalancerName</span><span class="token punctuation">:</span> loadBalancer_round_robin  <span class="token comment"># 负载均衡算法名称</span>
    <span class="token key atrule">readwrite_ds2</span><span class="token punctuation">:</span>
      <span class="token key atrule">writeDataSourceName</span><span class="token punctuation">:</span> write_ds_1
      <span class="token key atrule">readDataSourceNames</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> read_ds_1_0
        <span class="token punctuation">-</span> read_ds_1_1
      <span class="token key atrule">loadBalancerName</span><span class="token punctuation">:</span> loadBalancer_round_robin  <span class="token comment"># 负载均衡算法名称</span>
     <span class="token comment"># transactionalReadQueryStrategy: PRIMARY</span>
  <span class="token comment"># 负载均衡算法配置</span>
  <span class="token key atrule">loadBalancers</span><span class="token punctuation">:</span>
    <span class="token key atrule">loadBalancer_round_robin</span><span class="token punctuation">:</span>  <span class="token comment"># 负载均衡算法名称</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> ROUND_ROBIN <span class="token comment">#RANDOM</span>
      <span class="token comment">#props:</span>
<span class="token punctuation">-</span> <span class="token tag">!SHARDING</span>
  <span class="token key atrule">tables</span><span class="token punctuation">:</span>
    <span class="token key atrule">product</span><span class="token punctuation">:</span>
      <span class="token comment">#actualDataNodes: write_ds.product_\${0..1}  #  分表</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> write_ds_$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.product_$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span> <span class="token comment">#分库</span>
      <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token comment">#shardingColumn: ProductId</span>
          <span class="token comment">#shardingAlgorithmName: product_MOD</span>
          <span class="token comment">#shardingColumn: SeckillName</span>
          <span class="token comment">#shardingAlgorithmName: product_HASH_MOD</span>
          <span class="token comment">#shardingColumn: ProductId</span>
          <span class="token comment">#shardingAlgorithmName: product_BOUNDARY_RANGE</span>
          <span class="token comment">#shardingColumn: ProductId</span>
          <span class="token comment">#shardingAlgorithmName: product_VOLUME_RANGE</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> CreateTime
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> product_AUTO_INTERVAL
      <span class="token key atrule">databaseStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> TimeId
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> write_ds__MOD  
      <span class="token comment">#开启 雪花算法生成id ,适用分步式部署</span>
      <span class="token key atrule">keyGenerateStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">column</span><span class="token punctuation">:</span> Id
        <span class="token key atrule">keyGeneratorName</span><span class="token punctuation">:</span> snowflake
    <span class="token key atrule">productimage</span><span class="token punctuation">:</span>
      <span class="token comment">#actualDataNodes: write_ds.product_\${0..1}  #  分表</span>
      <span class="token key atrule">actualDataNodes</span><span class="token punctuation">:</span> write_ds_$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span>.productimage_$<span class="token punctuation">{</span>0..1<span class="token punctuation">}</span> <span class="token comment">#分库</span>
      <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> ProductId
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> productimage_MOD
      <span class="token key atrule">databaseStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> TimeId
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> write_ds__MOD  
      <span class="token comment">#开启 雪花算法生成id ,适用分步式部署</span>
      <span class="token key atrule">keyGenerateStrategy</span><span class="token punctuation">:</span>
        <span class="token key atrule">column</span><span class="token punctuation">:</span> Id
        <span class="token key atrule">keyGeneratorName</span><span class="token punctuation">:</span> snowflake

  <span class="token key atrule">shardingAlgorithms</span><span class="token punctuation">:</span>
    <span class="token key atrule">product_MOD</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> INLINE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> product_$<span class="token punctuation">{</span>ProductId % 2<span class="token punctuation">}</span>
    <span class="token key atrule">write_ds__MOD</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> INLINE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> write_ds_$<span class="token punctuation">{</span>TimeId % 2<span class="token punctuation">}</span>  
    <span class="token key atrule">productimage_MOD</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> INLINE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">algorithm-expression</span><span class="token punctuation">:</span> productimage_$<span class="token punctuation">{</span>ProductId % 2<span class="token punctuation">}</span>
    <span class="token key atrule">product_VOLUME_RANGE</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> VOLUME_RANGE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">range-lower</span><span class="token punctuation">:</span> <span class="token string">&#39;5&#39;</span>
        <span class="token key atrule">range-upper</span><span class="token punctuation">:</span> <span class="token string">&#39;10&#39;</span>
        <span class="token comment">#分片的区间的数据的间隔</span>
        <span class="token key atrule">sharding-volume</span><span class="token punctuation">:</span> <span class="token string">&#39;5&#39;</span>
    <span class="token key atrule">product_AUTO_INTERVAL</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> AUTO_INTERVAL
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">datetime-lower</span><span class="token punctuation">:</span> <span class="token string">&#39;2023-03-01 23:59:59&#39;</span>
        <span class="token key atrule">datetime-upper</span><span class="token punctuation">:</span> <span class="token string">&#39;2023-04-01 23:59:59&#39;</span>
        <span class="token comment">#以1年度为单位进行划分</span>
        <span class="token comment">#sharding-seconds: &#39;31536000&#39;</span>
        <span class="token comment">#以1个月为单位进行划分</span>
        <span class="token comment">#sharding-seconds: &#39;2678400&#39;</span>
        <span class="token comment">#以1天为单位进行划分</span>
        <span class="token key atrule">sharding-seconds</span><span class="token punctuation">:</span> <span class="token string">&#39;86400&#39;</span>
  <span class="token comment">#解决迪卡数据重复的问题      </span>
  <span class="token key atrule">bindingTables</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> product<span class="token punctuation">,</span>productimage
  <span class="token comment"># 默认不分表</span>
  <span class="token key atrule">defaultTableStrategy</span><span class="token punctuation">:</span>
     <span class="token key atrule">none</span><span class="token punctuation">:</span>
  <span class="token key atrule">keyGenerators</span><span class="token punctuation">:</span>
    <span class="token key atrule">snowflake</span><span class="token punctuation">:</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> SNOWFLAKE
      <span class="token key atrule">props</span><span class="token punctuation">:</span>
        <span class="token key atrule">worker-id</span><span class="token punctuation">:</span> <span class="token number">123</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="shardingsphere-v5-1-0-yaml-配置说明" tabindex="-1"><a class="header-anchor" href="#shardingsphere-v5-1-0-yaml-配置说明" aria-hidden="true">#</a> ShardingSphere v5.1.0 YAML 配置说明</h2>`,17),V={href:"https://www.bookstack.cn/read/shardingsphere-5.1.0-zh/ec2cfd46b10987e2.md",target:"_blank",rel:"noopener noreferrer"},F=n("br",null,null,-1),Y={href:"https://juejin.cn/post/7007735588627415076",target:"_blank",rel:"noopener noreferrer"},K=n("br",null,null,-1),W=n("br",null,null,-1),X=l(`<div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">dataSources</span><span class="token punctuation">:</span> <span class="token comment"># 省略数据源配置，请参考使用手册</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token tag">!SHARDING</span>
  <span class="token key atrule">tables</span><span class="token punctuation">:</span> <span class="token comment"># 数据分片规则配置</span>
    <span class="token key atrule">&lt;logic-table-name&gt; (+)</span><span class="token punctuation">:</span> <span class="token comment"># 逻辑表名称</span>
      <span class="token key atrule">actualDataNodes (?)</span><span class="token punctuation">:</span> <span class="token comment"># 由数据源名 + 表名组成（参考Inline语法规则）</span>
      <span class="token key atrule">databaseStrategy (?)</span><span class="token punctuation">:</span> <span class="token comment"># 分库策略，缺省表示使用默认分库策略，以下的分片策略只能选其一</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span> <span class="token comment"># 用于单分片键的标准分片场景</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> <span class="token comment"># 分片列名称</span>
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> <span class="token comment"># 分片算法名称</span>
        <span class="token key atrule">complex</span><span class="token punctuation">:</span> <span class="token comment"># 用于多分片键的复合分片场景</span>
          <span class="token key atrule">shardingColumns</span><span class="token punctuation">:</span> <span class="token comment">#分片列名称，多个列以逗号分隔</span>
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> <span class="token comment"># 分片算法名称</span>
        <span class="token key atrule">hint</span><span class="token punctuation">:</span> <span class="token comment"># Hint 分片策略</span>
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> <span class="token comment"># 分片算法名称</span>
        <span class="token key atrule">none</span><span class="token punctuation">:</span> <span class="token comment"># 不分片</span>
      <span class="token key atrule">tableStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 分表策略，同分库策略</span>
      <span class="token key atrule">keyGenerateStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 分布式序列策略</span>
        <span class="token key atrule">column</span><span class="token punctuation">:</span> <span class="token comment"># 自增列名称，缺省表示不使用自增主键生成器</span>
        <span class="token key atrule">keyGeneratorName</span><span class="token punctuation">:</span> <span class="token comment"># 分布式序列算法名称</span>
  <span class="token key atrule">autoTables</span><span class="token punctuation">:</span> <span class="token comment"># 自动分片表规则配置</span>
    <span class="token key atrule">t_order_auto</span><span class="token punctuation">:</span> <span class="token comment"># 逻辑表名称</span>
      <span class="token key atrule">actualDataSources (?)</span><span class="token punctuation">:</span> <span class="token comment"># 数据源名称</span>
      <span class="token key atrule">shardingStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 切分策略</span>
        <span class="token key atrule">standard</span><span class="token punctuation">:</span> <span class="token comment"># 用于单分片键的标准分片场景</span>
          <span class="token key atrule">shardingColumn</span><span class="token punctuation">:</span> <span class="token comment"># 分片列名称</span>
          <span class="token key atrule">shardingAlgorithmName</span><span class="token punctuation">:</span> <span class="token comment"># 自动分片算法名称</span>
  <span class="token key atrule">bindingTables (+)</span><span class="token punctuation">:</span> <span class="token comment"># 绑定表规则列表</span>
    <span class="token punctuation">-</span> &lt;logic_table_name_1<span class="token punctuation">,</span> logic_table_name_2<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">&gt;</span> 
    <span class="token punctuation">-</span> &lt;logic_table_name_1<span class="token punctuation">,</span> logic_table_name_2<span class="token punctuation">,</span> <span class="token punctuation">...</span><span class="token punctuation">&gt;</span> 
  <span class="token key atrule">broadcastTables (+)</span><span class="token punctuation">:</span> <span class="token comment"># 广播表规则列表</span>
    <span class="token punctuation">-</span> &lt;table<span class="token punctuation">-</span>name<span class="token punctuation">&gt;</span>
    <span class="token punctuation">-</span> &lt;table<span class="token punctuation">-</span>name<span class="token punctuation">&gt;</span>
  <span class="token key atrule">defaultDatabaseStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 默认数据库分片策略</span>
  <span class="token key atrule">defaultTableStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 默认表分片策略</span>
  <span class="token key atrule">defaultKeyGenerateStrategy</span><span class="token punctuation">:</span> <span class="token comment"># 默认的分布式序列策略</span>
  <span class="token comment"># 分片算法配置</span>
  <span class="token key atrule">shardingAlgorithms</span><span class="token punctuation">:</span>
    <span class="token key atrule">&lt;sharding-algorithm-name&gt; (+)</span><span class="token punctuation">:</span> <span class="token comment"># 分片算法名称</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token comment"># 分片算法类型</span>
      <span class="token key atrule">props</span><span class="token punctuation">:</span> <span class="token comment"># 分片算法属性配置</span>
      <span class="token comment"># ...</span>
  <span class="token comment"># 分布式序列算法配置</span>
  <span class="token key atrule">keyGenerators</span><span class="token punctuation">:</span>
    <span class="token key atrule">&lt;key-generate-algorithm-name&gt; (+)</span><span class="token punctuation">:</span> <span class="token comment"># 分布式序列算法名称</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token comment"># 分布式序列算法类型</span>
      <span class="token key atrule">props</span><span class="token punctuation">:</span> <span class="token comment"># 分布式序列算法属性配置</span>
      <span class="token comment"># ...</span>
<span class="token key atrule">props</span><span class="token punctuation">:</span>
  <span class="token comment"># ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="读写分离" tabindex="-1"><a class="header-anchor" href="#读写分离" aria-hidden="true">#</a> 读写分离</h2><p>配置项说明</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">dataSources</span><span class="token punctuation">:</span> <span class="token comment"># 省略数据源配置，请参考使用手册</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token tag">!REPLICA_QUERY</span>
  <span class="token key atrule">dataSources</span><span class="token punctuation">:</span>
    <span class="token key atrule">&lt;data-source-name&gt; (+)</span><span class="token punctuation">:</span> <span class="token comment"># 读写分离逻辑数据源名称</span>
      <span class="token key atrule">primaryDataSourceName</span><span class="token punctuation">:</span> <span class="token comment"># 主库数据源名称</span>
      <span class="token key atrule">replicaDataSourceNames</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> &lt;replica<span class="token punctuation">-</span>data_source<span class="token punctuation">-</span>name<span class="token punctuation">&gt;</span> (+) <span class="token comment"># 从库数据源名称</span>
      <span class="token key atrule">loadBalancerName</span><span class="token punctuation">:</span> <span class="token comment"># 负载均衡算法名称</span>
  <span class="token comment"># 负载均衡算法配置</span>
  <span class="token key atrule">loadBalancers</span><span class="token punctuation">:</span>
    <span class="token key atrule">&lt;load-balancer-name&gt; (+)</span><span class="token punctuation">:</span> <span class="token comment"># 负载均衡算法名称</span>
      <span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token comment"># 负载均衡算法类型</span>
      <span class="token key atrule">props</span><span class="token punctuation">:</span> <span class="token comment"># 负载均衡算法属性配置</span>
        <span class="token comment"># ...</span>
<span class="token key atrule">props</span><span class="token punctuation">:</span>
  <span class="token comment"># ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4);function J(Z,nn){const t=c("router-link"),p=c("ExternalLinkIcon"),o=c("RouterLink");return u(),r("div",null,[T,n("nav",L,[n("ul",null,[n("li",null,[a(t,{to:"#目录"},{default:e(()=>[s("目录")]),_:1})]),n("li",null,[a(t,{to:"#shardingsphere-proxy"},{default:e(()=>[s("ShardingSphere-Proxy")]),_:1})]),n("li",null,[a(t,{to:"#什么是shardingsphere-proxy"},{default:e(()=>[s("什么是ShardingSphere-Proxy")]),_:1})]),n("li",null,[a(t,{to:"#什么地方使用shardingsphere-proxy"},{default:e(()=>[s("什么地方使用ShardingSphere-Proxy")]),_:1})]),n("li",null,[a(t,{to:"#什么是分库"},{default:e(()=>[s("什么是分库")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#单体项目中为什么要使用shardingsphere-proxy"},{default:e(()=>[s("单体项目中为什么要使用ShardingSphere-Proxy")]),_:1})]),n("li",null,[a(t,{to:"#进程内方案"},{default:e(()=>[s("进程内方案")]),_:1})]),n("li",null,[a(t,{to:"#进程外方案"},{default:e(()=>[s("进程外方案")]),_:1})]),n("li",null,[a(t,{to:"#数据库中间件技术类型"},{default:e(()=>[s("数据库中间件技术类型")]),_:1})])])]),n("li",null,[a(t,{to:"#项目中如何落地shardingsphere-proxy"},{default:e(()=>[s("项目中如何落地ShardingSphere-Proxy")]),_:1})]),n("li",null,[a(t,{to:"#商品表分表场景落地"},{default:e(()=>[s("商品表分表场景落地")]),_:1})]),n("li",null,[a(t,{to:"#整体架构"},{default:e(()=>[s("整体架构")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#分表原理"},{default:e(()=>[s("分表原理")]),_:1})])])]),n("li",null,[a(t,{to:"#商品取模分表-情况2"},{default:e(()=>[s("商品取模分表-情况2")]),_:1})]),n("li",null,[a(t,{to:"#商品取模分表-情况3"},{default:e(()=>[s("商品取模分表-情况3")]),_:1}),n("ul",null,[n("li",null,[a(t,{to:"#商品图片表场景落地"},{default:e(()=>[s("商品图片表场景落地")]),_:1})]),n("li",null,[a(t,{to:"#shardingsphere-数据分片规则"},{default:e(()=>[s("shardingSphere 数据分片规则")]),_:1})])])]),n("li",null,[a(t,{to:"#shardingsphere-v5-1-0-yaml-配置说明"},{default:e(()=>[s("ShardingSphere v5.1.0 YAML 配置说明")]),_:1})]),n("li",null,[a(t,{to:"#读写分离"},{default:e(()=>[s("读写分离")]),_:1})])])]),w,n("p",null,[s("环境："),I,s(" 1、Windows10"),P,s(" 2、linux"),M,s(" 3、 JDK 1.8 "),n("a",A,[s("JDK下载地址"),a(p)])]),D,n("p",null,[s("2、MySQL 8.0.33 准备 安装软件： mysql-installer-community-8.0.33.0 .msi"),U,n("a",q,[s("下载地址"),a(p)])]),n("blockquote",null,[E,n("blockquote",null,[n("p",null,[s("3.1 先下载jdk 11.0.19"),z,n("a",O,[s("下载地址"),a(p)]),B,s(" 3.2 mysql-connector-java-8.0.30.jar"),C,n("a",R,[s("mysql-connector-java-8.0.30.jar下载地址"),a(p)]),j,s(" 3.3 然后下载apache-shardingsphere-5.4.0-shardingsphere-proxy"),G,n("a",H,[s("apache-shardingsphere-5.4.0-shardingsphere-proxy-bin.tar.gz下载"),a(p)])])])]),$,n("p",null,[s("1、先参考文档搭建mysql集群 "),a(o,{to:"/technology/mysql/09mysql_centos.html"},{default:e(()=>[s("Mysql8.0 centos stream 9")]),_:1})]),Q,n("p",null,[n("a",V,[s("YAML配置说明"),a(p)]),F,n("a",Y,[s("自动分片配置说明参考"),a(p)]),K,s(" 数据分片"),W,s(" 配置项说明")]),X])}const an=i(N,[["render",J],["__file","sharding_sphere_proxy001.html.vue"]]);export{an as default};
