import{_ as u,r as p,o as l,c as i,a as n,b as a,w as t,d as s,e as o}from"./app-c1c3c937.js";const r="/images/abpmicroservices/micro007/abpmicroservices0007_0001image.png",k="/images/abpmicroservices/micro007/abpmicroservices0007_0002image.png",d="/images/abpmicroservices/micro007/abpmicroservices0007_0003image.png",m="/images/abpmicroservices/micro007/abpmicroservices0007_0004image.png",_="/images/abpmicroservices/micro007/abpmicroservices0007_0005image.png",S="/images/abpmicroservices/micro007/abpmicroservices0007_0006image.png",v="/images/abpmicroservices/micro007/abpmicroservices0007_0007image.png",b="/images/abpmicroservices/micro007/abpmicroservices0007_0008image.png",E="/images/abpmicroservices/micro007/abpmicroservices0007_0009image.png",h="/images/abpmicroservices/micro007/abpmicroservices0007_0010image.png",A="/images/abpmicroservices/micro007/abpmicroservices0007_0011image.png",y="/images/abpmicroservices/micro007/abpmicroservices0007_0012image.png",g="/images/abpmicroservices/micro007/abpmicroservices0007_0013image.png",R="/images/abpmicroservices/micro007/abpmicroservices0007_0014image.png",T="/images/abpmicroservices/micro007/abpmicroservices0007_0015image.png",O="/images/abpmicroservices/micro007/abpmicroservices0007_0016image.png",q="/images/abpmicroservices/micro007/abpmicroservices0007_0017image.png",C="/images/abpmicroservices/micro007/abpmicroservices0007_0018image.png",W="/images/abpmicroservices/micro007/abpmicroservices0007_0019image.png",P="/images/abpmicroservices/micro007/abpmicroservices0007_0020image.png",f="/images/abpmicroservices/micro007/abpmicroservices0007_0021image.png",N="/images/abpmicroservices/micro007/abpmicroservices0007_0022image.png",$={},L=n("h2",{id:"目录",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#目录","aria-hidden":"true"},"#"),s(" 目录")],-1),I={class:"table-of-contents"},x=o('<h2 id="微服务链路监控-skywalking" tabindex="-1"><a class="header-anchor" href="#微服务链路监控-skywalking" aria-hidden="true">#</a> 微服务链路监控-skywalking</h2><h3 id="什么是链路" tabindex="-1"><a class="header-anchor" href="#什么是链路" aria-hidden="true">#</a> 什么是链路</h3><p>链路：请求执行的路径的集合<br> 如图所示：</p><p><img src="'+r+'" alt="Alt text"></p><p>客户端发起一个请求，这个请求需要执行微服务1，然后执行微服务2，然后执行微服务3<br> 微服务1，微服务2，微服务3组成3条路径，这3个路径集合就是一个链路。</p><h4 id="什么是链路监控" tabindex="-1"><a class="header-anchor" href="#什么是链路监控" aria-hidden="true">#</a> 什么是链路监控</h4><p>链路监控：就是监控一个请求的所有执行路径。<br> 主要是监控执行路径的时间。用来得到每一个执行路径的性能。方便做性能优化。</p><h2 id="电商微服务中为什么要使用链路监控" tabindex="-1"><a class="header-anchor" href="#电商微服务中为什么要使用链路监控" aria-hidden="true">#</a> 电商微服务中为什么要使用链路监控</h2><h2 id="电商微服务" tabindex="-1"><a class="header-anchor" href="#电商微服务" aria-hidden="true">#</a> 电商微服务</h2><p>目前：电商微服务状态如图所示</p><p><img src="'+k+'" alt="Alt text"></p><p>目前完成查询订单，执行路径如下：</p><p>客户端——&gt;API外部网关——&gt;consul——&gt;订单详情聚合服务——&gt;API内部网关——&gt;consul——&gt;订单微服务——&gt;数据库</p><p>完成订单查询，整体上需要7个流程。</p><p>完成订单查询后，会有一个执行时间。<br> 如果执行为3s,我们可能会思考，为什么查询一个订单，需要花费3s时间。是什么原因导致查询订单需要花费3s?这个时候，我们就陷入了性能瓶颈中，为了弄 清楚原因，我们必须知道7个流程中的每一个流程执行时间，我们才能找到原因。<br> 如何知道每一个流程的执行时间呢？<br> 所以：我们就需要使用链路监控</p><h3 id="电商微服务-链路监控" tabindex="-1"><a class="header-anchor" href="#电商微服务-链路监控" aria-hidden="true">#</a> 电商微服务-链路监控</h3><p>电商微服务中，集成链路监控如图所示：</p><p><img src="'+d+'" alt="Alt text"></p><p>在电商微服务系统中，集成链路监控，主要就是为了在查询订单时候，执行7个流程中，每一个流程执行的时间。</p><h3 id="电商微服务系统中落地链路监控" tabindex="-1"><a class="header-anchor" href="#电商微服务系统中落地链路监控" aria-hidden="true">#</a> 电商微服务系统中落地链路监控</h3><h4 id="链路监控技术选项" tabindex="-1"><a class="header-anchor" href="#链路监控技术选项" aria-hidden="true">#</a> 链路监控技术选项</h4><p>目前一些主流的链路监控工具，如表所示：</p><table><thead><tr><th>维度</th><th>Cat</th><th>Zipkin</th><th>PinPoint</th><th>Skywalking</th></tr></thead><tbody><tr><td>实现方式</td><td>代码埋点（拦截器，注解，过滤器等）</td><td>拦截请求，发送（HTTP，MQ）数据至Zipkin服务</td><td>Java探针，字节码增强</td><td>Java探针，字节码增强</td></tr><tr><td>接入方式</td><td>代码侵入</td><td>基于Linkerd或者Sleuth方式，引入配置即可</td><td>JavaAgent字节码，高并发情况下，代理对吞吐量的影响比skywalking和zipkin都大</td><td>JavaAgent字节码，支持20+的中间件、框架、类库</td></tr><tr><td>agent到collector的协议</td><td>http/tcp</td><td>http,MQ</td><td>thrift</td><td>gRPC</td></tr><tr><td>可扩展性</td><td>水平扩展服务端</td><td>多个zipkin-Server实例进行异步消费mq中的监控信息</td><td>collector+web+agent+存储，使得能够水平扩展以便支持大规模服务器集群。</td><td>OAP（skywalking6.x才有OAP这个概念，skywalking5.x叫collector）+Web+agent+存储+zk，使得能够水平扩展以便支持大规模服务器集群。</td></tr><tr><td>数据存储</td><td>Mysql,Hdfs</td><td>ES，mysql,Cassandra</td><td>Hbase(RowKey精确查找，SCAN范围查找，全表扫描),Mysql</td><td>ES，H2，Mysql，TiDB，Sharding-Sphere</td></tr><tr><td>分析粒度</td><td>代码级，全局调用统计，报警，JVM监控</td><td>接口级，支持traceid查询</td><td>方法级，全局调用统计、报警</td><td>方法级，全局调用统计、traceid查询，报警，JVM监控</td></tr><tr><td>调用链可视化</td><td>有</td><td>有</td><td>有</td><td>有</td></tr><tr><td>报表</td><td>丰富</td><td>少</td><td>中</td><td>中</td></tr><tr><td>调用链应用拓扑</td><td>简单，仅限于服务与服务之间</td><td>简单，仅限于服务与服务之间</td><td>好</td><td>好</td></tr><tr><td>埋点方式</td><td>侵入</td><td>侵入</td><td>无侵入</td><td>无侵入</td></tr><tr><td>Heartbeat支持</td><td>有</td><td>无</td><td>有</td><td>有</td></tr><tr><td>Metric支持</td><td>有</td><td>无</td><td>无</td><td>有</td></tr><tr><td>是否支持webflux</td><td>否</td><td>是</td><td>是</td><td>是</td></tr><tr><td>客户端支持</td><td>Java、C/C++、Node.js、Python</td><td>java</td><td>Java,php</td><td>Java, C#, PHP, Node.js, Go</td></tr><tr><td>中文支持</td><td>好</td><td>无</td><td>无</td><td>好</td></tr><tr><td>社区支持</td><td>好</td><td>好</td><td>一般</td><td>好</td></tr><tr><td>国内案例</td><td>美团、携程、陆金所等等</td><td>京东，阿里定制后不开源</td><td>暂无</td><td>阿里，小米，滴滴，华为、当当等等</td></tr><tr><td>社区活跃度（截止2020-2）</td><td>12.7k</td><td>12.5k</td><td>9.9k</td><td>12.3k</td></tr><tr><td>社区活跃度（截止2019-12</td><td>12.3K</td><td>12.2K</td><td>11.8K</td><td></td></tr><tr><td>社区活跃度（截止2018-5）</td><td>4.9k</td><td>8.4k</td><td>5.9k</td><td>3.3k</td></tr></tbody></table><h2 id="电商微服务系统中落地skywalking" tabindex="-1"><a class="header-anchor" href="#电商微服务系统中落地skywalking" aria-hidden="true">#</a> 电商微服务系统中落地SkyWalking</h2><p>基础前提</p><p>1、电商微服务系统<br> 2、jdk 1.8<br> 3、elasticesearch-7.10.1<br> 4、apache-skywalking-apm-bin-es7</p><h3 id="电商微服务系统准备" tabindex="-1"><a class="header-anchor" href="#电商微服务系统准备" aria-hidden="true">#</a> 电商微服务系统准备</h3><p>电商微服务系统如图所示：</p><p><img src="'+m+'" alt="Alt text"></p><p>电商微服务目前由聚合层，框架基础设施层，网关层，微服务层组成</p><h4 id="jdk-准备" tabindex="-1"><a class="header-anchor" href="#jdk-准备" aria-hidden="true">#</a> jdk 准备</h4><p>1、jdk1.8下载地址：https://www.oracle.com/cn/java/technologies/javase/javase-jdk8-downloads.html</p><p>​ 2、jdk1.8安装：直接搜索安装</p><h4 id="elasticsearch准备" tabindex="-1"><a class="header-anchor" href="#elasticsearch准备" aria-hidden="true">#</a> elasticsearch准备</h4><p>​ 1、下载地址：https://www.elastic.co/cn/downloads/past-releases/elasticsearch-7-10-0</p><p>​ 2、文档地址：https://www.elastic.co/guide/en/elasticsearch/reference/7.10/index.html</p>',36),D=o('<p>4、Elasticsearch启动，如图所示：</p><h3 id="apache-skywalking-apm-bin-es7准备" tabindex="-1"><a class="header-anchor" href="#apache-skywalking-apm-bin-es7准备" aria-hidden="true">#</a> apache-skywalking-apm-bin-es7准备</h3><p>1、下载地址：https://archive.apache.org/dist/skywalking/8.7.0/apache-skywalking-apm-es7-8.7.0.tar.gz ​ 如图所示：</p><p><img src="'+_+'" alt="Alt text"></p><h2 id="电商微服务系统skywalking集成架构" tabindex="-1"><a class="header-anchor" href="#电商微服务系统skywalking集成架构" aria-hidden="true">#</a> 电商微服务系统SkyWalking集成架构</h2><p><img src="'+S+'" alt="Alt text"></p><h3 id="链路监控基本角色" tabindex="-1"><a class="header-anchor" href="#链路监控基本角色" aria-hidden="true">#</a> 链路监控基本角色：</h3><p>1、 Agent</p><p>​ SkyWalking客户端，具体就是每一个微服务或网关项目</p><p>2、Collecter</p><p>​ SkyWalking收集器，用来收集微服务发送的时间数据</p><p>3、Storage</p><p>​ SkyWalking存储器(就是ElasticSearch)，存储Storage发送的时间数据</p><p>4、APM(UI)</p><p>SkyWalking显示器，显示ElasticSearch中的时间数据</p><h3 id="skywalking-角色作用" tabindex="-1"><a class="header-anchor" href="#skywalking-角色作用" aria-hidden="true">#</a> skywalking 角色作用</h3><ol><li>ES7:存储链路（查询订单）时间</li><li>collector:收集链路（查询订单）时间</li><li>webapp:显示链路（查询订单）时间</li><li>skyAPM.Agent.AspNetCore:发送链路（查询订单）时间<br> 查询订单时间的流程： 1、订单微服务——&gt;SkyAPM.Agent.AspNetCore 2、SkyAPM.Agent.AspNentCore——&gt;Collector 3、collector——&gt;ES7 4、webapp显示查询订单的时间。</li></ol><h3 id="订单查询业务场景落地" tabindex="-1"><a class="header-anchor" href="#订单查询业务场景落地" aria-hidden="true">#</a> 订单查询业务场景落地</h3><p>条件</p><p>1、订单微服务链路监控基本角色：</p><p>1、 Agent</p><p>​ SkyWalking客户端，具体就是每一个微服务或网关项目</p><p>2、Collecter</p><p>​ SkyWalking收集器，用来收集微服务发送的时间数据</p><p>3、Storage</p><p>​ SkyWalking存储器(就是ElasticSearch)，存储Storage发送的时间数据</p><p>4、APM(UI)</p><p>SkyWalking显示器，显示ElasticSearch中的时间数据</p><h3 id="订单查询业务场景落地-1" tabindex="-1"><a class="header-anchor" href="#订单查询业务场景落地-1" aria-hidden="true">#</a> 订单查询业务场景落地</h3><p>条件</p><p>1、订单微服务LKN.Order.HttpApi.Host</p><p>2、SkyAPM.Agent.AspNetCore</p><p>步骤</p><p>1、elasticsearch-7.10.1准备</p><p>​ 1.1、先进入elasticsearch-7.10.1 中bin目录中</p><p>1.2、然后使用cmd通过elasticsearch.bat启动</p><p><img src="'+v+'" alt="Alt text"></p><p>2、apache-skywalking-apm-bin-es7准备</p><p>​ 2.1、先进入apache-skywalking-apm-bin-es7 中config目录中</p><p>​ 如图所示：</p><p><img src="'+b+`" alt="Alt text"></p><p>2.2、然后进入application.yml文件中，修改配置，代码如下</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">core</span><span class="token punctuation">:</span>
 <span class="token key atrule">selector</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE<span class="token punctuation">:</span>default<span class="token punctuation">}</span>
 <span class="token key atrule">default</span><span class="token punctuation">:</span>
   <span class="token comment"># Mixed: Receive agent data, Level 1 aggregate, Level 2 aggregate</span>
   <span class="token comment"># Receiver: Receive agent data, Level 1 aggregate</span>
   <span class="token comment"># Aggregator: Level 2 aggregate</span>
   <span class="token key atrule">role</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_ROLE<span class="token punctuation">:</span>Mixed<span class="token punctuation">}</span> <span class="token comment"># Mixed/Receiver/Aggregator</span>
   <span class="token key atrule">restHost</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_REST_HOST<span class="token punctuation">:</span>0.0.0.0<span class="token punctuation">}</span>
   <span class="token key atrule">restPort</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_REST_PORT<span class="token punctuation">:</span><span class="token number">12800</span><span class="token punctuation">}</span>
   <span class="token key atrule">restContextPath</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_REST_CONTEXT_PATH<span class="token punctuation">:</span>/<span class="token punctuation">}</span>
   <span class="token key atrule">restMinThreads</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_REST_JETTY_MIN_THREADS<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span>
   <span class="token key atrule">restMaxThreads</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_REST_JETTY_MAX_THREADS<span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">}</span>
   <span class="token key atrule">restIdleTimeOut</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_REST_JETTY_IDLE_TIMEOUT<span class="token punctuation">:</span><span class="token number">30000</span><span class="token punctuation">}</span>
   <span class="token key atrule">restAcceptorPriorityDelta</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_REST_JETTY_DELTA<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span>
   <span class="token key atrule">restAcceptQueueSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_REST_JETTY_QUEUE_SIZE<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span>
   <span class="token key atrule">httpMaxRequestHeaderSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_HTTP_MAX_REQUEST_HEADER_SIZE<span class="token punctuation">:</span><span class="token number">8192</span><span class="token punctuation">}</span>
   <span class="token key atrule">gRPCHost</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_GRPC_HOST<span class="token punctuation">:</span>0.0.0.0<span class="token punctuation">}</span>
   <span class="token key atrule">gRPCPort</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_GRPC_PORT<span class="token punctuation">:</span><span class="token number">11800</span><span class="token punctuation">}</span>
   <span class="token key atrule">maxConcurrentCallsPerConnection</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_GRPC_MAX_CONCURRENT_CALL<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span>
   <span class="token key atrule">maxMessageSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_GRPC_MAX_MESSAGE_SIZE<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span>
   <span class="token key atrule">gRPCThreadPoolQueueSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_GRPC_POOL_QUEUE_SIZE<span class="token punctuation">:</span><span class="token number">-1</span><span class="token punctuation">}</span>
   <span class="token key atrule">gRPCThreadPoolSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_GRPC_THREAD_POOL_SIZE<span class="token punctuation">:</span><span class="token number">-1</span><span class="token punctuation">}</span>
   <span class="token key atrule">gRPCSslEnabled</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_GRPC_SSL_ENABLED<span class="token punctuation">:</span><span class="token boolean important">false</span><span class="token punctuation">}</span>
   <span class="token key atrule">gRPCSslKeyPath</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_GRPC_SSL_KEY_PATH<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">gRPCSslCertChainPath</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_GRPC_SSL_CERT_CHAIN_PATH<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">gRPCSslTrustedCAPath</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_GRPC_SSL_TRUSTED_CA_PATH<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">downsampling</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> Hour
     <span class="token punctuation">-</span> Day
   <span class="token comment"># Set a timeout on metrics data. After the timeout has expired, the metrics data will automatically be deleted.</span>
   <span class="token key atrule">enableDataKeeperExecutor</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_ENABLE_DATA_KEEPER_EXECUTOR<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span> <span class="token comment"># Turn it off then automatically metrics data delete will be close.</span>
   <span class="token key atrule">dataKeeperExecutePeriod</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_DATA_KEEPER_EXECUTE_PERIOD<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token comment"># How often the data keeper executor runs periodically, unit is minute</span>
   <span class="token key atrule">recordDataTTL</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_RECORD_DATA_TTL<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">}</span> <span class="token comment"># Unit is day</span>
   <span class="token key atrule">metricsDataTTL</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_METRICS_DATA_TTL<span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">}</span> <span class="token comment"># Unit is day</span>
   <span class="token comment"># The period of L1 aggregation flush to L2 aggregation. Unit is ms.</span>
   <span class="token key atrule">l1FlushPeriod</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_L1_AGGREGATION_FLUSH_PERIOD<span class="token punctuation">:</span><span class="token number">500</span><span class="token punctuation">}</span>
   <span class="token comment"># The threshold of session time. Unit is ms. Default value is 70s.</span>
   <span class="token key atrule">storageSessionTimeout</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_STORAGE_SESSION_TIMEOUT<span class="token punctuation">:</span><span class="token number">70000</span><span class="token punctuation">}</span>
   <span class="token comment"># Cache metrics data for 1 minute to reduce database queries, and if the OAP cluster changes within that minute,</span>
   <span class="token comment"># the metrics may not be accurate within that minute.</span>
   <span class="token key atrule">enableDatabaseSession</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_ENABLE_DATABASE_SESSION<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
   <span class="token key atrule">topNReportPeriod</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_TOPN_REPORT_PERIOD<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">}</span> <span class="token comment"># top_n record worker report cycle, unit is minute</span>
   <span class="token comment"># Extra model column are the column defined by in the codes, These columns of model are not required logically in aggregation or further query,</span>
   <span class="token comment"># and it will cause more load for memory, network of OAP and storage.</span>
   <span class="token comment"># But, being activated, user could see the name in the storage entities, which make users easier to use 3rd party tool, such as Kibana-&gt;ES, to query the data by themselves.</span>
   <span class="token key atrule">activeExtraModelColumns</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_ACTIVE_EXTRA_MODEL_COLUMNS<span class="token punctuation">:</span><span class="token boolean important">false</span><span class="token punctuation">}</span>
   <span class="token comment"># The max length of service + instance names should be less than 200</span>
   <span class="token key atrule">serviceNameMaxLength</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_SERVICE_NAME_MAX_LENGTH<span class="token punctuation">:</span><span class="token number">70</span><span class="token punctuation">}</span>
   <span class="token key atrule">instanceNameMaxLength</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_INSTANCE_NAME_MAX_LENGTH<span class="token punctuation">:</span><span class="token number">70</span><span class="token punctuation">}</span>
   <span class="token comment"># The max length of service + endpoint names should be less than 240</span>
   <span class="token key atrule">endpointNameMaxLength</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_ENDPOINT_NAME_MAX_LENGTH<span class="token punctuation">:</span><span class="token number">150</span><span class="token punctuation">}</span>
   <span class="token comment"># Define the set of span tag keys, which should be searchable through the GraphQL.</span>
   <span class="token key atrule">searchableTracesTags</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_SEARCHABLE_TAG_KEYS<span class="token punctuation">:</span>http.method<span class="token punctuation">,</span>status_code<span class="token punctuation">,</span>db.type<span class="token punctuation">,</span>db.instance<span class="token punctuation">,</span>mq.queue<span class="token punctuation">,</span>mq.topic<span class="token punctuation">,</span>mq.broker<span class="token punctuation">}</span>
   <span class="token comment"># Define the set of log tag keys, which should be searchable through the GraphQL.</span>
   <span class="token key atrule">searchableLogsTags</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_SEARCHABLE_LOGS_TAG_KEYS<span class="token punctuation">:</span>level<span class="token punctuation">}</span>
   <span class="token comment"># Define the set of alarm tag keys, which should be searchable through the GraphQL.</span>
   <span class="token key atrule">searchableAlarmTags</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_SEARCHABLE_ALARM_TAG_KEYS<span class="token punctuation">:</span>level<span class="token punctuation">}</span>
   <span class="token comment"># The number of threads used to prepare metrics data to the storage.</span>
   <span class="token key atrule">prepareThreads</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_PREPARE_THREADS<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span>
   <span class="token comment"># Turn it on then automatically grouping endpoint by the given OpenAPI definitions.</span>
   <span class="token key atrule">enableEndpointNameGroupingByOpenapi</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_CORE_ENABLE_ENDPOINT_NAME_GROUPING_BY_OPAENAPI<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
<span class="token key atrule">storage</span><span class="token punctuation">:</span>
 <span class="token key atrule">selector</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE<span class="token punctuation">:</span>elasticsearch7<span class="token punctuation">}</span>
 <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span>
   <span class="token key atrule">nameSpace</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_NAMESPACE<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">clusterNodes</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_CLUSTER_NODES<span class="token punctuation">:</span>localhost<span class="token punctuation">:</span><span class="token number">9200</span><span class="token punctuation">}</span>
   <span class="token key atrule">protocol</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_HTTP_PROTOCOL<span class="token punctuation">:</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">connectTimeout</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_CONNECT_TIMEOUT<span class="token punctuation">:</span><span class="token number">500</span><span class="token punctuation">}</span>
   <span class="token key atrule">socketTimeout</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SOCKET_TIMEOUT<span class="token punctuation">:</span><span class="token number">30000</span><span class="token punctuation">}</span>
   <span class="token key atrule">user</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_ES_USER<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_ES_PASSWORD<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">trustStorePath</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SSL_JKS_PATH<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">trustStorePass</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SSL_JKS_PASS<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">secretsManagementFile</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_ES_SECRETS_MANAGEMENT_FILE<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span> <span class="token comment"># Secrets management file in the properties format includes the username, password, which are managed by 3rd party tool.</span>
   <span class="token key atrule">dayStep</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_DAY_STEP<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token comment"># Represent the number of days in the one minute/hour/day index.</span>
   <span class="token key atrule">indexShardsNumber</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_INDEX_SHARDS_NUMBER<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token comment"># Shard number of new indexes</span>
   <span class="token key atrule">indexReplicasNumber</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_INDEX_REPLICAS_NUMBER<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token comment"># Replicas number of new indexes</span>
   <span class="token comment"># Super data set has been defined in the codes, such as trace segments.The following 3 config would be improve es performance when storage super size data in es.</span>
   <span class="token key atrule">superDatasetDayStep</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_SUPERDATASET_STORAGE_DAY_STEP<span class="token punctuation">:</span><span class="token number">-1</span><span class="token punctuation">}</span> <span class="token comment"># Represent the number of days in the super size dataset record index, the default value is the same as dayStep when the value is less than 0</span>
   <span class="token key atrule">superDatasetIndexShardsFactor</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SUPER_DATASET_INDEX_SHARDS_FACTOR<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token comment">#  This factor provides more shards for the super data set, shards number = indexShardsNumber * superDatasetIndexShardsFactor. Also, this factor effects Zipkin and Jaeger traces.</span>
   <span class="token key atrule">superDatasetIndexReplicasNumber</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SUPER_DATASET_INDEX_REPLICAS_NUMBER<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span> <span class="token comment"># Represent the replicas number in the super size dataset record index, the default value is 0.</span>
   <span class="token key atrule">indexTemplateOrder</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_INDEX_TEMPLATE_ORDER<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span> <span class="token comment"># the order of index template</span>
   <span class="token key atrule">bulkActions</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_BULK_ACTIONS<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">}</span> <span class="token comment"># Execute the async bulk record data every \${SW_STORAGE_ES_BULK_ACTIONS} requests</span>
   <span class="token comment"># flush the bulk every 10 seconds whatever the number of requests</span>
   <span class="token comment"># INT(flushInterval * 2/3) would be used for index refresh period.</span>
   <span class="token key atrule">flushInterval</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_FLUSH_INTERVAL<span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">}</span>
   <span class="token key atrule">concurrentRequests</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_CONCURRENT_REQUESTS<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token comment"># the number of concurrent requests</span>
   <span class="token key atrule">resultWindowMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_QUERY_MAX_WINDOW_SIZE<span class="token punctuation">:</span><span class="token number">10000</span><span class="token punctuation">}</span>
   <span class="token key atrule">metadataQueryMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_QUERY_MAX_SIZE<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">}</span>
   <span class="token key atrule">segmentQueryMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_QUERY_SEGMENT_SIZE<span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">}</span>
   <span class="token key atrule">profileTaskQueryMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_QUERY_PROFILE_TASK_SIZE<span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">}</span>
   <span class="token key atrule">oapAnalyzer</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_OAP_ANALYZER<span class="token punctuation">:</span><span class="token string">&quot;{\\&quot;analyzer\\&quot;:{\\&quot;oap_analyzer\\&quot;:{\\&quot;type\\&quot;:\\&quot;stop\\&quot;}}}&quot;</span><span class="token punctuation">}</span> <span class="token comment"># the oap analyzer.</span>
   <span class="token key atrule">oapLogAnalyzer</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_OAP_LOG_ANALYZER<span class="token punctuation">:</span><span class="token string">&quot;{\\&quot;analyzer\\&quot;:{\\&quot;oap_log_analyzer\\&quot;:{\\&quot;type\\&quot;:\\&quot;standard\\&quot;}}}&quot;</span><span class="token punctuation">}</span> <span class="token comment"># the oap log analyzer. It could be customized by the ES analyzer configuration to support more language log formats, such as Chinese log, Japanese log and etc.</span>
   <span class="token key atrule">advanced</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_ADVANCED<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
 <span class="token key atrule">elasticsearch7</span><span class="token punctuation">:</span>
   <span class="token key atrule">nameSpace</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_NAMESPACE<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">clusterNodes</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_CLUSTER_NODES<span class="token punctuation">:</span>localhost<span class="token punctuation">:</span><span class="token number">9200</span><span class="token punctuation">}</span>
   <span class="token key atrule">protocol</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_HTTP_PROTOCOL<span class="token punctuation">:</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">connectTimeout</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_CONNECT_TIMEOUT<span class="token punctuation">:</span><span class="token number">500</span><span class="token punctuation">}</span>
   <span class="token key atrule">socketTimeout</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SOCKET_TIMEOUT<span class="token punctuation">:</span><span class="token number">30000</span><span class="token punctuation">}</span>
   <span class="token key atrule">trustStorePath</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SSL_JKS_PATH<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">trustStorePass</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SSL_JKS_PASS<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">dayStep</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_DAY_STEP<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token comment"># Represent the number of days in the one minute/hour/day index.</span>
   <span class="token key atrule">indexShardsNumber</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_INDEX_SHARDS_NUMBER<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token comment"># Shard number of new indexes</span>
   <span class="token key atrule">indexReplicasNumber</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_INDEX_REPLICAS_NUMBER<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token comment"># Replicas number of new indexes</span>
   <span class="token comment"># Super data set has been defined in the codes, such as trace segments.The following 3 config would be improve es performance when storage super size data in es.</span>
   <span class="token key atrule">superDatasetDayStep</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_SUPERDATASET_STORAGE_DAY_STEP<span class="token punctuation">:</span><span class="token number">-1</span><span class="token punctuation">}</span> <span class="token comment"># Represent the number of days in the super size dataset record index, the default value is the same as dayStep when the value is less than 0</span>
   <span class="token key atrule">superDatasetIndexShardsFactor</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SUPER_DATASET_INDEX_SHARDS_FACTOR<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token comment">#  This factor provides more shards for the super data set, shards number = indexShardsNumber * superDatasetIndexShardsFactor. Also, this factor effects Zipkin and Jaeger traces.</span>
   <span class="token key atrule">superDatasetIndexReplicasNumber</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SUPER_DATASET_INDEX_REPLICAS_NUMBER<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span> <span class="token comment"># Represent the replicas number in the super size dataset record index, the default value is 0.</span>
   <span class="token key atrule">indexTemplateOrder</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_INDEX_TEMPLATE_ORDER<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span> <span class="token comment"># the order of index template</span>
   <span class="token key atrule">user</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_ES_USER<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_ES_PASSWORD<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">secretsManagementFile</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_ES_SECRETS_MANAGEMENT_FILE<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span> <span class="token comment"># Secrets management file in the properties format includes the username, password, which are managed by 3rd party tool.</span>
   <span class="token key atrule">bulkActions</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_BULK_ACTIONS<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">}</span> <span class="token comment"># Execute the async bulk record data every \${SW_STORAGE_ES_BULK_ACTIONS} requests</span>
   <span class="token comment"># flush the bulk every 10 seconds whatever the number of requests</span>
   <span class="token comment"># INT(flushInterval * 2/3) would be used for index refresh period.</span>
   <span class="token key atrule">flushInterval</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_FLUSH_INTERVAL<span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">}</span>
   <span class="token key atrule">concurrentRequests</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_CONCURRENT_REQUESTS<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token comment"># the number of concurrent requests</span>
   <span class="token key atrule">resultWindowMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_QUERY_MAX_WINDOW_SIZE<span class="token punctuation">:</span><span class="token number">10000</span><span class="token punctuation">}</span>
   <span class="token key atrule">metadataQueryMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_QUERY_MAX_SIZE<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">}</span>
   <span class="token key atrule">segmentQueryMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_QUERY_SEGMENT_SIZE<span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">}</span>
   <span class="token key atrule">profileTaskQueryMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_QUERY_PROFILE_TASK_SIZE<span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">}</span>
   <span class="token key atrule">oapAnalyzer</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_OAP_ANALYZER<span class="token punctuation">:</span><span class="token string">&quot;{\\&quot;analyzer\\&quot;:{\\&quot;oap_analyzer\\&quot;:{\\&quot;type\\&quot;:\\&quot;stop\\&quot;}}}&quot;</span><span class="token punctuation">}</span> <span class="token comment"># the oap analyzer.</span>
   <span class="token key atrule">oapLogAnalyzer</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_OAP_LOG_ANALYZER<span class="token punctuation">:</span><span class="token string">&quot;{\\&quot;analyzer\\&quot;:{\\&quot;oap_log_analyzer\\&quot;:{\\&quot;type\\&quot;:\\&quot;standard\\&quot;}}}&quot;</span><span class="token punctuation">}</span> <span class="token comment"># the oap log analyzer. It could be customized by the ES analyzer configuration to support more language log formats, such as Chinese log, Japanese log and etc.</span>
   <span class="token key atrule">advanced</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_ADVANCED<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>

 <span class="token key atrule">h2</span><span class="token punctuation">:</span>
   <span class="token key atrule">driver</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_H2_DRIVER<span class="token punctuation">:</span>org.h2.jdbcx.JdbcDataSource<span class="token punctuation">}</span>
   <span class="token key atrule">url</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_H2_URL<span class="token punctuation">:</span>jdbc<span class="token punctuation">:</span>h2<span class="token punctuation">:</span>mem<span class="token punctuation">:</span>skywalking<span class="token punctuation">-</span>oap<span class="token punctuation">-</span>db;DB_CLOSE_DELAY=<span class="token punctuation">-</span><span class="token number">1</span><span class="token punctuation">}</span>
   <span class="token key atrule">user</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_H2_USER<span class="token punctuation">:</span>sa<span class="token punctuation">}</span>
   <span class="token key atrule">metadataQueryMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_H2_QUERY_MAX_SIZE<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">}</span>
   <span class="token key atrule">maxSizeOfArrayColumn</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_MAX_SIZE_OF_ARRAY_COLUMN<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">}</span>
   <span class="token key atrule">numOfSearchableValuesPerTag</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_NUM_OF_SEARCHABLE_VALUES_PER_TAG<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span>
 <span class="token key atrule">mysql</span><span class="token punctuation">:</span>
   <span class="token key atrule">properties</span><span class="token punctuation">:</span>
     <span class="token key atrule">jdbcUrl</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_JDBC_URL<span class="token punctuation">:</span><span class="token string">&quot;jdbc:mysql://localhost:3306/swtest&quot;</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.user</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_USER<span class="token punctuation">:</span>root<span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.password</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_PASSWORD<span class="token punctuation">:</span>root@1234<span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.cachePrepStmts</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_CACHE_PREP_STMTS<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.prepStmtCacheSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_PREP_STMT_CACHE_SQL_SIZE<span class="token punctuation">:</span><span class="token number">250</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.prepStmtCacheSqlLimit</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_PREP_STMT_CACHE_SQL_LIMIT<span class="token punctuation">:</span><span class="token number">2048</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.useServerPrepStmts</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_USE_SERVER_PREP_STMTS<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
   <span class="token key atrule">metadataQueryMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_MYSQL_QUERY_MAX_SIZE<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">}</span>
   <span class="token key atrule">maxSizeOfArrayColumn</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_MAX_SIZE_OF_ARRAY_COLUMN<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">}</span>
   <span class="token key atrule">numOfSearchableValuesPerTag</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_NUM_OF_SEARCHABLE_VALUES_PER_TAG<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span>
 <span class="token key atrule">tidb</span><span class="token punctuation">:</span>
   <span class="token key atrule">properties</span><span class="token punctuation">:</span>
     <span class="token key atrule">jdbcUrl</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_JDBC_URL<span class="token punctuation">:</span><span class="token string">&quot;jdbc:mysql://localhost:4000/tidbswtest&quot;</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.user</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_USER<span class="token punctuation">:</span>root<span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.password</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_PASSWORD<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.cachePrepStmts</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_CACHE_PREP_STMTS<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.prepStmtCacheSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_PREP_STMT_CACHE_SQL_SIZE<span class="token punctuation">:</span><span class="token number">250</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.prepStmtCacheSqlLimit</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_PREP_STMT_CACHE_SQL_LIMIT<span class="token punctuation">:</span><span class="token number">2048</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.useServerPrepStmts</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_USE_SERVER_PREP_STMTS<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.useAffectedRows</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_USE_AFFECTED_ROWS<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
   <span class="token key atrule">metadataQueryMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_MYSQL_QUERY_MAX_SIZE<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">}</span>
   <span class="token key atrule">maxSizeOfArrayColumn</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_MAX_SIZE_OF_ARRAY_COLUMN<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">}</span>
   <span class="token key atrule">numOfSearchableValuesPerTag</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_NUM_OF_SEARCHABLE_VALUES_PER_TAG<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span>
 <span class="token key atrule">influxdb</span><span class="token punctuation">:</span>
   <span class="token comment"># InfluxDB configuration</span>
   <span class="token key atrule">url</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_INFLUXDB_URL<span class="token punctuation">:</span>http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8086</span><span class="token punctuation">}</span>
   <span class="token key atrule">user</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_INFLUXDB_USER<span class="token punctuation">:</span>root<span class="token punctuation">}</span>
   <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_INFLUXDB_PASSWORD<span class="token punctuation">:</span><span class="token punctuation">}</span>
   <span class="token key atrule">database</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_INFLUXDB_DATABASE<span class="token punctuation">:</span>skywalking<span class="token punctuation">}</span>
   <span class="token key atrule">actions</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_INFLUXDB_ACTIONS<span class="token punctuation">:</span><span class="token number">1000</span><span class="token punctuation">}</span> <span class="token comment"># the number of actions to collect</span>
   <span class="token key atrule">duration</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_INFLUXDB_DURATION<span class="token punctuation">:</span><span class="token number">1000</span><span class="token punctuation">}</span> <span class="token comment"># the time to wait at most (milliseconds)</span>
   <span class="token key atrule">batchEnabled</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_INFLUXDB_BATCH_ENABLED<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
   <span class="token key atrule">fetchTaskLogMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_INFLUXDB_FETCH_TASK_LOG_MAX_SIZE<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">}</span> <span class="token comment"># the max number of fetch task log in a request</span>
   <span class="token key atrule">connectionResponseFormat</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_INFLUXDB_CONNECTION_RESPONSE_FORMAT<span class="token punctuation">:</span>MSGPACK<span class="token punctuation">}</span> <span class="token comment"># the response format of connection to influxDB, cannot be anything but MSGPACK or JSON.</span>
 <span class="token key atrule">postgresql</span><span class="token punctuation">:</span>
   <span class="token key atrule">properties</span><span class="token punctuation">:</span>
     <span class="token key atrule">jdbcUrl</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_JDBC_URL<span class="token punctuation">:</span><span class="token string">&quot;jdbc:postgresql://localhost:5432/skywalking&quot;</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.user</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_USER<span class="token punctuation">:</span>postgres<span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.password</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_PASSWORD<span class="token punctuation">:</span><span class="token number">123456</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.cachePrepStmts</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_CACHE_PREP_STMTS<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.prepStmtCacheSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_PREP_STMT_CACHE_SQL_SIZE<span class="token punctuation">:</span><span class="token number">250</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.prepStmtCacheSqlLimit</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_PREP_STMT_CACHE_SQL_LIMIT<span class="token punctuation">:</span><span class="token number">2048</span><span class="token punctuation">}</span>
     <span class="token key atrule">dataSource.useServerPrepStmts</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_DATA_SOURCE_USE_SERVER_PREP_STMTS<span class="token punctuation">:</span><span class="token boolean important">true</span><span class="token punctuation">}</span>
   <span class="token key atrule">metadataQueryMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_MYSQL_QUERY_MAX_SIZE<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">}</span>
   <span class="token key atrule">maxSizeOfArrayColumn</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_MAX_SIZE_OF_ARRAY_COLUMN<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">}</span>
   <span class="token key atrule">numOfSearchableValuesPerTag</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_NUM_OF_SEARCHABLE_VALUES_PER_TAG<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span>
 <span class="token key atrule">zipkin-elasticsearch7</span><span class="token punctuation">:</span>
   <span class="token key atrule">nameSpace</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_NAMESPACE<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">clusterNodes</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_CLUSTER_NODES<span class="token punctuation">:</span>localhost<span class="token punctuation">:</span><span class="token number">9200</span><span class="token punctuation">}</span>
   <span class="token key atrule">protocol</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_HTTP_PROTOCOL<span class="token punctuation">:</span><span class="token string">&quot;http&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">trustStorePath</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SSL_JKS_PATH<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">trustStorePass</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SSL_JKS_PASS<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">dayStep</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_DAY_STEP<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token comment"># Represent the number of days in the one minute/hour/day index.</span>
   <span class="token key atrule">indexShardsNumber</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_INDEX_SHARDS_NUMBER<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token comment"># Shard number of new indexes</span>
   <span class="token key atrule">indexReplicasNumber</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_INDEX_REPLICAS_NUMBER<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span> <span class="token comment"># Replicas number of new indexes</span>
   <span class="token comment"># Super data set has been defined in the codes, such as trace segments.The following 3 config would be improve es performance when storage super size data in es.</span>
   <span class="token key atrule">superDatasetDayStep</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_SUPERDATASET_STORAGE_DAY_STEP<span class="token punctuation">:</span><span class="token number">-1</span><span class="token punctuation">}</span> <span class="token comment"># Represent the number of days in the super size dataset record index, the default value is the same as dayStep when the value is less than 0</span>
   <span class="token key atrule">superDatasetIndexShardsFactor</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SUPER_DATASET_INDEX_SHARDS_FACTOR<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">}</span> <span class="token comment">#  This factor provides more shards for the super data set, shards number = indexShardsNumber * superDatasetIndexShardsFactor. Also, this factor effects Zipkin and Jaeger traces.</span>
   <span class="token key atrule">superDatasetIndexReplicasNumber</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_SUPER_DATASET_INDEX_REPLICAS_NUMBER<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">}</span> <span class="token comment"># Represent the replicas number in the super size dataset record index, the default value is 0.</span>
   <span class="token key atrule">user</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_ES_USER<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">password</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_ES_PASSWORD<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
   <span class="token key atrule">secretsManagementFile</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_ES_SECRETS_MANAGEMENT_FILE<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span> <span class="token comment"># Secrets management file in the properties format includes the username, password, which are managed by 3rd party tool.</span>
   <span class="token key atrule">bulkActions</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_BULK_ACTIONS<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">}</span> <span class="token comment"># Execute the async bulk record data every \${SW_STORAGE_ES_BULK_ACTIONS} requests</span>
   <span class="token comment"># flush the bulk every 10 seconds whatever the number of requests</span>
   <span class="token comment"># INT(flushInterval * 2/3) would be used for index refresh period.</span>
   <span class="token key atrule">flushInterval</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_FLUSH_INTERVAL<span class="token punctuation">:</span><span class="token number">15</span><span class="token punctuation">}</span>
   <span class="token key atrule">concurrentRequests</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_CONCURRENT_REQUESTS<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span> <span class="token comment"># the number of concurrent requests</span>
   <span class="token key atrule">resultWindowMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_QUERY_MAX_WINDOW_SIZE<span class="token punctuation">:</span><span class="token number">10000</span><span class="token punctuation">}</span>
   <span class="token key atrule">metadataQueryMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_QUERY_MAX_SIZE<span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">}</span>
   <span class="token key atrule">segmentQueryMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_QUERY_SEGMENT_SIZE<span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">}</span>
   <span class="token key atrule">profileTaskQueryMaxSize</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_QUERY_PROFILE_TASK_SIZE<span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">}</span>
   <span class="token key atrule">oapAnalyzer</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_OAP_ANALYZER<span class="token punctuation">:</span><span class="token string">&quot;{\\&quot;analyzer\\&quot;:{\\&quot;oap_analyzer\\&quot;:{\\&quot;type\\&quot;:\\&quot;stop\\&quot;}}}&quot;</span><span class="token punctuation">}</span> <span class="token comment"># the oap analyzer.</span>
   <span class="token key atrule">oapLogAnalyzer</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_OAP_LOG_ANALYZER<span class="token punctuation">:</span><span class="token string">&quot;{\\&quot;analyzer\\&quot;:{\\&quot;oap_log_analyzer\\&quot;:{\\&quot;type\\&quot;:\\&quot;standard\\&quot;}}}&quot;</span><span class="token punctuation">}</span> <span class="token comment"># the oap log analyzer. It could be customized by the ES analyzer configuration to support more language log formats, such as Chinese log, Japanese log and etc.</span>
   <span class="token key atrule">advanced</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>SW_STORAGE_ES_ADVANCED<span class="token punctuation">:</span><span class="token string">&quot;&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="核心配置" tabindex="-1"><a class="header-anchor" href="#核心配置" aria-hidden="true">#</a> 核心配置：</h5><p>​ 1、selector: \${SW_STORAGE:elasticsearch7} 选择elasticsearch7存储</p><p>​ 2、gRPCHost: \${SW_CORE_GRPC_HOST:0.0.0.0} 数据收集IP ​ gRPCPort: \${SW_CORE_GRPC_PORT:11800}数据收集端口</p><p>​ 3、restHost: \${SW_CORE_REST_HOST:0.0.0.0}数据显示IP restPort: \${SW_CORE_REST_PORT:12800}数据显示端口</p><p>2.3、然后进入apache-skywalking-apm-bin-es7中bin目录中</p><p>​ 如图所示：</p><p><img src="`+E+`" alt="Alt text"></p><p>2.4、然后使用oapService.bat启动apache-skywalking-apm-bin-es7</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>    oapService.bat
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>​ 如图所示：</p><p><img src="`+h+'" alt="Alt text"></p><p>2.5、然后进入apache-skywalking-apm-bin-es7中logs目录中</p><p><img src="'+A+'" alt="Alt text"></p><p>2.6、然后再logs目录中查看日志文件</p><p><img src="'+y+'" alt="Alt text"></p><p>2.7、然后进入apache-skywalking-apm-bin-es7中webapp目录中</p><p><img src="'+g+`" alt="Alt text"></p><p>2.8、然后在webapp.yml文件中，修改配置内容</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token comment"># Licensed to the Apache Software Foundation (ASF) under one or more</span>
<span class="token comment"># contributor license agreements.  See the NOTICE file distributed with</span>
<span class="token comment"># this work for additional information regarding copyright ownership.</span>
<span class="token comment"># The ASF licenses this file to You under the Apache License, Version 2.0</span>
<span class="token comment"># (the &quot;License&quot;); you may not use this file except in compliance with</span>
<span class="token comment"># the License.  You may obtain a copy of the License at</span>
<span class="token comment">#</span>
<span class="token comment">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="token comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment"># See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>

<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> oap<span class="token punctuation">-</span>route
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//oap<span class="token punctuation">-</span>service
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/graphql/<span class="token important">**</span>
    <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
      <span class="token key atrule">client</span><span class="token punctuation">:</span>
        <span class="token key atrule">simple</span><span class="token punctuation">:</span>
          <span class="token key atrule">instances</span><span class="token punctuation">:</span>
            <span class="token key atrule">oap-service</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span><span class="token number">12800</span>
            <span class="token comment"># - uri: http://&lt;oap-host-1&gt;:&lt;oap-port1&gt;</span>
            <span class="token comment"># - uri: http://&lt;oap-host-2&gt;:&lt;oap-port2&gt;</span>

  <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
    <span class="token key atrule">throw-exception-if-no-handler-found</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
      <span class="token key atrule">add-mappings</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">base-path</span><span class="token punctuation">:</span> /manage
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="核心配置-1" tabindex="-1"><a class="header-anchor" href="#核心配置-1" aria-hidden="true">#</a> 核心配置：</h5><p>​ 1、server: port: 8081 浏览器访问端口</p><p>​ 2、- uri: http://127.0.0.1:12800 连接collcetor收集器地址</p><p>2.9、然后进入apache-skywalking-apm-bin-es7中bin目录中</p><p>如图所示：</p><p><img src="`+R+'" alt="Alt text"></p><p>2.10、然后使用webappService.bat启动apache-skywalking-apm-bin-es7</p><p>如图所示：</p><p><img src="'+T+'" alt="Alt text"></p><p>2.11、然后使用浏览器访问apache-skywalking-apm-bin-es7</p><p>输入地址：http://localhost:8080/</p><p>结果如图所示:</p><p><img src="'+O+'" alt="Alt text"></p><p>3、LKN.Order.HttpApi.Host准备</p><p>​ 3.1、 先在LKN.Order.HttpApi.Host中通过nuget引入SkyAPM.Agent.AspNetCore<br> ​ 如图所示：</p><p><img src="'+q+'" alt="Alt text"></p><p>3.2、 然后在LKN.Order.HttpApi.Host中找到launchSettings.json文件</p><p><img src="'+C+`" alt="Alt text"></p><p>3.3、 然后在launchSettings.json文件中引入环境变量SkyAPM.Agent.AspNetCore 主要是在环境变量中添加： “ASPNETCORE_HOSTINGSTARTUPASSEMBLIES”: “SkyAPM.Agent.AspNetCore”</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;iisSettings&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;windowsAuthentication&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;anonymousAuthentication&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;iisExpress&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;applicationUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://localhost:44392&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;sslPort&quot;</span><span class="token operator">:</span> <span class="token number">44392</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;profiles&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;IIS Express&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;commandName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;IISExpress&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;launchBrowser&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;environmentVariables&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;ASPNETCORE_ENVIRONMENT&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Development&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;LKN.Order.DemoApp&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;commandName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Project&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;launchBrowser&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token property">&quot;applicationUrl&quot;</span><span class="token operator">:</span> <span class="token string">&quot;https://localhost:44397&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;environmentVariables&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;ASPNETCORE_ENVIRONMENT&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Development&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ASPNETCORE_HOSTINGSTARTUPASSEMBLIES&quot;</span><span class="token operator">:</span><span class="token string">&quot;SkyAPM.Agent.AspNetCore&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>3.4、 然后在LKN.Order.HttpApi.Host中创建skyapm.json文件</p><p><img src="`+W+`" alt="Alt text"></p><p>3.5、 然后在skyapm.json文件中添加</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;SkyWalking&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;ServiceName&quot;</span><span class="token operator">:</span> <span class="token string">&quot;OrderServices&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Namespace&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;HeaderVersions&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;sw8&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Sampling&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;SamplePer3Secs&quot;</span><span class="token operator">:</span> <span class="token number">-1</span><span class="token punctuation">,</span>
      <span class="token property">&quot;Percentage&quot;</span><span class="token operator">:</span> <span class="token number">-1.0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Logging&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;Level&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Information&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;FilePath&quot;</span><span class="token operator">:</span> <span class="token string">&quot;logs\\\\skyapm-{Date}.log&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;Transport&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;Interval&quot;</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
      <span class="token property">&quot;ProtocolVersion&quot;</span><span class="token operator">:</span> <span class="token string">&quot;v8&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;QueueSize&quot;</span><span class="token operator">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
      <span class="token property">&quot;BatchSize&quot;</span><span class="token operator">:</span> <span class="token number">3000</span><span class="token punctuation">,</span>
      <span class="token property">&quot;gRPC&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;Servers&quot;</span><span class="token operator">:</span> <span class="token string">&quot;localhost:11800&quot;</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Timeout&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ConnectTimeout&quot;</span><span class="token operator">:</span> <span class="token number">10000</span><span class="token punctuation">,</span>
        <span class="token property">&quot;ReportTimeout&quot;</span><span class="token operator">:</span> <span class="token number">600000</span><span class="token punctuation">,</span>
        <span class="token property">&quot;Authentication&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>​ ##### 核心配置：</p><p>​ 1、“ServiceName”: “OrderServices”,配置服务名称，用来标识唯一性</p><p>​ 2、“Servers”: “localhost:11800”,配置collector收集地址</p><p>3.6、 然后启动LKN.Order.HttpApi.Host</p><p>3.7、 然后通过浏览器访问LKN.Order.HttpApi.Host</p><p>输入地址：https://localhost:44397/swagger/index.html</p><p>结果如图所示： <img src="`+P+'" alt="Alt text"></p><p>3.8、 然后查看skywalking UI界面查看仪表盘</p><p><img src="'+f+'" alt="Alt text"></p><p>参数解析</p><p>​ 1、OrderServices：代表订单微服务名称</p><p>​ 2、仪表盘：为统计订单微服务微服务数据</p><p>3.9、 然后查看skywalking UI界面查看追踪 <img src="'+N+'" alt="Alt text"></p><p>参数解析</p><p>​ 1、追踪：订单微服务查询订单链路，链路上各路径执行时间</p>',101);function U(G,M){const e=p("router-link"),c=p("RouterLink");return l(),i("div",null,[L,n("nav",I,[n("ul",null,[n("li",null,[a(e,{to:"#目录"},{default:t(()=>[s("目录")]),_:1})]),n("li",null,[a(e,{to:"#微服务链路监控-skywalking"},{default:t(()=>[s("微服务链路监控-skywalking")]),_:1}),n("ul",null,[n("li",null,[a(e,{to:"#什么是链路"},{default:t(()=>[s("什么是链路")]),_:1})])])]),n("li",null,[a(e,{to:"#电商微服务中为什么要使用链路监控"},{default:t(()=>[s("电商微服务中为什么要使用链路监控")]),_:1})]),n("li",null,[a(e,{to:"#电商微服务"},{default:t(()=>[s("电商微服务")]),_:1}),n("ul",null,[n("li",null,[a(e,{to:"#电商微服务-链路监控"},{default:t(()=>[s("电商微服务-链路监控")]),_:1})]),n("li",null,[a(e,{to:"#电商微服务系统中落地链路监控"},{default:t(()=>[s("电商微服务系统中落地链路监控")]),_:1})])])]),n("li",null,[a(e,{to:"#电商微服务系统中落地skywalking"},{default:t(()=>[s("电商微服务系统中落地SkyWalking")]),_:1}),n("ul",null,[n("li",null,[a(e,{to:"#电商微服务系统准备"},{default:t(()=>[s("电商微服务系统准备")]),_:1})]),n("li",null,[a(e,{to:"#apache-skywalking-apm-bin-es7准备"},{default:t(()=>[s("apache-skywalking-apm-bin-es7准备")]),_:1})])])]),n("li",null,[a(e,{to:"#电商微服务系统skywalking集成架构"},{default:t(()=>[s("电商微服务系统SkyWalking集成架构")]),_:1}),n("ul",null,[n("li",null,[a(e,{to:"#链路监控基本角色"},{default:t(()=>[s("链路监控基本角色：")]),_:1})]),n("li",null,[a(e,{to:"#skywalking-角色作用"},{default:t(()=>[s("skywalking 角色作用")]),_:1})]),n("li",null,[a(e,{to:"#订单查询业务场景落地"},{default:t(()=>[s("订单查询业务场景落地")]),_:1})]),n("li",null,[a(e,{to:"#订单查询业务场景落地-1"},{default:t(()=>[s("订单查询业务场景落地")]),_:1})])])])])]),x,n("p",null,[s("3、Elasticsearch安装 "),a(c,{to:"/technology/back_end/elasticsearch/elasticsearch001.html"},{default:t(()=>[s("参考分布式中间件-ElasticSearch 安装")]),_:1})]),D])}const H=u($,[["render",U],["__file","abpmicroservices0007.html.vue"]]);export{H as default};
