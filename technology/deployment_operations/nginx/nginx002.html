<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.63">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/images/logo_v.png"><meta name="keywords" content="kenyonli"><title>网关中间件Nginx | Kenyon Li 随笔 </title><meta name="description" content="欢迎您，来到 Kenyon Li 世界！">
    <link rel="preload" href="/assets/style-d5da7002.css" as="style"><link rel="stylesheet" href="/assets/style-d5da7002.css">
    <link rel="modulepreload" href="/assets/app-c1c3c937.js"><link rel="modulepreload" href="/assets/nginx002.html-c594a14a.js"><link rel="modulepreload" href="/assets/nginx002.html-23a7ed3a.js"><link rel="modulepreload" href="/assets/nginx_008image-20af4478.js"><link rel="prefetch" href="/assets/index.html-0c5df828.js" as="script"><link rel="prefetch" href="/assets/index.html-122d66cc.js" as="script"><link rel="prefetch" href="/assets/index.html-1565d8e0.js" as="script"><link rel="prefetch" href="/assets/index.html-6eb9f9a2.js" as="script"><link rel="prefetch" href="/assets/lan_dao.html-f8b49934.js" as="script"><link rel="prefetch" href="/assets/mo_fei_din_lu.html-e84486e3.js" as="script"><link rel="prefetch" href="/assets/read01.html-3499d74d.js" as="script"><link rel="prefetch" href="/assets/yan_pi_juen.html-ebc74c11.js" as="script"><link rel="prefetch" href="/assets/object_oriented_analysis.html-c0b97768.js" as="script"><link rel="prefetch" href="/assets/design001.html-683e1b25.js" as="script"><link rel="prefetch" href="/assets/design002.html-d00aa6ad.js" as="script"><link rel="prefetch" href="/assets/design003.html-ac2e30f0.js" as="script"><link rel="prefetch" href="/assets/ea001.html-e8ab0da6.js" as="script"><link rel="prefetch" href="/assets/ai0001.html-fbb9c4b1.js" as="script"><link rel="prefetch" href="/assets/abp001.html-4d078b9b.js" as="script"><link rel="prefetch" href="/assets/abp002.html-361c1354.js" as="script"><link rel="prefetch" href="/assets/abp003.html-370e112b.js" as="script"><link rel="prefetch" href="/assets/abp004.html-2a550719.js" as="script"><link rel="prefetch" href="/assets/abp005.html-b7b8040d.js" as="script"><link rel="prefetch" href="/assets/abp006.html-afe3148a.js" as="script"><link rel="prefetch" href="/assets/abp007.html-c73814a2.js" as="script"><link rel="prefetch" href="/assets/abp008.html-3c920bb6.js" as="script"><link rel="prefetch" href="/assets/abp009.html-5aa18139.js" as="script"><link rel="prefetch" href="/assets/abp010.html-2f60cd08.js" as="script"><link rel="prefetch" href="/assets/abp011.html-144ed9f8.js" as="script"><link rel="prefetch" href="/assets/abp012.html-b0b755c1.js" as="script"><link rel="prefetch" href="/assets/abp013.html-07f9ef95.js" as="script"><link rel="prefetch" href="/assets/abp014.html-d9b342ae.js" as="script"><link rel="prefetch" href="/assets/abp015.html-2f03e87a.js" as="script"><link rel="prefetch" href="/assets/abp016.html-94352902.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0001.html-af71ea93.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0002.html-22ac1590.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0003.html-fe194269.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0004.html-c78a6bc2.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0005.html-658ff302.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0006.html-229b0517.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0007.html-943fd56b.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0008.html-c0fd71da.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0009.html-1a1fd836.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0010.html-8139592f.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0011.html-da7de1f7.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0012.html-cf03f10f.js" as="script"><link rel="prefetch" href="/assets/index.html-e99c2026.js" as="script"><link rel="prefetch" href="/assets/csharp01.html-08c0927b.js" as="script"><link rel="prefetch" href="/assets/dotnet01.html-9daf028e.js" as="script"><link rel="prefetch" href="/assets/dotnet02.html-6c7c2a0a.js" as="script"><link rel="prefetch" href="/assets/index.html-6379db3c.js" as="script"><link rel="prefetch" href="/assets/socket001.html-7e4e5d27.js" as="script"><link rel="prefetch" href="/assets/elasticsearch001.html-da1479cf.js" as="script"><link rel="prefetch" href="/assets/elasticsearch002.html-bb49ddf5.js" as="script"><link rel="prefetch" href="/assets/kafka01.html-d20844e4.js" as="script"><link rel="prefetch" href="/assets/minio001.html-98035ebe.js" as="script"><link rel="prefetch" href="/assets/rabbitmq01.html-6d96f442.js" as="script"><link rel="prefetch" href="/assets/rabbitmq02.html-d7e85cf9.js" as="script"><link rel="prefetch" href="/assets/schedule_master001.html-4e11cba4.js" as="script"><link rel="prefetch" href="/assets/sharding_sphere_proxy001.html-3469aa09.js" as="script"><link rel="prefetch" href="/assets/tuning001.html-61d6ef57.js" as="script"><link rel="prefetch" href="/assets/tuning002.html-6628017a.js" as="script"><link rel="prefetch" href="/assets/tuning003.html-a5dde2f7.js" as="script"><link rel="prefetch" href="/assets/tuning004.html-054bc685.js" as="script"><link rel="prefetch" href="/assets/tuning005.html-f5259f7c.js" as="script"><link rel="prefetch" href="/assets/index.html-89e48f33.js" as="script"><link rel="prefetch" href="/assets/index.html-33fe1ab6.js" as="script"><link rel="prefetch" href="/assets/mongodb001.html-fc05ec9d.js" as="script"><link rel="prefetch" href="/assets/redis001.html-235bdc89.js" as="script"><link rel="prefetch" href="/assets/01mysql_info.html-a6b66b2f.js" as="script"><link rel="prefetch" href="/assets/02mysql_info.html-068822cb.js" as="script"><link rel="prefetch" href="/assets/03mysql_innoDB.html-506d1653.js" as="script"><link rel="prefetch" href="/assets/04mysql_info.html-790a1718.js" as="script"><link rel="prefetch" href="/assets/05InnoDB_lock.html-223ae1b5.js" as="script"><link rel="prefetch" href="/assets/06mysql_info.html-4b2d3f6a.js" as="script"><link rel="prefetch" href="/assets/07mysql_info.html-50ae10d4.js" as="script"><link rel="prefetch" href="/assets/08mysql_info.html-7601e865.js" as="script"><link rel="prefetch" href="/assets/09mysql_centos.html-43a9f4a0.js" as="script"><link rel="prefetch" href="/assets/10mysql_write_read.html-84b83419.js" as="script"><link rel="prefetch" href="/assets/index.html-106989a1.js" as="script"><link rel="prefetch" href="/assets/cdn001.html-1eda9371.js" as="script"><link rel="prefetch" href="/assets/dns001.html-d38b2d4f.js" as="script"><link rel="prefetch" href="/assets/docker01.html-c099819b.js" as="script"><link rel="prefetch" href="/assets/docker02.html-2fa931a0.js" as="script"><link rel="prefetch" href="/assets/docker03.html-feb12d1f.js" as="script"><link rel="prefetch" href="/assets/docker04.html-8213c817.js" as="script"><link rel="prefetch" href="/assets/frp001.html-86b24d68.js" as="script"><link rel="prefetch" href="/assets/jenkins001.html-d0fcb613.js" as="script"><link rel="prefetch" href="/assets/centos9_001.html-e73b097e.js" as="script"><link rel="prefetch" href="/assets/index.html-7a43a8bb.js" as="script"><link rel="prefetch" href="/assets/linux001.html-a464543d.js" as="script"><link rel="prefetch" href="/assets/linux002.html-58cf1ca5.js" as="script"><link rel="prefetch" href="/assets/linux003.html-51f3f2b1.js" as="script"><link rel="prefetch" href="/assets/linux004.html-23a1a9e7.js" as="script"><link rel="prefetch" href="/assets/vpn01.html-d411bec4.js" as="script"><link rel="prefetch" href="/assets/vpn02.html-9041f95f.js" as="script"><link rel="prefetch" href="/assets/vpn03.html-10bdbaeb.js" as="script"><link rel="prefetch" href="/assets/vpn04.html-c838e0a5.js" as="script"><link rel="prefetch" href="/assets/nginx001.html-e8ab8a03.js" as="script"><link rel="prefetch" href="/assets/index.html-f213c134.js" as="script"><link rel="prefetch" href="/assets/index.html-d290a688.js" as="script"><link rel="prefetch" href="/assets/index.html-32bd2362.js" as="script"><link rel="prefetch" href="/assets/index.html-aae62809.js" as="script"><link rel="prefetch" href="/assets/axure_rp_10_001.html-337bca08.js" as="script"><link rel="prefetch" href="/assets/management_0001.html-8076a85d.js" as="script"><link rel="prefetch" href="/assets/404.html-60b35caa.js" as="script"><link rel="prefetch" href="/assets/index.html-1db2663f.js" as="script"><link rel="prefetch" href="/assets/index.html-e7f831f3.js" as="script"><link rel="prefetch" href="/assets/index.html-8b52f0d9.js" as="script"><link rel="prefetch" href="/assets/index.html-4648e07d.js" as="script"><link rel="prefetch" href="/assets/lan_dao.html-8a98ac78.js" as="script"><link rel="prefetch" href="/assets/mo_fei_din_lu.html-f5dc1ae7.js" as="script"><link rel="prefetch" href="/assets/read01.html-1687e123.js" as="script"><link rel="prefetch" href="/assets/yan_pi_juen.html-64856c47.js" as="script"><link rel="prefetch" href="/assets/object_oriented_analysis.html-1470ec02.js" as="script"><link rel="prefetch" href="/assets/design001.html-2dca36d3.js" as="script"><link rel="prefetch" href="/assets/design002.html-d7f05fa3.js" as="script"><link rel="prefetch" href="/assets/design003.html-d38fa6cb.js" as="script"><link rel="prefetch" href="/assets/ea001.html-a0d6ab52.js" as="script"><link rel="prefetch" href="/assets/ai0001.html-570f8bf2.js" as="script"><link rel="prefetch" href="/assets/abp001.html-e8e8c350.js" as="script"><link rel="prefetch" href="/assets/abp002.html-8b64116a.js" as="script"><link rel="prefetch" href="/assets/abp003.html-97dcc164.js" as="script"><link rel="prefetch" href="/assets/abp004.html-61336e39.js" as="script"><link rel="prefetch" href="/assets/abp005.html-c353f637.js" as="script"><link rel="prefetch" href="/assets/abp006.html-1440855d.js" as="script"><link rel="prefetch" href="/assets/abp007.html-ab8fed2b.js" as="script"><link rel="prefetch" href="/assets/abp008.html-6d348981.js" as="script"><link rel="prefetch" href="/assets/abp009.html-49dfe559.js" as="script"><link rel="prefetch" href="/assets/abp010.html-9c827b9c.js" as="script"><link rel="prefetch" href="/assets/abp011.html-3fb5d44f.js" as="script"><link rel="prefetch" href="/assets/abp012.html-97019b82.js" as="script"><link rel="prefetch" href="/assets/abp013.html-70d09ec2.js" as="script"><link rel="prefetch" href="/assets/abp014.html-df3b5c55.js" as="script"><link rel="prefetch" href="/assets/abp015.html-68bba06f.js" as="script"><link rel="prefetch" href="/assets/abp016.html-301af947.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0001.html-fb866520.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0002.html-aac60f40.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0003.html-72bb2608.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0004.html-0aa290ee.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0005.html-84e05aa9.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0006.html-4fda8e55.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0007.html-69b1b7dd.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0008.html-cf956168.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0009.html-9ac9702e.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0010.html-87af3317.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0011.html-3da615b7.js" as="script"><link rel="prefetch" href="/assets/abpmicroservices0012.html-e913010d.js" as="script"><link rel="prefetch" href="/assets/index.html-318c85d6.js" as="script"><link rel="prefetch" href="/assets/csharp01.html-2c14b5d2.js" as="script"><link rel="prefetch" href="/assets/dotnet01.html-01750e0b.js" as="script"><link rel="prefetch" href="/assets/dotnet02.html-8c224ecf.js" as="script"><link rel="prefetch" href="/assets/index.html-1916077d.js" as="script"><link rel="prefetch" href="/assets/socket001.html-ba30a642.js" as="script"><link rel="prefetch" href="/assets/elasticsearch001.html-7430deaa.js" as="script"><link rel="prefetch" href="/assets/elasticsearch002.html-c4327d81.js" as="script"><link rel="prefetch" href="/assets/kafka01.html-d0597fdb.js" as="script"><link rel="prefetch" href="/assets/minio001.html-e4e18988.js" as="script"><link rel="prefetch" href="/assets/rabbitmq01.html-94778e50.js" as="script"><link rel="prefetch" href="/assets/rabbitmq02.html-5d7ed981.js" as="script"><link rel="prefetch" href="/assets/schedule_master001.html-db33de28.js" as="script"><link rel="prefetch" href="/assets/sharding_sphere_proxy001.html-e178b1f2.js" as="script"><link rel="prefetch" href="/assets/tuning001.html-81ee10f0.js" as="script"><link rel="prefetch" href="/assets/tuning002.html-3915c089.js" as="script"><link rel="prefetch" href="/assets/tuning003.html-d28fbc5d.js" as="script"><link rel="prefetch" href="/assets/tuning004.html-45498f86.js" as="script"><link rel="prefetch" href="/assets/tuning005.html-53075a0a.js" as="script"><link rel="prefetch" href="/assets/index.html-83472dc7.js" as="script"><link rel="prefetch" href="/assets/index.html-2e07e830.js" as="script"><link rel="prefetch" href="/assets/mongodb001.html-ac44abd4.js" as="script"><link rel="prefetch" href="/assets/redis001.html-81baf7e4.js" as="script"><link rel="prefetch" href="/assets/01mysql_info.html-d7f1867f.js" as="script"><link rel="prefetch" href="/assets/02mysql_info.html-8fc8d63a.js" as="script"><link rel="prefetch" href="/assets/03mysql_innoDB.html-9c9af126.js" as="script"><link rel="prefetch" href="/assets/04mysql_info.html-4b3160ce.js" as="script"><link rel="prefetch" href="/assets/05InnoDB_lock.html-205ddc38.js" as="script"><link rel="prefetch" href="/assets/06mysql_info.html-76bb44c4.js" as="script"><link rel="prefetch" href="/assets/07mysql_info.html-e1071d89.js" as="script"><link rel="prefetch" href="/assets/08mysql_info.html-c24d3548.js" as="script"><link rel="prefetch" href="/assets/09mysql_centos.html-4826990b.js" as="script"><link rel="prefetch" href="/assets/10mysql_write_read.html-f8502a25.js" as="script"><link rel="prefetch" href="/assets/index.html-341ba3fa.js" as="script"><link rel="prefetch" href="/assets/cdn001.html-1e454cb6.js" as="script"><link rel="prefetch" href="/assets/dns001.html-2add38d8.js" as="script"><link rel="prefetch" href="/assets/docker01.html-748273dd.js" as="script"><link rel="prefetch" href="/assets/docker02.html-d1864030.js" as="script"><link rel="prefetch" href="/assets/docker03.html-b13fc535.js" as="script"><link rel="prefetch" href="/assets/docker04.html-4a38e8b5.js" as="script"><link rel="prefetch" href="/assets/frp001.html-92c57efc.js" as="script"><link rel="prefetch" href="/assets/jenkins001.html-c62bbaa1.js" as="script"><link rel="prefetch" href="/assets/centos9_001.html-186fb4f5.js" as="script"><link rel="prefetch" href="/assets/index.html-aed31d7b.js" as="script"><link rel="prefetch" href="/assets/linux001.html-99ea1dd0.js" as="script"><link rel="prefetch" href="/assets/linux002.html-2fbd42df.js" as="script"><link rel="prefetch" href="/assets/linux003.html-3c59ddc1.js" as="script"><link rel="prefetch" href="/assets/linux004.html-b7f6db9b.js" as="script"><link rel="prefetch" href="/assets/vpn01.html-42016abb.js" as="script"><link rel="prefetch" href="/assets/vpn02.html-2ae1a7b1.js" as="script"><link rel="prefetch" href="/assets/vpn03.html-66ddcbf5.js" as="script"><link rel="prefetch" href="/assets/vpn04.html-022cbbf6.js" as="script"><link rel="prefetch" href="/assets/nginx001.html-5dfd0aa1.js" as="script"><link rel="prefetch" href="/assets/index.html-b3e0fb83.js" as="script"><link rel="prefetch" href="/assets/index.html-1142373e.js" as="script"><link rel="prefetch" href="/assets/index.html-06a86388.js" as="script"><link rel="prefetch" href="/assets/index.html-5ce4eeab.js" as="script"><link rel="prefetch" href="/assets/axure_rp_10_001.html-e60bbb12.js" as="script"><link rel="prefetch" href="/assets/management_0001.html-c805580e.js" as="script"><link rel="prefetch" href="/assets/404.html-e3ed7bad.js" as="script"><link rel="prefetch" href="/assets/index-e32a7948.js" as="script"><link rel="prefetch" href="/assets/mermaid.core-f21db64e.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/images/home_logo_v.png" alt="Kenyon Li 随笔 "><span class="site-name can-hide">Kenyon Li 随笔 </span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="生活"><span class="title">生活</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="生活"><span class="title">生活</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/life/index.md" class="router-link-active" aria-label="生活之旅"><!--[--><!--]--> 生活之旅 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="技术"><span class="title">技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="技术"><span class="title">技术</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/front_end/vue/index.md" class="router-link-active" aria-label="前端设计与技术"><!--[--><!--]--> 前端设计与技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/back_end/csharp/csharp01.md" class="router-link-active" aria-label="后端设计与技术"><!--[--><!--]--> 后端设计与技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/database_design_analysis/mysql/01mysql_info.md" class="router-link-active" aria-label="数据库设计与技术"><!--[--><!--]--> 数据库设计与技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/architecture_design_analysis/enterprise_architect/ea001.md" class="router-link-active" aria-label="架构设计与分析"><!--[--><!--]--> 架构设计与分析 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/deployment_operations/docker/docker01.md" class="router-link-active" aria-label="部署与运维技术"><!--[--><!--]--> 部署与运维技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/product_design_analysis/axure_rp_10_001.md" class="router-link-active" aria-label="产品设计与分析"><!--[--><!--]--> 产品设计与分析 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/code_management/git/index.md" class="router-link-active" aria-label="代码管理"><!--[--><!--]--> 代码管理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/artificial_intelligence/ai/ai0001.md" class="router-link-active" aria-label="人工智能"><!--[--><!--]--> 人工智能 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/project_management/project_management_0001.md" class="router-link-active" aria-label="项目管理"><!--[--><!--]--> 项目管理 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="阅读"><span class="title">阅读</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="阅读"><span class="title">阅读</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/read/social_interaction/yan_pi_juen.md" class="router-link-active" aria-label="羊皮卷"><!--[--><!--]--> 羊皮卷 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/read/social_interaction/lan_dao.md" class="router-link-active" aria-label="狼道"><!--[--><!--]--> 狼道 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/read/social_interaction/mo_fei_din_lu.md" class="router-link-active" aria-label="墨菲定律"><!--[--><!--]--> 墨菲定律 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/read/social_interaction/read01.md" class="router-link-active" aria-label="什么反刍思维"><!--[--><!--]--> 什么反刍思维 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/read/technology/object_oriented_analysis.md" class="router-link-active" aria-label="面向对象分析与设计"><!--[--><!--]--> 面向对象分析与设计 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="收藏"><span class="title">收藏</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="收藏"><span class="title">收藏</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/collect/index.md" class="router-link-active" aria-label="浏览器书签"><!--[--><!--]--> 浏览器书签 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="生活"><span class="title">生活</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="生活"><span class="title">生活</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/life/index.md" class="router-link-active" aria-label="生活之旅"><!--[--><!--]--> 生活之旅 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="技术"><span class="title">技术</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="技术"><span class="title">技术</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/technology/front_end/vue/index.md" class="router-link-active" aria-label="前端设计与技术"><!--[--><!--]--> 前端设计与技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/back_end/csharp/csharp01.md" class="router-link-active" aria-label="后端设计与技术"><!--[--><!--]--> 后端设计与技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/database_design_analysis/mysql/01mysql_info.md" class="router-link-active" aria-label="数据库设计与技术"><!--[--><!--]--> 数据库设计与技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/architecture_design_analysis/enterprise_architect/ea001.md" class="router-link-active" aria-label="架构设计与分析"><!--[--><!--]--> 架构设计与分析 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/deployment_operations/docker/docker01.md" class="router-link-active" aria-label="部署与运维技术"><!--[--><!--]--> 部署与运维技术 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/product_design_analysis/axure_rp_10_001.md" class="router-link-active" aria-label="产品设计与分析"><!--[--><!--]--> 产品设计与分析 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/code_management/git/index.md" class="router-link-active" aria-label="代码管理"><!--[--><!--]--> 代码管理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/artificial_intelligence/ai/ai0001.md" class="router-link-active" aria-label="人工智能"><!--[--><!--]--> 人工智能 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/technology/project_management/project_management_0001.md" class="router-link-active" aria-label="项目管理"><!--[--><!--]--> 项目管理 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="阅读"><span class="title">阅读</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="阅读"><span class="title">阅读</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/read/social_interaction/yan_pi_juen.md" class="router-link-active" aria-label="羊皮卷"><!--[--><!--]--> 羊皮卷 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/read/social_interaction/lan_dao.md" class="router-link-active" aria-label="狼道"><!--[--><!--]--> 狼道 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/read/social_interaction/mo_fei_din_lu.md" class="router-link-active" aria-label="墨菲定律"><!--[--><!--]--> 墨菲定律 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/read/social_interaction/read01.md" class="router-link-active" aria-label="什么反刍思维"><!--[--><!--]--> 什么反刍思维 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/read/technology/object_oriented_analysis.md" class="router-link-active" aria-label="面向对象分析与设计"><!--[--><!--]--> 面向对象分析与设计 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="收藏"><span class="title">收藏</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="收藏"><span class="title">收藏</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/collect/index.md" class="router-link-active" aria-label="浏览器书签"><!--[--><!--]--> 浏览器书签 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">前端设计与技术 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item collapsible">javasrcipt <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/front_end/javascript/index.md" class="sidebar-item" aria-label="js语法基础"><!--[--><!--]--> js语法基础 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">H5语法 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/front_end/h5/index.md" class="sidebar-item" aria-label="H5语法基础"><!--[--><!--]--> H5语法基础 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">CSS样式 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/front_end/css/index.md" class="sidebar-item" aria-label="CSS语法基础"><!--[--><!--]--> CSS语法基础 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">Vue语法 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/front_end/vue/index.md" class="sidebar-item" aria-label="vue语法基础"><!--[--><!--]--> vue语法基础 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">后端设计与技术 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item collapsible">C#语法特性 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/back_end/csharp/csharp01.md" class="sidebar-item" aria-label="C#语法特性"><!--[--><!--]--> C#语法特性 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">C/C++ <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/back_end/cppreference/index.md" class="sidebar-item" aria-label="c/c++"><!--[--><!--]--> c/c++ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">dotnet Core <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/back_end/dotnetcore/dotnet01.md" class="sidebar-item" aria-label="dotnet 安装 CLI/SDK"><!--[--><!--]--> dotnet 安装 CLI/SDK <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/dotnetcore/index.md" class="sidebar-item" aria-label="EFCore数据库迁移命令"><!--[--><!--]--> EFCore数据库迁移命令 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/dotnetcore/socket001.md" class="sidebar-item" aria-label="Socket网络编程"><!--[--><!--]--> Socket网络编程 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/dotnetcore/dotnet02.md" class="sidebar-item" aria-label="Net 后台代码模拟浏览器请求 Get、Post、Put的扩展方法"><!--[--><!--]--> Net 后台代码模拟浏览器请求 Get、Post、Put的扩展方法 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">ABP vNnext <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/back_end/abp/abp001.md" class="sidebar-item" aria-label="ABP CLI"><!--[--><!--]--> ABP CLI <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp002.md" class="sidebar-item" aria-label="ABP vNnext  核心根基模块化"><!--[--><!--]--> ABP vNnext  核心根基模块化 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp003.md" class="sidebar-item" aria-label="ABP核心项目-电商项目(一)-落地实战"><!--[--><!--]--> ABP核心项目-电商项目(一)-落地实战 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp004.md" class="sidebar-item" aria-label="ABP核心项目-电商项目落地实战(二)-领域层优化"><!--[--><!--]--> ABP核心项目-电商项目落地实战(二)-领域层优化 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp005.md" class="sidebar-item" aria-label="ABP核心项目-电商项目落地实战(三)-仓储、服务层优化"><!--[--><!--]--> ABP核心项目-电商项目落地实战(三)-仓储、服务层优化 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp006.md" class="sidebar-item" aria-label="ABP核心项目-电商项目落地实战(四)-应用、web层优化、原理"><!--[--><!--]--> ABP核心项目-电商项目落地实战(四)-应用、web层优化、原理 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp007.md" class="sidebar-item" aria-label="ABP核心项目-电商项目(五)-动态c#API客户端模块"><!--[--><!--]--> ABP核心项目-电商项目(五)-动态c#API客户端模块 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp008.md" class="sidebar-item" aria-label="ABP核心项目-电商项目(六)-用户组件-用户身份模块"><!--[--><!--]--> ABP核心项目-电商项目(六)-用户组件-用户身份模块 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp009.md" class="sidebar-item" aria-label="ABP核心项目-电商项目(七)-用户组件-账户模块"><!--[--><!--]--> ABP核心项目-电商项目(七)-用户组件-账户模块 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp010.md" class="sidebar-item" aria-label="ABP核心项目-电商项目(八)-用户组件-权限模块"><!--[--><!--]--> ABP核心项目-电商项目(八)-用户组件-权限模块 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp011.md" class="sidebar-item" aria-label="ABP核心项目-电商项目(九)-用户组件-多租户模块"><!--[--><!--]--> ABP核心项目-电商项目(九)-用户组件-多租户模块 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp012.md" class="sidebar-item" aria-label="ABP核心项目-电商项目(十)-疑问记录"><!--[--><!--]--> ABP核心项目-电商项目(十)-疑问记录 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp013.md" class="sidebar-item" aria-label="ABP核心项目-电商项目(十一)-设置模块"><!--[--><!--]--> ABP核心项目-电商项目(十一)-设置模块 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp014.md" class="sidebar-item" aria-label="ABP核心项目-电商项目(十二)-特征模块"><!--[--><!--]--> ABP核心项目-电商项目(十二)-特征模块 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp015.md" class="sidebar-item" aria-label="ABP核心项目-电商项目(十三)-异常/认证/本地化模块"><!--[--><!--]--> ABP核心项目-电商项目(十三)-异常/认证/本地化模块 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abp/abp016.md" class="sidebar-item" aria-label="ABP核心项目-电商项目(十四)-虚拟文件系统"><!--[--><!--]--> ABP核心项目-电商项目(十四)-虚拟文件系统 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">Apb微服务项目 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/back_end/abpmicroservices/abpmicroservices0001.md" class="sidebar-item" aria-label="微服务电商项目落地"><!--[--><!--]--> 微服务电商项目落地 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abpmicroservices/abpmicroservices0002.md" class="sidebar-item" aria-label="微服务通信"><!--[--><!--]--> 微服务通信 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abpmicroservices/abpmicroservices0003.md" class="sidebar-item" aria-label="微服务网关-Ocelot"><!--[--><!--]--> 微服务网关-Ocelot <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abpmicroservices/abpmicroservices0004.md" class="sidebar-item" aria-label="微服务注册中心-Consul"><!--[--><!--]--> 微服务注册中心-Consul <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abpmicroservices/abpmicroservices0005.md" class="sidebar-item" aria-label="微服务注配置中心-Nacos"><!--[--><!--]--> 微服务注配置中心-Nacos <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abpmicroservices/abpmicroservices0006.md" class="sidebar-item" aria-label="微服务事件总线-CAP"><!--[--><!--]--> 微服务事件总线-CAP <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abpmicroservices/abpmicroservices0007.md" class="sidebar-item" aria-label="微服务链路监控-skywalking"><!--[--><!--]--> 微服务链路监控-skywalking <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abpmicroservices/abpmicroservices0008.md" class="sidebar-item" aria-label="微服务日志中心"><!--[--><!--]--> 微服务日志中心 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abpmicroservices/abpmicroservices0009.md" class="sidebar-item" aria-label="微服务分布式事务"><!--[--><!--]--> 微服务分布式事务 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abpmicroservices/abpmicroservices0010.md" class="sidebar-item" aria-label="微服务分布式权限"><!--[--><!--]--> 微服务分布式权限 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abpmicroservices/abpmicroservices0011.md" class="sidebar-item" aria-label="微服务分布式文件系统、分布式缓存、分布式锁"><!--[--><!--]--> 微服务分布式文件系统、分布式缓存、分布式锁 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/abpmicroservices/abpmicroservices0012.md" class="sidebar-item" aria-label="微服务大数据库MongoDB、任务调度Hangfire"><!--[--><!--]--> 微服务大数据库MongoDB、任务调度Hangfire <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">分布式消息中间件-RabbitMQ <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/back_end/rabbitmq/rabbitmq01.md" class="sidebar-item" aria-label="RabbitMQ简介（一）"><!--[--><!--]--> RabbitMQ简介（一） <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/rabbitmq/rabbitmq02.md" class="sidebar-item" aria-label="RabbitMQ（二）"><!--[--><!--]--> RabbitMQ（二） <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">分布式消息中间件-Kafka <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/back_end/kafka/kafka01.md" class="sidebar-item" aria-label="Kafka介绍（一）"><!--[--><!--]--> Kafka介绍（一） <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">分布式中间件-ShardingSphere-Proxy <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/back_end/sharding_sphere_proxy/sharding_sphere_proxy001.md" class="sidebar-item" aria-label="分布式中间件-ShardingSphere-Proxy"><!--[--><!--]--> 分布式中间件-ShardingSphere-Proxy <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">分布式中间件-ElasticSearch <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/back_end/elasticsearch/elasticsearch001.md" class="sidebar-item" aria-label="ElasticSearch"><!--[--><!--]--> ElasticSearch <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/elasticsearch/elasticsearch002.md" class="sidebar-item" aria-label="ElasticSearch-分词器"><!--[--><!--]--> ElasticSearch-分词器 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">分布式中间件-Minio <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/back_end/minio/minio001.md" class="sidebar-item" aria-label="Minio"><!--[--><!--]--> Minio <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">分布式任务调度中间件-ScheduleMaster <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/back_end/schedule_master/schedule_master001.md" class="sidebar-item" aria-label="分布式任务调度中间件-ScheduleMaster"><!--[--><!--]--> 分布式任务调度中间件-ScheduleMaster <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">性能调优 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/back_end/tuning/tuning001.md" class="sidebar-item" aria-label="DNS调优"><!--[--><!--]--> DNS调优 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/tuning/tuning002.md" class="sidebar-item" aria-label="CDN调优"><!--[--><!--]--> CDN调优 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/tuning/tuning003.md" class="sidebar-item" aria-label="Nginx调优"><!--[--><!--]--> Nginx调优 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/tuning/tuning004.md" class="sidebar-item" aria-label="WebAPI调优"><!--[--><!--]--> WebAPI调优 <!--[--><!--]--></a><!----></li><li><a href="/technology/back_end/tuning/tuning005.md" class="sidebar-item" aria-label="EFCore调优"><!--[--><!--]--> EFCore调优 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">数据库设计与技术 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item collapsible">MySql数据库 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/database_design_analysis/mysql/index.md" class="sidebar-item" aria-label="Mysql8.0 Ubuntu 20.4 安装"><!--[--><!--]--> Mysql8.0 Ubuntu 20.4 安装 <!--[--><!--]--></a><!----></li><li><a href="/technology/database_design_analysis/mysql/09mysql_centos.md" class="sidebar-item" aria-label="Mysql8.0 CentOS Stream 9 安装"><!--[--><!--]--> Mysql8.0 CentOS Stream 9 安装 <!--[--><!--]--></a><!----></li><li><a href="/technology/database_design_analysis/mysql/10mysql_write_read.md" class="sidebar-item" aria-label="Mysql 8.0 主从部署-读写分离"><!--[--><!--]--> Mysql 8.0 主从部署-读写分离 <!--[--><!--]--></a><!----></li><li><a href="/technology/database_design_analysis/mysql/01mysql_info.md" class="sidebar-item" aria-label="Mysql 架构体系详解"><!--[--><!--]--> Mysql 架构体系详解 <!--[--><!--]--></a><!----></li><li><a href="/technology/database_design_analysis/mysql/02mysql_info.md" class="sidebar-item" aria-label="InnoDB架构详解、事务介绍"><!--[--><!--]--> InnoDB架构详解、事务介绍 <!--[--><!--]--></a><!----></li><li><a href="/technology/database_design_analysis/mysql/03mysql_innoDB.md" class="sidebar-item" aria-label="InnoDB事务"><!--[--><!--]--> InnoDB事务 <!--[--><!--]--></a><!----></li><li><a href="/technology/database_design_analysis/mysql/04mysql_info.md" class="sidebar-item" aria-label="InnoDB索引"><!--[--><!--]--> InnoDB索引 <!--[--><!--]--></a><!----></li><li><a href="/technology/database_design_analysis/mysql/05InnoDB_lock.md" class="sidebar-item" aria-label="Mysql InnoDB锁"><!--[--><!--]--> Mysql InnoDB锁 <!--[--><!--]--></a><!----></li><li><a href="/technology/database_design_analysis/mysql/06mysql_info.md" class="sidebar-item" aria-label="Mysql 性能优化"><!--[--><!--]--> Mysql 性能优化 <!--[--><!--]--></a><!----></li><li><a href="/technology/database_design_analysis/mysql/07mysql_info.md" class="sidebar-item" aria-label="MySQL分库分表"><!--[--><!--]--> MySQL分库分表 <!--[--><!--]--></a><!----></li><li><a href="/technology/database_design_analysis/mysql/08mysql_info.md" class="sidebar-item" aria-label="MySQL集群篇"><!--[--><!--]--> MySQL集群篇 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">MongoDB数据库 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/database_design_analysis/mongodb/mongodb001.md" class="sidebar-item" aria-label="分布式中间件-MongoDB"><!--[--><!--]--> 分布式中间件-MongoDB <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">Redis数据库 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/database_design_analysis/redis/redis001.md" class="sidebar-item" aria-label="分布式中间件-Redis"><!--[--><!--]--> 分布式中间件-Redis <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">架构设计与分析 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item collapsible">设计模式 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/architecture_design_analysis/design/design001.md" class="sidebar-item" aria-label="工厂、抽象工厂、策略模式"><!--[--><!--]--> 工厂、抽象工厂、策略模式 <!--[--><!--]--></a><!----></li><li><a href="/technology/architecture_design_analysis/design/design002.md" class="sidebar-item" aria-label="设计模式-应用场景和优缺点"><!--[--><!--]--> 设计模式-应用场景和优缺点 <!--[--><!--]--></a><!----></li><li><a href="/technology/architecture_design_analysis/design/design003.md" class="sidebar-item" aria-label="存储高可用"><!--[--><!--]--> 存储高可用 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">EA工具 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/architecture_design_analysis/enterprise_architect/ea001.md" class="sidebar-item" aria-label="UML、类图、顺序图 "><!--[--><!--]--> UML、类图、顺序图  <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">部署与运维技术 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item collapsible">linux系统 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/deployment_operations/linux/index.md" class="sidebar-item" aria-label="linux基础"><!--[--><!--]--> linux基础 <!--[--><!--]--></a><!----></li><li><a href="/technology/deployment_operations/linux/centos9_001.md" class="sidebar-item" aria-label="linux（centos9）root密码忘记了，怎么重置或修改密码"><!--[--><!--]--> linux（centos9）root密码忘记了，怎么重置或修改密码 <!--[--><!--]--></a><!----></li><li><a href="/technology/deployment_operations/linux/vpn01.md" class="sidebar-item" aria-label="Ubuntu20.4 搭建vpn服务器"><!--[--><!--]--> Ubuntu20.4 搭建vpn服务器 <!--[--><!--]--></a><!----></li><li><a href="/technology/deployment_operations/linux/vpn02.md" class="sidebar-item" aria-label="Linux实现socks终端代理、全局代理"><!--[--><!--]--> Linux实现socks终端代理、全局代理 <!--[--><!--]--></a><!----></li><li><a href="/technology/deployment_operations/linux/vpn03.md" class="sidebar-item" aria-label="搭建 vpn 使用 x-ui 部署配置"><!--[--><!--]--> 搭建 vpn 使用 x-ui 部署配置 <!--[--><!--]--></a><!----></li><li><a href="/technology/deployment_operations/linux/linux001.md" class="sidebar-item" aria-label="yum及yum-config-manager命令详解"><!--[--><!--]--> yum及yum-config-manager命令详解 <!--[--><!--]--></a><!----></li><li><a href="/technology/deployment_operations/linux/linux002.md" class="sidebar-item" aria-label="dnf命令详解"><!--[--><!--]--> dnf命令详解 <!--[--><!--]--></a><!----></li><li><a href="/technology/deployment_operations/linux/linux003.md" class="sidebar-item" aria-label="linux 运行 AppImage 应用"><!--[--><!--]--> linux 运行 AppImage 应用 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">Nginx工具 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/deployment_operations/nginx/nginx001.md" class="sidebar-item" aria-label="分布式中间件-Nginx"><!--[--><!--]--> 分布式中间件-Nginx <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">Docker容器 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/deployment_operations/docker/docker01.md" class="sidebar-item" aria-label="微服务部署Docker"><!--[--><!--]--> 微服务部署Docker <!--[--><!--]--></a><!----></li><li><a href="/technology/deployment_operations/docker/docker02.md" class="sidebar-item" aria-label="Docker集群"><!--[--><!--]--> Docker集群 <!--[--><!--]--></a><!----></li><li><a href="/technology/deployment_operations/docker/docker03.md" class="sidebar-item" aria-label="微服务部署-k8s(一)"><!--[--><!--]--> 微服务部署-k8s(一) <!--[--><!--]--></a><!----></li><li><a href="/technology/deployment_operations/docker/docker04.md" class="sidebar-item" aria-label="微服务部署-k8s(二)-应用"><!--[--><!--]--> 微服务部署-k8s(二)-应用 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">jenkins工具 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/deployment_operations/jenkins/jenkins001.md" class="sidebar-item" aria-label="Jenkins 安装部署"><!--[--><!--]--> Jenkins 安装部署 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">frp 网络穿透工具 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/deployment_operations/frp/frp001.md" class="sidebar-item" aria-label="Frp网络穿透工具"><!--[--><!--]--> Frp网络穿透工具 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">产品设计与分析 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item collapsible">Axure原型工具 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/product_design_analysis/axure/axure_rp_10_001.md" class="sidebar-item" aria-label="axure原型设计工具"><!--[--><!--]--> axure原型设计工具 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">代码管理 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item collapsible">git工具 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/code_management/git/index.md" class="sidebar-item" aria-label="git 常用命令"><!--[--><!--]--> git 常用命令 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item collapsible">Markdown语法 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/code_management/markdown/index.md" class="sidebar-item" aria-label="Markdown使用手册"><!--[--><!--]--> Markdown使用手册 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">人工智能 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item collapsible">人工智能 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/artificial_intelligence/ai/ai0001.md" class="sidebar-item" aria-label="什么是人工智能"><!--[--><!--]--> 什么是人工智能 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">项目管理 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><p tabindex="0" class="sidebar-item collapsible">工作职责 <span class="right arrow"></span></p><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/technology/project_management/project/management_0001.md" class="sidebar-item" aria-label="项目管理工作职责"><!--[--><!--]--> 项目管理工作职责 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h2 id="目录" tabindex="-1"><a class="header-anchor" href="#目录" aria-hidden="true">#</a> 目录</h2><nav class="table-of-contents"><ul><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#目录" class="router-link-active router-link-exact-active">目录</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#分布式中间件-nginx" class="router-link-active router-link-exact-active">分布式中间件-Nginx</a><ul><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#什么是nginx" class="router-link-active router-link-exact-active">什么是Nginx</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#什么地方使用nginx" class="router-link-active router-link-exact-active">什么地方使用Nginx</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#集群系统中为什么要使用nginx" class="router-link-active router-link-exact-active">集群系统中为什么要使用Nginx</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#集群系统中如何落地nginx" class="router-link-active router-link-exact-active">集群系统中如何落地Nginx</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#查询商品分流场景落地" class="router-link-active router-link-exact-active">查询商品分流场景落地</a></li></ul></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#查询商品分流nginx原理" class="router-link-active router-link-exact-active">查询商品分流Nginx原理</a><ul><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#模块化设计" class="router-link-active router-link-exact-active">模块化设计</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#多进程模型" class="router-link-active router-link-exact-active">多进程模型</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#事件驱动架构" class="router-link-active router-link-exact-active">事件驱动架构</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#虚拟主机" class="router-link-active router-link-exact-active">虚拟主机</a></li></ul></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#查询商品分流场景落地-情况1" class="router-link-active router-link-exact-active">查询商品分流场景落地-情况1</a><ul><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#如何落地最小活跃数算法" class="router-link-active router-link-exact-active">如何落地最小活跃数算法</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#查询商品分流场景落地-情况2" class="router-link-active router-link-exact-active">查询商品分流场景落地-情况2</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#如何落地hash一致性算法" class="router-link-active router-link-exact-active">如何落地hash一致性算法？</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#查询商品分流场景落地-情况3" class="router-link-active router-link-exact-active">查询商品分流场景落地-情况3</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#查询商品分流场景落地-情况4" class="router-link-active router-link-exact-active">查询商品分流场景落地-情况4</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#查询商品分流场景落地-情况5" class="router-link-active router-link-exact-active">查询商品分流场景落地-情况5</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#查询商品分流场景落地-情况6" class="router-link-active router-link-exact-active">查询商品分流场景落地-情况6</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#限流-情况1" class="router-link-active router-link-exact-active">限流-情况1</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#限流-情况2" class="router-link-active router-link-exact-active">限流-情况2</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#限流-情况3" class="router-link-active router-link-exact-active">限流-情况3</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#限流-情况4" class="router-link-active router-link-exact-active">限流-情况4</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#限流-情况5" class="router-link-active router-link-exact-active">限流-情况5</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#查询商品缓存场景落地-情况7" class="router-link-active router-link-exact-active">查询商品缓存场景落地-情况7</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#参数详解" class="router-link-active router-link-exact-active">参数详解</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#查询商品https应用场景" class="router-link-active router-link-exact-active">查询商品Https应用场景</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#http转https" class="router-link-active router-link-exact-active">Http转Https</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#查询商品数据库应用场景" class="router-link-active router-link-exact-active">查询商品数据库应用场景</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#查询商品web应用场景" class="router-link-active router-link-exact-active">查询商品Web应用场景</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#动静分离-情况2" class="router-link-active router-link-exact-active">动静分离-情况2</a></li></ul></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#nginx集群场景" class="router-link-active router-link-exact-active">Nginx集群场景</a><ul><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#虚拟机准备" class="router-link-active router-link-exact-active">虚拟机准备：</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#_1-安装-nginx需要工具" class="router-link-active router-link-exact-active">1 安装 nginx需要工具</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#_2-下载nginx" class="router-link-active router-link-exact-active">2 下载nginx</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#_3-nginx解压-nginx目录" class="router-link-active router-link-exact-active">3 nginx解压/nginx目录</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#_4-切换到-nginx-nginx-1-24-0" class="router-link-active router-link-exact-active">4 切换到/nginx/nginx-1.24.0</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#_5-切换到-usr-local-nginx-sbin" class="router-link-active router-link-exact-active">5 切换到/usr/local/nginx/sbin</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#_6-禁用-nginx" class="router-link-active router-link-exact-active">6 禁用 nginx</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#_7-重启-nginx" class="router-link-active router-link-exact-active">7 重启 nginx</a></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#yum方式安装" class="router-link-active router-link-exact-active">yum方式安装</a></li></ul></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#nginx自动重启-手动" class="router-link-active router-link-exact-active">Nginx自动重启-手动</a><ul><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#nginx自动重启-启动" class="router-link-active router-link-exact-active">Nginx自动重启-启动</a></li></ul></li><li><a aria-current="page" href="/technology/deployment_operations/nginx/nginx002.html#socket-配置" class="router-link-active router-link-exact-active">socket 配置</a></li></ul></nav><h2 id="分布式中间件-nginx" tabindex="-1"><a class="header-anchor" href="#分布式中间件-nginx" aria-hidden="true">#</a> 分布式中间件-Nginx</h2><h3 id="什么是nginx" tabindex="-1"><a class="header-anchor" href="#什么是nginx" aria-hidden="true">#</a> 什么是Nginx</h3><blockquote><p>Nginx是高性能HTTP服务器，反向代理服务器，邮件代理服务器，TCP/UDP反向代理服务器<br><a href="/file/nginx/Nginx%E5%AE%8C%E6%95%B4%E8%AF%BE%E4%BB%B6.pdf">Nginx完整课件.pdf</a></p></blockquote><h3 id="什么地方使用nginx" tabindex="-1"><a class="header-anchor" href="#什么地方使用nginx" aria-hidden="true">#</a> 什么地方使用Nginx</h3><blockquote><p>Nginx主要用在集群系统中。</p></blockquote><h3 id="集群系统中为什么要使用nginx" tabindex="-1"><a class="header-anchor" href="#集群系统中为什么要使用nginx" aria-hidden="true">#</a> 集群系统中为什么要使用Nginx</h3><blockquote><p>单个系统，主要用来处理客户端的请求，一个系统处理客户端的请求量是有限的，当客户端的并发量，操过了系统处理的并发能力，就会导致系统处理速度变慢，也就是所谓的性能下降。所以，为了提升性能。 因此我们需要通过多个实例来分离。所以， 我们会创建多个系统实例，形成的系统就叫做集群系统。可以，集群系统，如何均衡处理客户端的请求？<br> 分流代表技术，就是Nginx。</p></blockquote><blockquote><p>在什么样的集群系统中使用Nginx呢？用的比较多的就是电商集群系统。那么，在电商集群系统中如何落地Nginx？</p></blockquote><blockquote><p>业务场景：创建商品业务场景</p></blockquote><h3 id="集群系统中如何落地nginx" tabindex="-1"><a class="header-anchor" href="#集群系统中如何落地nginx" aria-hidden="true">#</a> 集群系统中如何落地Nginx</h3><blockquote><p>前提：</p></blockquote><ul><li><p>1、电商系统</p></li><li><p>2、Nginx</p></li></ul><blockquote><p>步骤</p></blockquote><ul><li>1、电商集群系统准备</li></ul><blockquote><p>通过VS创建.Net7电商系统 <img src="/images/nginx/nginx_0001image.png" alt="Alt text"></p></blockquote><blockquote><p>2、Nginx准备</p></blockquote><blockquote><blockquote><p>2.1 Nginx前提准备 <a href="https://nginx.org/en/download.html" target="_blank" rel="noopener noreferrer">Nginx下载<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ​ Nginx下载地址：https://nginx.org/download/nginx-1.24.0.zip</p></blockquote></blockquote><h3 id="查询商品分流场景落地" tabindex="-1"><a class="header-anchor" href="#查询商品分流场景落地" aria-hidden="true">#</a> 查询商品分流场景落地</h3><p>条件</p><ul><li><p>1、电商集群系统LKN.EBusiness</p></li><li><p>2、Nginx启动</p></li><li><p>3、客户端访问</p></li></ul><blockquote><p>步骤</p></blockquote><blockquote><ul><li>1、先进入到电商集群系统LKN.EBusiness</li></ul></blockquote><blockquote><blockquote><p>1.1 先在电商网站微服务中创建ProductController类</p></blockquote></blockquote><blockquote><blockquote><p>​ 1.2、然后在ProductController类添加代码</p></blockquote></blockquote><div class="language-C# line-numbers-mode" data-ext="C#"><pre class="language-C#"><code>        /// &lt;summary&gt;
        /// 创建商品
        /// &lt;/summary&gt;
        /// &lt;param name=&quot;productCreateDto&quot;&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        [HttpPost]
        public Product CreateProduct(ProductCreateDto productCreateDto)
        {
            Console.WriteLine(&quot;查询商品&quot;);
            return new Product() ;
        }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><blockquote><p>1.3、然后启动电商系统实例一</p></blockquote></blockquote><blockquote><blockquote><p>​ 1.4、然后再启动电商系统实例二</p></blockquote></blockquote><blockquote><p>2、Nginx准备</p></blockquote><blockquote><blockquote><p>​ 2.1 先进入到Nginx中</p></blockquote></blockquote><p><img src="/images/nginx/nginx_0002image.png" alt="Alt text"></p><blockquote><blockquote><p>2.2 然后打开nginx.conf配置，在里面添加</p></blockquote></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    access_log  logs/access.log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        location / <span class="token punctuation">{</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#动态负载均衡配置</span>
    upstream LKN.EBusiness<span class="token punctuation">{</span>
        server localhost:5001<span class="token punctuation">;</span>
        server localhost:5002<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><blockquote><p>2.3、然后启动Nginx <img src="/images/nginx/nginx_0003image.png" alt="Alt text"></p></blockquote></blockquote><blockquote><p>3、客户端访问</p></blockquote><blockquote><blockquote><p>​ 3.1、进入到浏览器进行访问</p></blockquote></blockquote><h2 id="查询商品分流nginx原理" tabindex="-1"><a class="header-anchor" href="#查询商品分流nginx原理" aria-hidden="true">#</a> 查询商品分流Nginx原理</h2><h3 id="模块化设计" tabindex="-1"><a class="header-anchor" href="#模块化设计" aria-hidden="true">#</a> 模块化设计</h3><blockquote><p>高度模块化的设计是 Nginx 的架构基础。在 Nginx 中，除了少量的核心代码，其他一切皆为模块。<br> 所有模块间是分层次、分类别的，Nginx 官方共有五大类型的模块：核心模块、配置模块、事件模块、HTTP 模块、mail 模块、stream模块。它们之间的关系如下：</p></blockquote><p><img src="/images/nginx/nginx_0004image.png" alt="Alt text"></p><blockquote><p>在这 5 种模块中，配置模块和核心模块是与 Nginx 框架密切相关的。而事件模块则是 HTTP 模块和 mail 模块的基础。HTTP 模块和 mail 模块的“地位”类似，它们都是更关注于应用层面。</p></blockquote><h3 id="多进程模型" tabindex="-1"><a class="header-anchor" href="#多进程模型" aria-hidden="true">#</a> 多进程模型</h3><blockquote><p>Nginx之所以为广大码农喜爱，除了其高性能外，还有其优雅的系统架构。与Memcached的经典多线程模型相比，Nginx是经典的多进程模型。Nginx启动后以daemon的方式在后台运行，后台进程包含一个master进程和多个worker进程，具体如下图：</p></blockquote><p><img src="/images/nginx/nginx_0005image.png" alt="Alt text"></p><h3 id="事件驱动架构" tabindex="-1"><a class="header-anchor" href="#事件驱动架构" aria-hidden="true">#</a> 事件驱动架构</h3><p>Nginx 处理事件的简单模型： <img src="/images/nginx/nginx_0006image.png" alt="Alt text"></p><blockquote><p>由上图可以看出，处理请求事件时，Nginx 的事件消费者只是被事件分发者进程短期调用而已，这种设计使得网络性能、用户感知的请求时延都得到了提升，每个用户的请求所产生的事件会及时响应，整个服务器的网络吞吐量都会由于事件的及时响应而增大。当然，这也带来一定的要求，即每个事件消费者都不能有阻塞行为，否则将会由于长时间占用事件分发者进程而导致其他事件得不到及时响应，Nginx 的非阻塞特性就是由于它的模块都是满足这个要求的。</p></blockquote><h3 id="虚拟主机" tabindex="-1"><a class="header-anchor" href="#虚拟主机" aria-hidden="true">#</a> 虚拟主机</h3><p><code>ngx_http_core_module</code></p><blockquote><p>​ 作用：虚拟主机就是为了对所有应用系统进行反向代理</p></blockquote><blockquote><p>反向代理 <code>ngx_http_proxy_module</code></p></blockquote><blockquote><p>​ 作用：代理后端服务器。</p></blockquote><blockquote><p>负载均衡 <code>ngx_http_upstream_module</code></p></blockquote><blockquote><p>作用：将流量均分到指定后端实例</p></blockquote><h2 id="查询商品分流场景落地-情况1" tabindex="-1"><a class="header-anchor" href="#查询商品分流场景落地-情况1" aria-hidden="true">#</a> 查询商品分流场景落地-情况1</h2><blockquote><p>情况1：当客户端给Nginx发送查询商品的请求时，Nginx把请求转发给5001 和 5002 ,如果5002处理请求比较慢，会导致请求堆积在5002。如何解决请求堆积问题？<br> 方案：最小活跃数算法</p></blockquote><h3 id="如何落地最小活跃数算法" tabindex="-1"><a class="header-anchor" href="#如何落地最小活跃数算法" aria-hidden="true">#</a> 如何落地最小活跃数算法</h3><blockquote><p>条件</p></blockquote><blockquote><p>1、least_conn</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    access_log  logs/access.log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        location / <span class="token punctuation">{</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#动态负载均衡配置</span>
    upstream LKN.EBusiness<span class="token punctuation">{</span>
        least_conn<span class="token punctuation">;</span>
        server localhost:5001<span class="token punctuation">;</span>
        server localhost:5002<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询商品分流场景落地-情况2" tabindex="-1"><a class="header-anchor" href="#查询商品分流场景落地-情况2" aria-hidden="true">#</a> 查询商品分流场景落地-情况2</h3><blockquote><p>情况2：当客户端给Nginx发送查询商品的请求时，Nginx把请求转发给5001 和 5002 ,如果5001和5002分别都有缓存，会导致缓存命中下降，请求会回源到数据库中去查询数据，导致性能下降。如何提升性能?</p></blockquote><blockquote><p>方案：<code>Hash一致性算法</code></p></blockquote><h3 id="如何落地hash一致性算法" tabindex="-1"><a class="header-anchor" href="#如何落地hash一致性算法" aria-hidden="true">#</a> 如何落地hash一致性算法？</h3><blockquote><p>条件</p></blockquote><blockquote><p>1、ip_hash</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    access_log  logs/access.log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        location / <span class="token punctuation">{</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#动态负载均衡配置</span>
    upstream LKN.EBusiness<span class="token punctuation">{</span>
        ip_hash<span class="token punctuation">;</span>
        server localhost:5001<span class="token punctuation">;</span>
        server localhost:5002<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询商品分流场景落地-情况3" tabindex="-1"><a class="header-anchor" href="#查询商品分流场景落地-情况3" aria-hidden="true">#</a> 查询商品分流场景落地-情况3</h3><blockquote><p>情况2：当客户端给Nginx发送查询商品的请求时，Nginx把请求转发给5001 和 5002 ,如果转发到5001的时候，5001零时宕机了，会导致请求失败。如何保证请求成功<br> 方案：失败重试</p></blockquote><blockquote><p>如何落地失败重试？<br> 条件<br> 1、max_fails=2 fail_timeout=10s;</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    access_log  logs/access.log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        location / <span class="token punctuation">{</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#动态负载均衡配置</span>
    upstream LKN.EBusiness<span class="token punctuation">{</span>
    
        server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询商品分流场景落地-情况4" tabindex="-1"><a class="header-anchor" href="#查询商品分流场景落地-情况4" aria-hidden="true">#</a> 查询商品分流场景落地-情况4</h3><blockquote><p>情况2：当客户端给Nginx发送查询商品的请求时，Nginx把请求转发给5001 和 5002 ,如果转发到5001的时候，5001永久宕机了，会导致请求失败。如何保证请求成功<br> 方案：<code>故障转移</code></p></blockquote><blockquote><p>如何落地故障转移？<br> 条件<br> 1、自动失败重试</p></blockquote><h3 id="查询商品分流场景落地-情况5" tabindex="-1"><a class="header-anchor" href="#查询商品分流场景落地-情况5" aria-hidden="true">#</a> 查询商品分流场景落地-情况5</h3><blockquote><p>情况2：当客户端给Nginx发送查询商品的请求时，Nginx把请求转发给5001 和 5002 ,如果转发到5001和5002，两个实例同时宕机了，会导致系统不可用，如何保证系统高度可用？<br> 方案：主机备份<br> 如何落地主机备份？<br> 条件</p><blockquote><p>1、backup</p></blockquote></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    access_log  logs/access.log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        location / <span class="token punctuation">{</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#动态负载均衡配置</span>
    upstream LKN.EBusiness<span class="token punctuation">{</span>
    
        server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5003 backup<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询商品分流场景落地-情况6" tabindex="-1"><a class="header-anchor" href="#查询商品分流场景落地-情况6" aria-hidden="true">#</a> 查询商品分流场景落地-情况6</h3><blockquote><p>情况2：当客户端给Nginx发送查询商品的请求时，Nginx把请求转发给5001 和 5002 ,如果转发到5001和5002，两个实例处理能力达到极限的时候，导致系统可能宕机的风险。所以，在有限资源的情况下。我们应如何保证系统不宕机？</p></blockquote><blockquote><p>方案：<code>限流</code></p></blockquote><blockquote><p>如何落地限流？<br> 条件</p></blockquote><blockquote><p>1、ngx_http_limit_conn_module</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    access_log  logs/access.log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    limit_conn_zone <span class="token variable">$server_name</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>perserver:10m<span class="token punctuation">;</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        location / <span class="token punctuation">{</span>
            limit_conn perserver <span class="token number">1</span><span class="token punctuation">;</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#动态负载均衡配置</span>
    upstream LKN.EBusiness<span class="token punctuation">{</span>
    
        server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5003 backup<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>和客户端无关</p></blockquote><blockquote><p>缺陷：导致正常客户端无法使用</p></blockquote><h3 id="限流-情况1" tabindex="-1"><a class="header-anchor" href="#限流-情况1" aria-hidden="true">#</a> 限流-情况1</h3><blockquote><p>缺陷：服务端被限制只能允许访问10个请求，那么就会限制请求数量进行访问，请求数可能来至于多个客户端，如果一个客户端都把请求数占用了。就会导致其他客户端无法进行请求，导致恶意攻击。</p></blockquote><blockquote><p>方案：客户端限流</p></blockquote><blockquote><p>如何落地客户端限流？<br> 条件 1、binary_remote_addr 步骤</p></blockquote><blockquote><p>1、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    access_log  logs/access.log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    limit_conn_zone <span class="token variable">$binary_remote_addr</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>perserver:10m<span class="token punctuation">;</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        location / <span class="token punctuation">{</span>
            limit_conn perserver <span class="token number">1</span><span class="token punctuation">;</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#动态负载均衡配置</span>
    upstream LKN.EBusiness<span class="token punctuation">{</span>
    
        server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5003 backup<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="限流-情况2" tabindex="-1"><a class="header-anchor" href="#限流-情况2" aria-hidden="true">#</a> 限流-情况2</h3><blockquote><p>注意：$binary_remote_addr 是 获取客户端ip地址的变量，长度为 4 字节，会话信息的长度为 32 字节。 1048576 /32 = 32768个会话</p></blockquote><blockquote><p>缺陷：</p></blockquote><blockquote><p>1、如果客户端非常多，每个IP都限制请求处理1次，如果出现了100万个客户端，那么就有非常多的客户端徐亚需要进行处理，那么就会导致系统被压垮。所以，这个时候，就需要使用平滑处理</p></blockquote><blockquote><p>方案：客户端IP平滑限流</p></blockquote><blockquote><p>如何落地客户端IP平滑限流？<br> 条件</p></blockquote><blockquote><p>1、ngx_http_limit_req_module</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    access_log  logs/access.log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    limit_req_zone <span class="token variable">$binary_remote_addr</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>addr:10m <span class="token assign-left variable">rate</span><span class="token operator">=</span>2r/s<span class="token punctuation">;</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        location / <span class="token punctuation">{</span>
            limit_req <span class="token assign-left variable">zone</span><span class="token operator">=</span>addr<span class="token punctuation">;</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#动态负载均衡配置</span>
    upstream LKN.EBusiness<span class="token punctuation">{</span>
    
        server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5003 backup<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="原理" tabindex="-1"><a class="header-anchor" href="#原理" aria-hidden="true">#</a> 原理：</h4><ul><li><p>1、令牌桶算法</p></li><li><p>2、漏桶算法</p></li></ul><h3 id="限流-情况3" tabindex="-1"><a class="header-anchor" href="#限流-情况3" aria-hidden="true">#</a> 限流-情况3</h3><blockquote><p>缺陷：</p></blockquote><blockquote><p>1、如果客户端请求非常多，1s处理2个是 每500ms 处理一个，就会导致并发性能下降。这个时候把不能处理的，排除掉，然后再来处理。所以需要加缓存来处理。缓冲几个，以提升性能。</p></blockquote><blockquote><p>方案：客户端IP平滑限流-突发</p></blockquote><blockquote><p>如何落地客户端IP平滑限流？<br> 条件</p></blockquote><blockquote><p>1、ngx_http_limit_req_module</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    access_log  logs/access.log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    limit_req_zone <span class="token variable">$binary_remote_addr</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>addr:10m <span class="token assign-left variable">rate</span><span class="token operator">=</span>2r/s<span class="token punctuation">;</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        location / <span class="token punctuation">{</span>
            limit_req <span class="token assign-left variable">zone</span><span class="token operator">=</span>addr <span class="token assign-left variable">burst</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#动态负载均衡配置</span>
    upstream LKN.EBusiness<span class="token punctuation">{</span>
    
        server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5003 backup<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="限流-情况4" tabindex="-1"><a class="header-anchor" href="#限流-情况4" aria-hidden="true">#</a> 限流-情况4</h3><blockquote><p>缺陷：<br> 1、如果客户端请求非常多，1s处理2个是 每500ms 处理一个，就会导致并发性能下降。这个时候把不能处理的，排除掉，然后再来处理。所以需要加缓存来处理。缓冲几个，以提升性能。<br> 方案：客户端IP平滑限流-突发<br> 如何落地客户端IP平滑限流？<br> 条件</p></blockquote><blockquote><p>1、ngx_http_limit_req_module</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    access_log  logs/access.log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    limit_req_zone <span class="token variable">$binary_remote_addr</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>addr:10m <span class="token assign-left variable">rate</span><span class="token operator">=</span>2r/s<span class="token punctuation">;</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        location / <span class="token punctuation">{</span>
            limit_req <span class="token assign-left variable">zone</span><span class="token operator">=</span>addr <span class="token assign-left variable">burst</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#动态负载均衡配置</span>
    upstream LKN.EBusiness<span class="token punctuation">{</span>
    
        server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5003 backup<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="限流-情况5" tabindex="-1"><a class="header-anchor" href="#限流-情况5" aria-hidden="true">#</a> 限流-情况5</h3><blockquote><p>缺陷：</p></blockquote><blockquote><p>1、如果客户端请求非常多，1s处理2个是 每500ms 处理一个，就会导致并发性能下降。这个时候把不能处理的，排除掉，然后再来处理。所以需要加缓存来处理。缓冲几个，以提升性能。</p></blockquote><blockquote><p>方案：客户端IP平滑限流-立即突发</p></blockquote><blockquote><p>如何落地客户端IP平滑限流立即突发？ 条件</p></blockquote><blockquote><p>1、ngx_http_limit_req_module</p></blockquote><blockquote><p>步骤 1、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>
<span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    access_log  logs/access.log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    limit_req_zone <span class="token variable">$binary_remote_addr</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>addr:10m <span class="token assign-left variable">rate</span><span class="token operator">=</span>2r/s<span class="token punctuation">;</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        location / <span class="token punctuation">{</span>
            limit_req <span class="token assign-left variable">zone</span><span class="token operator">=</span>addr <span class="token assign-left variable">burst</span><span class="token operator">=</span><span class="token number">5</span> nodelay<span class="token punctuation">;</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#动态负载均衡配置</span>
    upstream LKN.EBusiness<span class="token punctuation">{</span>
    
        server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5003 backup<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询商品缓存场景落地-情况7" tabindex="-1"><a class="header-anchor" href="#查询商品缓存场景落地-情况7" aria-hidden="true">#</a> 查询商品缓存场景落地-情况7</h3><blockquote><p>情况7：当客户端给Nginx发送查询商品的请求时，Nginx把请求转发给5001 和 5002 ,如果转发到5001和5002，两个实例处理能力达到极限的时候，如何更高提升系统性能场景？</p></blockquote><blockquote><p>方案：代理缓存</p></blockquote><blockquote><p>如何落地代理缓存？<br> 条件</p></blockquote><blockquote><p>1、ngx_http_proxy_module</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>


events <span class="token punctuation">{</span>
    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>

    access_log  logs/access.log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    proxy_cache_path /cache/nginx/ <span class="token assign-left variable">levels</span><span class="token operator">=</span><span class="token number">1</span>:2 <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>mycache:64m<span class="token punctuation">;</span>
    limit_conn_zone <span class="token variable">$server_name</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>perserver:10m<span class="token punctuation">;</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">80</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        location / <span class="token punctuation">{</span>
            limit_conn perserver <span class="token number">1</span><span class="token punctuation">;</span>
            proxy_cache mycache<span class="token punctuation">;</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
            proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
            proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
            proxy_cache_methods GET HEAD<span class="token punctuation">;</span>
            proxy_cache_revalidate on<span class="token punctuation">;</span>
            proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span>
            proxy_cache_valid <span class="token number">404</span> 1m<span class="token punctuation">;</span>
            proxy_cache_valid any 1m<span class="token punctuation">;</span>
            proxy_cache_min_uses <span class="token number">1</span><span class="token punctuation">;</span>
            proxy_cache_use_stale error <span class="token function">timeout</span> invalid_header http_500 http_502 http_503 http_504<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#动态负载均衡配置</span>
    upstream LKN.EBusiness<span class="token punctuation">{</span>
    
        server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
        server localhost:5003 backup<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="参数详解" tabindex="-1"><a class="header-anchor" href="#参数详解" aria-hidden="true">#</a> 参数详解</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>proxy_cache_path /cache/nginx/ <span class="token assign-left variable">levels</span><span class="token operator">=</span><span class="token number">1</span>:2 <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>mycache:64m<span class="token punctuation">;</span>
<span class="token comment">#proxy_cache_path 为缓存存放路径;</span>
<span class="token comment">#levels的第一位表示使用1级子目录冒号隔开第二位表示使用2级子目录,其最多使用三级,1表示每个一级子目录的名字只能使用1个字符;</span>
<span class="token comment">#key_zone中的mycache为缓存名字,可以在location或者server中通过proxy_cache引用;64m表示用多少内存空间存储nginx key;</span>

proxy_cache mycache<span class="token punctuation">;</span>
<span class="token comment">#引用mycache缓存空间;</span>

proxy_pass http://LKN.EBusiness<span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token comment">#将来自 / 的请求代理至192.168.123.34:80 该服务器,后面的 ‘/’ 是必须的;</span>

proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
<span class="token comment">#用于后端的real server区分不同的虚拟主机;</span>

proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
<span class="token comment">#记录客户端真实ip地址,而不是代理服务器地址,需要后端web服务器开启日志相应功能接收;</span>

proxy_cache_methods GET HEAD<span class="token punctuation">;</span>
<span class="token comment">#表示对客户端请求的GET 和 HEAD方法进行缓存;</span>

proxy_cache_revalidate on<span class="token punctuation">;</span>
<span class="token comment">#本地缓存过期会检查后端服务器该缓存是否存在，避免后端重传占据带宽;</span>

proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span>
proxy_cache_valid <span class="token number">404</span> 1m<span class="token punctuation">;</span>
proxy_cache_valid any 1m<span class="token punctuation">;</span>
<span class="token comment">#针对于不同的响应码进行缓存不同的时间设定;</span>

proxy_cache_min_uses <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">#某一个请求被响应多少次才会被缓存,默认是1,可以将该值设置为大一些;</span>

proxy_cache_use_stale error <span class="token function">timeout</span> invalid_header http_500 http_502 http_503 http_504<span class="token punctuation">;</span>
<span class="token comment">#指明哪种场景可以使用过期缓存,提升用户体验;</span>

补充:
proxy_hide_header<span class="token punctuation">;</span>
<span class="token comment">#隐藏由proxy响应客户端时指定的首部;</span>

proxy_buffer <span class="token number">4</span><span class="token operator">|</span>8k
<span class="token comment">#为了响应客户端更快,服务器端响应客户端可能分成多个ip报文响应,也可以整合在一起再一次响应;</span>

Nginx缓存是键值存储，URL是键，文件路径是值。键值存储的速度就是加快在文件系统中查找的速度。所以，存储的key是哈希过的值。
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询商品https应用场景" tabindex="-1"><a class="header-anchor" href="#查询商品https应用场景" aria-hidden="true">#</a> 查询商品Https应用场景</h3><blockquote><p>为了保证查询商品是安全的，所以需要使用Https通信。</p></blockquote><blockquote><p>条件</p></blockquote><blockquote><p>1、server-cert.pem证书</p></blockquote><blockquote><p>2、server-key.pem证书</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、证书生成</p><blockquote><p>1.1 使用openSSL工具生成 <a href="https://slproweb.com/products/Win32OpenSSL.html" target="_blank" rel="noopener noreferrer">下载openSSL<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><blockquote><p>1.1.1 下载openSSL地址：https://slproweb.com/download/Win64OpenSSL-3_1_2.msi<br> 1.1.2 证书生成地址：https://jingyan.baidu.com/article/6c67b1d6be538c2787bb1e06.html<br> 1.1.3 证书生成地址: https://blog.csdn.net/weixin_44454510/article/details/126939208</p></blockquote></blockquote></blockquote><blockquote><blockquote><p>1.2 证书路径：</p></blockquote></blockquote><p><img src="/images/nginx/nginx_0006image.png" alt="Alt text"></p><blockquote><p>2、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;  </span>
events <span class="token punctuation">{</span>
   worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>
access_log  logs/access.log  main<span class="token punctuation">;</span>

sendfile        on<span class="token punctuation">;</span>
<span class="token comment">#tcp_nopush     on;</span>

<span class="token comment">#keepalive_timeout  0;</span>
keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

<span class="token comment">#gzip  on;</span>
proxy_cache_path /cache/nginx/ <span class="token assign-left variable">levels</span><span class="token operator">=</span><span class="token number">1</span>:2 <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>mycache:64m<span class="token punctuation">;</span>
limit_conn_zone <span class="token variable">$server_name</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>perserver:10m<span class="token punctuation">;</span>
server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    <span class="token comment">#charset koi8-r;</span>

    <span class="token comment">#access_log  logs/host.access.log  main;</span>

    location / <span class="token punctuation">{</span>
        limit_conn perserver <span class="token number">1</span><span class="token punctuation">;</span>
        proxy_cache mycache<span class="token punctuation">;</span>
        proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        proxy_cache_methods GET HEAD<span class="token punctuation">;</span>
        proxy_cache_revalidate on<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">404</span> 1m<span class="token punctuation">;</span>
        proxy_cache_valid any 1m<span class="token punctuation">;</span>
        proxy_cache_min_uses <span class="token number">1</span><span class="token punctuation">;</span>
        proxy_cache_use_stale error <span class="token function">timeout</span> invalid_header http_500 http_502 http_503 http_504<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#error_page  404              /404.html;</span>

    <span class="token comment"># redirect server error pages to the static page /50x.html</span>
    <span class="token comment">#</span>
    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
    location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
        root   html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment"># https 虚拟主机</span>
	server <span class="token punctuation">{</span>
        listen       <span class="token number">4435</span> ssl<span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

		ssl_certificate      D:/work/net/grpc-cluster/server-cert.pem<span class="token punctuation">;</span>
        ssl_certificate_key  D:/work/net/grpc-cluster/server-key.pem<span class="token punctuation">;</span>

        ssl_session_cache    shared:SSL:1m<span class="token punctuation">;</span>
        ssl_session_timeout  5m<span class="token punctuation">;</span>

    <span class="token comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span>
    <span class="token comment">#    ssl_prefer_server_ciphers  on;</span>

        location / <span class="token punctuation">{</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#动态负载均衡配置</span>
upstream LKN.EBusiness<span class="token punctuation">{</span>

    server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
    server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
    server localhost:5003 backup<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="http转https" tabindex="-1"><a class="header-anchor" href="#http转https" aria-hidden="true">#</a> Http转Https</h3><blockquote><p>缺陷：系统当中总是有很多默认的Http请求，如何将保证http请求转换成https呢？</p></blockquote><blockquote><p>条件</p></blockquote><blockquote><p>1、ngx_http_rewrite_module</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>2、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;  </span>
    events <span class="token punctuation">{</span>
        worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>
    access_log  logs/access.log  main<span class="token punctuation">;</span>

    sendfile        on<span class="token punctuation">;</span>
    <span class="token comment">#tcp_nopush     on;</span>

    <span class="token comment">#keepalive_timeout  0;</span>
    keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

    <span class="token comment">#gzip  on;</span>
    proxy_cache_path /cache/nginx/ <span class="token assign-left variable">levels</span><span class="token operator">=</span><span class="token number">1</span>:2 <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>mycache:64m<span class="token punctuation">;</span>
    limit_conn_zone <span class="token variable">$server_name</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>perserver:10m<span class="token punctuation">;</span>
    server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    <span class="token comment">#charset koi8-r;</span>

    <span class="token comment">#access_log  logs/host.access.log  main;</span>

    location / <span class="token punctuation">{</span>
        limit_conn perserver <span class="token number">1</span><span class="token punctuation">;</span>
        proxy_cache mycache<span class="token punctuation">;</span>
        proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        proxy_cache_methods GET HEAD<span class="token punctuation">;</span>
        proxy_cache_revalidate on<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">404</span> 1m<span class="token punctuation">;</span>
        proxy_cache_valid any 1m<span class="token punctuation">;</span>
        proxy_cache_min_uses <span class="token number">1</span><span class="token punctuation">;</span>
        proxy_cache_use_stale error <span class="token function">timeout</span> invalid_header http_500 http_502 http_503 http_504<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#error_page  404              /404.html;</span>

    <span class="token comment"># redirect server error pages to the static page /50x.html</span>
    <span class="token comment">#</span>
    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
    location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
        root   html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment"># https 虚拟主机</span>
	server <span class="token punctuation">{</span>
        listen       <span class="token number">4435</span> ssl<span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

		ssl_certificate      D:/work/net/grpc-cluster/server-cert.pem<span class="token punctuation">;</span>
        ssl_certificate_key  D:/work/net/grpc-cluster/server-key.pem<span class="token punctuation">;</span>

        ssl_session_cache    shared:SSL:1m<span class="token punctuation">;</span>
        ssl_session_timeout  5m<span class="token punctuation">;</span>

    <span class="token comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span>
    <span class="token comment">#    ssl_prefer_server_ciphers  on;</span>

        location / <span class="token punctuation">{</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#动态负载均衡配置</span>
upstream LKN.EBusiness<span class="token punctuation">{</span>

    server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
    server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
    server localhost:5003 backup<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询商品数据库应用场景" tabindex="-1"><a class="header-anchor" href="#查询商品数据库应用场景" aria-hidden="true">#</a> 查询商品数据库应用场景</h3><blockquote><p>问题：查询商品并发量非常大，导致一个数据库无法正常处理客户端请求，所以需要使用数据库集群来解决并发量问题？如何对数据库进行代理呢？</p></blockquote><blockquote><p>条件</p></blockquote><blockquote><p>1、ngx_stream_core_module</p></blockquote><blockquote><p>2、ngx_stream_proxy_module</p></blockquote><blockquote><p>3、ngx_stream_upstream_module</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;    </span>
    events <span class="token punctuation">{</span>
        worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
http <span class="token punctuation">{</span>
    include       mime.types<span class="token punctuation">;</span>
    default_type  application/octet-stream<span class="token punctuation">;</span>
	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
    <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
    <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>
access_log  logs/access.log  main<span class="token punctuation">;</span>

sendfile        on<span class="token punctuation">;</span>
<span class="token comment">#tcp_nopush     on;</span>

<span class="token comment">#keepalive_timeout  0;</span>
keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

<span class="token comment">#gzip  on;</span>
proxy_cache_path /cache/nginx/ <span class="token assign-left variable">levels</span><span class="token operator">=</span><span class="token number">1</span>:2 <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>mycache:64m<span class="token punctuation">;</span>
limit_conn_zone <span class="token variable">$server_name</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>perserver:10m<span class="token punctuation">;</span>
server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    <span class="token comment">#charset koi8-r;</span>

    <span class="token comment">#access_log  logs/host.access.log  main;</span>

    location / <span class="token punctuation">{</span>
        limit_conn perserver <span class="token number">1</span><span class="token punctuation">;</span>
        proxy_cache mycache<span class="token punctuation">;</span>
        proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        proxy_cache_methods GET HEAD<span class="token punctuation">;</span>
        proxy_cache_revalidate on<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">404</span> 1m<span class="token punctuation">;</span>
        proxy_cache_valid any 1m<span class="token punctuation">;</span>
        proxy_cache_min_uses <span class="token number">1</span><span class="token punctuation">;</span>
        proxy_cache_use_stale error <span class="token function">timeout</span> invalid_header http_500 http_502 http_503 http_504<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#error_page  404              /404.html;</span>

    <span class="token comment"># redirect server error pages to the static page /50x.html</span>
    <span class="token comment">#</span>
    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
    location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
        root   html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment"># https 虚拟主机</span>
	server <span class="token punctuation">{</span>
        listen       <span class="token number">4435</span> ssl<span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

		ssl_certificate      D:/work/net/grpc-cluster/server-cert.pem<span class="token punctuation">;</span>
        ssl_certificate_key  D:/work/net/grpc-cluster/server-key.pem<span class="token punctuation">;</span>

        ssl_session_cache    shared:SSL:1m<span class="token punctuation">;</span>
        ssl_session_timeout  5m<span class="token punctuation">;</span>

    <span class="token comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span>
    <span class="token comment">#    ssl_prefer_server_ciphers  on;</span>

        location / <span class="token punctuation">{</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#动态负载均衡配置</span>
upstream LKN.EBusiness<span class="token punctuation">{</span>
    server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
    server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
    server localhost:5003 backup<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#数据库代理</span>
stream <span class="token punctuation">{</span>

	server <span class="token punctuation">{</span>
       listen <span class="token number">13306</span><span class="token punctuation">;</span> 
       proxy_connect_timeout 1s<span class="token punctuation">;</span>
       proxy_timeout 3s<span class="token punctuation">;</span>
       proxy_pass localhost:3306<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>

    upstream mysql <span class="token punctuation">{</span>
       server localhost:3306<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="查询商品web应用场景" tabindex="-1"><a class="header-anchor" href="#查询商品web应用场景" aria-hidden="true">#</a> 查询商品Web应用场景</h3><blockquote><p>如果商品是在电商Web网站中，这个时候从电商网站当中查询商品的时候，会同时加载两类数据，静态 数据和动态数据，静态数据：js css 图片，视频，音频等等，动态资源：商品数据。如果访问js css 并发量比较大，会出现cpu，内存等资源全部被耗尽，导致动态数据加载没有资源可用，所以，导致动态资源请求导致性能下降问题？如何提升性能？</p></blockquote><blockquote><p>方案：动静分离</p></blockquote><blockquote><p>前提</p></blockquote><blockquote><p>1、电商web系统</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、使用vs2022创建电商web系统</p></blockquote><p><img src="/images/nginx/nginx_007image.png" alt="Alt text"> ​</p><p>如何落地动静分离 条件</p><p>1、LKN.EBusiness.Web</p><p>2、Nginx</p><p>步骤</p><p>1、先进入到LKN.EBusiness.Web中</p><p>​ 将wwwroot文件拆分到放到LKN.EBusiness.StaticResource目录中</p><p><img src="/images/nginx/nginx_008image.png" alt="Alt text"></p><p>1、然后进入Nginx中，在nginx.conf文件中添加</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;</span>

​    events <span class="token punctuation">{</span>
​        worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
​    <span class="token punctuation">}</span>
​    
    http <span class="token punctuation">{</span>
        include       mime.types<span class="token punctuation">;</span>
        default_type  application/octet-stream<span class="token punctuation">;</span>
        log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
        <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
        <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>
    access_log  logs/access.log  main<span class="token punctuation">;</span>

sendfile        on<span class="token punctuation">;</span>
<span class="token comment">#tcp_nopush     on;</span>

<span class="token comment">#keepalive_timeout  0;</span>
keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

<span class="token comment">#gzip  on;</span>
proxy_cache_path /cache/nginx/ <span class="token assign-left variable">levels</span><span class="token operator">=</span><span class="token number">1</span>:2 <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>mycache:64m<span class="token punctuation">;</span>
limit_conn_zone <span class="token variable">$server_name</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>perserver:10m<span class="token punctuation">;</span>
server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    <span class="token comment">#charset koi8-r;</span>

    <span class="token comment">#access_log  logs/host.access.log  main;</span>

    location / <span class="token punctuation">{</span>
        limit_conn perserver <span class="token number">1</span><span class="token punctuation">;</span>
        proxy_cache mycache<span class="token punctuation">;</span>
        proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        proxy_cache_methods GET HEAD<span class="token punctuation">;</span>
        proxy_cache_revalidate on<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">404</span> 1m<span class="token punctuation">;</span>
        proxy_cache_valid any 1m<span class="token punctuation">;</span>
        proxy_cache_min_uses <span class="token number">1</span><span class="token punctuation">;</span>
        proxy_cache_use_stale error <span class="token function">timeout</span> invalid_header http_500 http_502 http_503 http_504<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#静态资源</span>
    location ~ <span class="token punctuation">\</span>.<span class="token punctuation">(</span>ico<span class="token operator">|</span>js<span class="token operator">|</span>css<span class="token operator">|</span>png<span class="token operator">|</span>jpg<span class="token operator">|</span>mp4<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
        root D:/work/net-project/分布式中间件专题/网关中间件Nginx/LKN.EBusiness.StaticResource/wwwroot<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">#error_page  404              /404.html;</span>

    <span class="token comment"># redirect server error pages to the static page /50x.html</span>
    <span class="token comment">#</span>
    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
    location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
        root   html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># https 虚拟主机</span>
    server <span class="token punctuation">{</span>
        listen       <span class="token number">4435</span> ssl<span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

       ssl_certificate      D:/work/net/grpc-cluster/server-cert.pem<span class="token punctuation">;</span>
        ssl_certificate_key  D:/work/net/grpc-cluster/server-key.pem<span class="token punctuation">;</span>

        ssl_session_cache    shared:SSL:1m<span class="token punctuation">;</span>
        ssl_session_timeout  5m<span class="token punctuation">;</span>

    <span class="token comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span>
    <span class="token comment">#    ssl_prefer_server_ciphers  on;</span>

        location / <span class="token punctuation">{</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#动态负载均衡配置</span>
upstream LKN.EBusiness<span class="token punctuation">{</span>

    server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
    server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
    server localhost:5003 backup<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#数据库代理</span>
stream <span class="token punctuation">{</span>

    server <span class="token punctuation">{</span>
       listen <span class="token number">13306</span><span class="token punctuation">;</span> 
       proxy_connect_timeout 1s<span class="token punctuation">;</span>
       proxy_timeout 3s<span class="token punctuation">;</span>
       proxy_pass localhost:3306<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>

    upstream mysql <span class="token punctuation">{</span>
       server localhost:3306<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>3、客户端进行访问</p></blockquote><blockquote><p>动静分离-情况1 缺陷：如果动静资源在一个虚拟主机中，那么静态资源和动态资源共享同一个资源，如果静态或者动态资源访问量比较大，把资源消耗殆尽，动态和静态资源互相会进行影响，导致系统整体上性能下降，如何提升性能？</p></blockquote><blockquote><p>方案：动静不同虚拟主机</p></blockquote><blockquote><p>如何落地动静不同虚拟主机 条件</p></blockquote><blockquote><p>1、server</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、然后进入Nginx中，在nginx.conf文件中添加</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#user  nobody;</span>
worker_processes  <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">#error_log  logs/error.log;</span>
<span class="token comment">#error_log  logs/error.log  notice;</span>
error_log  logs/error.log  info<span class="token punctuation">;</span>

<span class="token comment">#pid        logs/nginx.pid;    </span>
​    events <span class="token punctuation">{</span>
​        worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span>
​    <span class="token punctuation">}</span>
​    
    http <span class="token punctuation">{</span>
        include       mime.types<span class="token punctuation">;</span>
        default_type  application/octet-stream<span class="token punctuation">;</span>
    	log_format  main  <span class="token string">&#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;</span>
        <span class="token comment">#                  &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span>
        <span class="token comment">#                  &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;</span>
    access_log  logs/access.log  main<span class="token punctuation">;</span>
sendfile        on<span class="token punctuation">;</span>
<span class="token comment">#tcp_nopush     on;</span>

<span class="token comment">#keepalive_timeout  0;</span>
keepalive_timeout  <span class="token number">65</span><span class="token punctuation">;</span>

<span class="token comment">#gzip  on;</span>
proxy_cache_path /cache/nginx/ <span class="token assign-left variable">levels</span><span class="token operator">=</span><span class="token number">1</span>:2 <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>mycache:64m<span class="token punctuation">;</span>
limit_conn_zone <span class="token variable">$server_name</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>perserver:10m<span class="token punctuation">;</span>
server <span class="token punctuation">{</span>
    listen       <span class="token number">80</span><span class="token punctuation">;</span>
    server_name  localhost<span class="token punctuation">;</span>

    <span class="token comment">#charset koi8-r;</span>

    <span class="token comment">#access_log  logs/host.access.log  main;</span>

    location / <span class="token punctuation">{</span>
        limit_conn perserver <span class="token number">1</span><span class="token punctuation">;</span>
        proxy_cache mycache<span class="token punctuation">;</span>
        proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        proxy_cache_methods GET HEAD<span class="token punctuation">;</span>
        proxy_cache_revalidate on<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span>
        proxy_cache_valid <span class="token number">404</span> 1m<span class="token punctuation">;</span>
        proxy_cache_valid any 1m<span class="token punctuation">;</span>
        proxy_cache_min_uses <span class="token number">1</span><span class="token punctuation">;</span>
        proxy_cache_use_stale error <span class="token function">timeout</span> invalid_header http_500 http_502 http_503 http_504<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">#静态资源</span>
    <span class="token comment">#location ~ \.(ico|js|css|png|jpg|mp4)$ {</span>
    <span class="token comment">#	root D:/work/net-project/分布式中间件专题/网关中间件Nginx/LKN.EBusiness.StaticResource/wwwroot;</span>
    <span class="token comment">#}</span>

    <span class="token comment">#error_page  404              /404.html;</span>

    <span class="token comment"># redirect server error pages to the static page /50x.html</span>
    <span class="token comment">#</span>
    error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
    location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
        root   html<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    server <span class="token punctuation">{</span>
        listen       <span class="token number">8089</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        <span class="token comment">#location / {</span>
        <span class="token comment">#    root   html;</span>
        <span class="token comment">#    index  index.html index.htm;</span>
        <span class="token comment">#}</span>
				
		location / <span class="token punctuation">{</span>
            proxy_pass  http://localhost:5007<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
		
		<span class="token comment">#静态资源</span>
		<span class="token comment">#location ~ \.(ico|js|css|png|jpg|mp4)$ {</span>
        <span class="token comment">#    root D:/work/net-project/分布式中间件专题/网关中间件Nginx/LKN.EBusiness.StaticResource/wwwroot;</span>
        <span class="token comment">#}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
	
	server <span class="token punctuation">{</span>
        listen       <span class="token number">8090</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        <span class="token comment">#location / {</span>
        <span class="token comment">#    root   html;</span>
        <span class="token comment">#    index  index.html index.htm;</span>
        <span class="token comment">#}</span>
				
		<span class="token comment">#location / {</span>
        <span class="token comment">#    proxy_pass  http://localhost:5007;</span>
        <span class="token comment">#}</span>
		
		<span class="token comment">#静态资源</span>
		location ~ <span class="token punctuation">\</span>.<span class="token punctuation">(</span>ico<span class="token operator">|</span>js<span class="token operator">|</span>css<span class="token operator">|</span>png<span class="token operator">|</span>jpg<span class="token operator">|</span>mp4<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
            root D:/work/net-project/分布式中间件专题/网关中间件Nginx/LKN.EBusiness.StaticResource/wwwroot<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
	
	proxy_cache_path cache/nginx/ <span class="token assign-left variable">levels</span><span class="token operator">=</span><span class="token number">1</span>:2 <span class="token assign-left variable">keys_zone</span><span class="token operator">=</span>mycache:64m<span class="token punctuation">;</span>
	server <span class="token punctuation">{</span>
        listen       <span class="token number">8091</span><span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

        <span class="token comment">#charset koi8-r;</span>

        <span class="token comment">#access_log  logs/host.access.log  main;</span>

        <span class="token comment">#location / {</span>
        <span class="token comment">#    root   html;</span>
        <span class="token comment">#    index  index.html index.htm;</span>
        <span class="token comment">#}</span>
				
		location / <span class="token punctuation">{</span>
			proxy_cache mycache<span class="token punctuation">;</span>
            proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
            proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
            proxy_cache_methods GET HEAD<span class="token punctuation">;</span>
            proxy_cache_revalidate on<span class="token punctuation">;</span>
            proxy_cache_valid <span class="token number">200</span> <span class="token number">302</span> 10m<span class="token punctuation">;</span>
            proxy_cache_valid <span class="token number">404</span> 1m<span class="token punctuation">;</span>
            proxy_cache_valid any 1m<span class="token punctuation">;</span>
            proxy_cache_min_uses <span class="token number">1</span><span class="token punctuation">;</span>
            proxy_cache_use_stale error <span class="token function">timeout</span> invalid_header http_500 http_502 http_503 http_504<span class="token punctuation">;</span>
            proxy_pass  http://localhost:8089<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
		
		<span class="token comment">#静态资源</span>
		location ~ <span class="token punctuation">\</span>.<span class="token punctuation">(</span>ico<span class="token operator">|</span>js<span class="token operator">|</span>css<span class="token operator">|</span>png<span class="token operator">|</span>jpg<span class="token operator">|</span>mp4<span class="token punctuation">)</span>$ <span class="token punctuation">{</span>
            proxy_pass  http://localhost:8090<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">#error_page  404              /404.html;</span>

        <span class="token comment"># redirect server error pages to the static page /50x.html</span>
        <span class="token comment">#</span>
        error_page   <span class="token number">500</span> <span class="token number">502</span> <span class="token number">503</span> <span class="token number">504</span>  /50x.html<span class="token punctuation">;</span>
        location <span class="token operator">=</span> /50x.html <span class="token punctuation">{</span>
            root   html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment"># https 虚拟主机</span>
	server <span class="token punctuation">{</span>
        listen       <span class="token number">4435</span> ssl<span class="token punctuation">;</span>
        server_name  localhost<span class="token punctuation">;</span>

		ssl_certificate      D:/work/net/grpc-cluster/server-cert.pem<span class="token punctuation">;</span>
        ssl_certificate_key  D:/work/net/grpc-cluster/server-key.pem<span class="token punctuation">;</span>

        ssl_session_cache    shared:SSL:1m<span class="token punctuation">;</span>
        ssl_session_timeout  5m<span class="token punctuation">;</span>

    <span class="token comment">#    ssl_ciphers  HIGH:!aNULL:!MD5;</span>
    <span class="token comment">#    ssl_prefer_server_ciphers  on;</span>

        location / <span class="token punctuation">{</span>
            proxy_pass  http://LKN.EBusiness<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#动态负载均衡配置</span>
upstream LKN.EBusiness<span class="token punctuation">{</span>

    server localhost:5001 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
    server localhost:5002 <span class="token assign-left variable">max_fails</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">fail_timeout</span><span class="token operator">=</span>10s<span class="token punctuation">;</span>
    server localhost:5003 backup<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">#数据库代理</span>
stream <span class="token punctuation">{</span>

	server <span class="token punctuation">{</span>
       listen <span class="token number">13306</span><span class="token punctuation">;</span> 
       proxy_connect_timeout 1s<span class="token punctuation">;</span>
       proxy_timeout 3s<span class="token punctuation">;</span>
       proxy_pass localhost:3306<span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>

    upstream mysql <span class="token punctuation">{</span>
       server localhost:3306<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="动静分离-情况2" tabindex="-1"><a class="header-anchor" href="#动静分离-情况2" aria-hidden="true">#</a> 动静分离-情况2</h3><blockquote><p>缺陷：如果动静资源在一个虚拟主机中，那么静态资源和动态资源共享同一个资源，如果静态或者动态资源访问量比较大，把资源消耗殆尽，动态和静态资源互相会进行影响，导致系统整体上性能下降，如何提升性能？</p></blockquote><blockquote><p>方案：Include</p></blockquote><h2 id="nginx集群场景" tabindex="-1"><a class="header-anchor" href="#nginx集群场景" aria-hidden="true">#</a> Nginx集群场景</h2><blockquote><p>项目中如何落地Nginx集群 条件</p></blockquote><ul><li><p>1、linux</p></li><li><p>2、 nginx</p></li><li><p>3、keepalived</p></li></ul><blockquote><p>步骤</p></blockquote><h3 id="虚拟机准备" tabindex="-1"><a class="header-anchor" href="#虚拟机准备" aria-hidden="true">#</a> 虚拟机准备：</h3><blockquote><p>1、先通过vwworkstation创建2台linux主机</p></blockquote><blockquote><p>地址：192.168.44.3</p></blockquote><blockquote><p>​ 地址：192.168.44.4</p></blockquote><blockquote><p>nginx准备：</p></blockquote><blockquote><p>2、然后分别在2台主机上安装nginx</p></blockquote><p>192.168.44.3：</p><blockquote><p>1 安装 nginx需要工具</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>	 yum <span class="token parameter variable">-y</span> <span class="token function">install</span> gcc <span class="token function">make</span> pcre-devel zlib-devel <span class="token function">tar</span> zlib
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>2 下载nginx</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>	 <span class="token function">wget</span>  http://nginx.org/download/nginx-1.17.1.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>3 nginx解压/nginx目录</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>	<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span>  nginx-1.17.1.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>4 切换到/nginx/nginx-1.17.1</p><blockquote><p>执行./configure<br> make<br> make install 进行安装 5 切换到/usr/local/nginx/sbin 执行 ./nginx 启动nginx</p></blockquote></blockquote><blockquote><p>yum方式</p></blockquote><blockquote><p>192.168.44.4：</p></blockquote><h3 id="_1-安装-nginx需要工具" tabindex="-1"><a class="header-anchor" href="#_1-安装-nginx需要工具" aria-hidden="true">#</a> 1 安装 nginx需要工具</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>	 yum <span class="token parameter variable">-y</span> <span class="token function">install</span> gcc <span class="token function">make</span> pcre-devel zlib-devel <span class="token function">tar</span> zlib
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_2-下载nginx" tabindex="-1"><a class="header-anchor" href="#_2-下载nginx" aria-hidden="true">#</a> 2 下载nginx</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>	 <span class="token function">wget</span>  http://nginx.org/download/nginx-1.24.0.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-nginx解压-nginx目录" tabindex="-1"><a class="header-anchor" href="#_3-nginx解压-nginx目录" aria-hidden="true">#</a> 3 nginx解压/nginx目录</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>	<span class="token function">tar</span> <span class="token parameter variable">-zxvf</span>  nginx-1.24.0.tar.gz
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-切换到-nginx-nginx-1-24-0" tabindex="-1"><a class="header-anchor" href="#_4-切换到-nginx-nginx-1-24-0" aria-hidden="true">#</a> 4 切换到/nginx/nginx-1.24.0</h3><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>	执行./configure  
		make  
		make install 进行安装
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-切换到-usr-local-nginx-sbin" tabindex="-1"><a class="header-anchor" href="#_5-切换到-usr-local-nginx-sbin" aria-hidden="true">#</a> 5 切换到/usr/local/nginx/sbin</h3><blockquote><p>执行 ./nginx 启动nginx</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>./nginx
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_6-禁用-nginx" tabindex="-1"><a class="header-anchor" href="#_6-禁用-nginx" aria-hidden="true">#</a> 6 禁用 nginx</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>./nginx  <span class="token parameter variable">-s</span> stop
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_7-重启-nginx" tabindex="-1"><a class="header-anchor" href="#_7-重启-nginx" aria-hidden="true">#</a> 7 重启 nginx</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>./nginx <span class="token parameter variable">-s</span> reload
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="yum方式安装" tabindex="-1"><a class="header-anchor" href="#yum方式安装" aria-hidden="true">#</a> yum方式安装</h3><blockquote><p>3、然后配置分别将秒杀项目部署到Nginx中</p></blockquote><blockquote><p>在192.168.44.4主机中进行部署</p></blockquote><blockquote><p>4、然后在192.168.44.3配置秒杀项目地址</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>server <span class="token punctuation">{</span>

     listen       <span class="token number">8081</span><span class="token punctuation">;</span>
     server_name  localhost<span class="token punctuation">;</span>
     <span class="token comment">#charset koi8-r;</span>
     <span class="token comment">#access_log  logs/host.access.log  main;</span>
     location / <span class="token punctuation">{</span>
        proxy_pass http://192.168.44.4:5000<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>keepalived</code>准备</p></blockquote><blockquote><p>1、先分别在2台主机上安装keepalived</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> keepalived
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>2、然后启动keepalived</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl start keepalived.service
systemctl stop keepalived.service
systemctl restart keepalived.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>3、然后在192.168.44.4配置Keepalive</p></blockquote><blockquote><p>进入到cd /etc/keepalived/keepalived.conf配置文件</p></blockquote><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code> global_defs <span class="token punctuation">{</span>

   notification_email <span class="token punctuation">{</span> <span class="token comment"># keepalived服务宕机异常出现的时候，发送通知邮件 可以是多个   acassen@firewall.loc  #  收件人邮箱1</span>

 failover@firewall.loc <span class="token comment">#  收件人邮箱2</span>

 sysadmin@firewall.loc <span class="token comment">#  收件人邮箱3</span>
   <span class="token punctuation">}</span>

   notification_email_from Alexandre.Cassen@firewall.loc  <span class="token comment">#邮件发件人</span>

   smtp_server 192.168.200.1  <span class="token comment"># 邮件服务器地址</span>

   smtp_connect_timeout 30   <span class="token comment"># 超时时间</span>

   router_id LVS_DEVEL   <span class="token comment"># 机器标识 局域网内唯一即可</span>

   vrrp_skip_check_adv_addr <span class="token comment"># 默认是不跳过检查。检查收到的VRRP通告中的所有地址可能会比较耗时，设置此命令的意思是，如果通告与接收的上一个通告来自相同的master路由器，则不执行检查(跳过检查)。</span>

   <span class="token comment">#vrrp_strict   # 严格遵守VRRP协议。下列情况将会阻止启动Keepalived：1. 没有VIP地址。2. 单播邻居。3. 在VRRP版本2中有IPv6地址。</span>

   vrrp_garp_interval 0  <span class="token comment"># 小数类型，单位秒，在一个网卡上每组gratuitous arp消息之间的延迟时间，默认为0，一个发送的消息=n组 arp报文</span>

   vrrp_gna_interval 0 <span class="token comment"># 小数类型，单位秒， 在一个网卡上每组na消息之间的延迟时间，默认为0</span>

<span class="token punctuation">}</span>
vrrp_instance VI_1 <span class="token punctuation">{</span>
state MASTER  <span class="token comment"># 服务器状态 MASTER是主服务器  BACKUP是备份服务器 主服务器的priority要比备份服务器大</span>

interface ens33 <span class="token comment"># 通信端口 通过ip addr可以看到 根据自己的机器配置</span>

virtual_router_id 51  <span class="token comment"># vrrp实例id  keepalived集群，实例id必须一致</span>

priority 100  <span class="token comment"># 权重比 主服务器的priority要比备份服务器大</span>

advert_int 1  <span class="token comment"># 心跳间隔  单位秒  keepalived多机器集群 通过心跳检测，如果发送心跳没反应 就立刻接管；</span>

authentication <span class="token punctuation">{</span> <span class="token comment"># 服务器之间通信密码</span>

    auth_type PASS

    auth_pass 1111

<span class="token punctuation">}</span>

virtual_ipaddress <span class="token punctuation">{</span> <span class="token comment"># 自定义虚拟IP </span>

    192.168.91.199

<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>3、然后在192.168.44.3配置Keepalive</p></blockquote><blockquote><p>进入到cd /etc/keepalived/keepalived.conf配置文件</p></blockquote><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code> global_defs <span class="token punctuation">{</span>

   notification_email <span class="token punctuation">{</span> <span class="token comment"># keepalived服务宕机异常出现的时候，发送通知邮件 可以是多个   acassen@firewall.loc  #  收件人邮箱1</span>

 failover@firewall.loc <span class="token comment">#  收件人邮箱2</span>

 sysadmin@firewall.loc <span class="token comment">#  收件人邮箱3</span>
   <span class="token punctuation">}</span>

   notification_email_from Alexandre.Cassen@firewall.loc  <span class="token comment">#邮件发件人</span>

   smtp_server 192.168.200.1  <span class="token comment"># 邮件服务器地址</span>

   smtp_connect_timeout 30   <span class="token comment"># 超时时间</span>

   router_id LVS_DEVEL   <span class="token comment"># 机器标识 局域网内唯一即可</span>

   vrrp_skip_check_adv_addr <span class="token comment"># 默认是不跳过检查。检查收到的VRRP通告中的所有地址可能会比较耗时，设置此命令的意思是，如果通告与接收的上一个通告来自相同的master路由器，则不执行检查(跳过检查)。</span>

   <span class="token comment">#vrrp_strict   # 严格遵守VRRP协议。下列情况将会阻止启动Keepalived：1. 没有VIP地址。2. 单播邻居。3. 在VRRP版本2中有IPv6地址。</span>

   vrrp_garp_interval 0  <span class="token comment"># 小数类型，单位秒，在一个网卡上每组gratuitous arp消息之间的延迟时间，默认为0，一个发送的消息=n组 arp报文</span>

   vrrp_gna_interval 0 <span class="token comment"># 小数类型，单位秒， 在一个网卡上每组na消息之间的延迟时间，默认为0</span>

<span class="token punctuation">}</span>
vrrp_instance VI_1 <span class="token punctuation">{</span>
state BACKUP  <span class="token comment"># 服务器状态 MASTER是主服务器  BACKUP是备份服务器 主服务器的priority要比备份服务器大</span>

interface ens33 <span class="token comment"># 通信端口 通过ip addr可以看到 根据自己的机器配置</span>

virtual_router_id 51  <span class="token comment"># vrrp实例id  keepalived集群，实例id必须一致</span>

priority 99  <span class="token comment"># 权重比 主服务器的priority要比备份服务器大</span>

advert_int 1  <span class="token comment"># 心跳间隔  单位秒  keepalived多机器集群 通过心跳检测，如果发送心跳没反应 就立刻接管；</span>

authentication <span class="token punctuation">{</span> <span class="token comment"># 服务器之间通信密码</span>
auth_type PASS
auth_pass 1111
<span class="token punctuation">}</span>

virtual_ipaddress <span class="token punctuation">{</span> <span class="token comment"># 自定义虚拟IP </span>
192.168.91.199
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>4、然后重启Keepalived</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl restart keepalived.service
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>5、日志查看</p></blockquote><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>tail -f /usr/local/nginx/logs/access.log
tail -f /var/log/messages
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>2、查看进程</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">ps</span> -ef<span class="token operator">|</span><span class="token function">grep</span> keep
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="nginx自动重启-手动" tabindex="-1"><a class="header-anchor" href="#nginx自动重启-手动" aria-hidden="true">#</a> Nginx自动重启-手动</h2><blockquote><p>条件</p></blockquote><blockquote><p>1、nginx_check.sh</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、先创建nginx_check.sh</p></blockquote><blockquote><p>2、然后添加内容</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">&#39;xxxxxx&#39;</span>
<span class="token assign-left variable">count_nginx</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> -ef<span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-w</span> nginx<span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span><span class="token operator">|</span><span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">`</span></span>
<span class="token builtin class-name">echo</span> <span class="token variable">$count_nginx</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$count_nginx</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
/usr/local/nginx/sbin/nginx
<span class="token function">sleep</span> <span class="token number">2</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ps</span> -ef<span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-w</span> nginx<span class="token operator">|</span><span class="token function">grep</span> <span class="token parameter variable">-v</span> <span class="token function">grep</span><span class="token operator">|</span><span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">`</span></span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    systemctl stop keepalived.service
<span class="token keyword">fi</span>  
<span class="token keyword">fi</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>3、然后重启Nginx</p></blockquote><h3 id="nginx自动重启-启动" tabindex="-1"><a class="header-anchor" href="#nginx自动重启-启动" aria-hidden="true">#</a> Nginx自动重启-启动</h3><blockquote><p>条件</p></blockquote><blockquote><p>1、keepalived</p></blockquote><blockquote><p>步骤</p></blockquote><blockquote><p>1、在keepalived.conf中添加内容</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>vrrp_script chk_http_port <span class="token punctuation">{</span>
     script <span class="token string">&quot;/root/nginx_check.sh&quot;</span> <span class="token comment">#脚本地址</span>
     interval <span class="token number">2</span> <span class="token comment">#检测脚本执行的间隔</span>
     weight <span class="token number">2</span> <span class="token comment">#比重</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="socket-配置" tabindex="-1"><a class="header-anchor" href="#socket-配置" aria-hidden="true">#</a> socket 配置</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>   <span class="token comment">#数据库代理</span>
stream <span class="token punctuation">{</span>
    server <span class="token punctuation">{</span>
       listen <span class="token number">8181</span><span class="token punctuation">;</span> 
       proxy_connect_timeout 1s<span class="token punctuation">;</span>
       proxy_timeout 3s<span class="token punctuation">;</span>
       proxy_pass rfidConn<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    upstream rfidConn <span class="token punctuation">{</span>
       server localhost:8182<span class="token punctuation">;</span>
       server localhost:8183<span class="token punctuation">;</span>
       server localhost:8184<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><!----><!----></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-c1c3c937.js" defer></script>
  </body>
</html>
